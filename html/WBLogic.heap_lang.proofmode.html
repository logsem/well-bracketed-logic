<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../index.html">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">WBLogic.heap_lang.proofmode</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">coq_tactics</span> <span class="id" title="library">reduction</span> <span class="id" title="library">spec_patterns</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">tactics</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.program_logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">atomic</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.heap_lang</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">tactics</span> <span class="id" title="library">proofmode</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.heap_lang</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="WBLogic.heap_lang.derived_laws.html#"><span class="id" title="library">derived_laws</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.heap_lang</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">notation</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.prelude</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">options</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">uPred</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_expr_eval" class="idref" href="#tac_wbwp_expr_eval"><span class="id" title="lemma">tac_wbwp_expr_eval</span></a> `{<a id="wbheapGS0:2" class="idref" href="#wbheapGS0:2"><span class="id" title="binder">!</span></a><a id="wbheapGS0:2" class="idref" href="#wbheapGS0:2"><span class="id" title="binder">wbheapGS</span></a> <a id="0101b9beac487b383a5ba2a8f6922788" class="idref" href="#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="binder"><span id="wbheapGS0:2" class="id">Σ</span></span></a>} <a id="70086898232ea9f35274651a64a6780a" class="idref" href="#70086898232ea9f35274651a64a6780a"><span class="id" title="binder">Δ</span></a> <a id="E:4" class="idref" href="#E:4"><span class="id" title="binder">E</span></a> <a id="out:5" class="idref" href="#out:5"><span class="id" title="binder">out</span></a> <a id="f4f4f3cda8233c03492a392432920388" class="idref" href="#f4f4f3cda8233c03492a392432920388"><span class="id" title="binder">Φ</span></a> <a id="e:7" class="idref" href="#e:7"><span class="id" title="binder">e</span></a> <a id="e':8" class="idref" href="#e':8"><span class="id" title="binder">e'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">(</span></a><a id="e'':9" class="idref" href="#e'':9"><span class="id" title="binder">e''</span></a>:=<a class="idref" href="WBLogic.heap_lang.proofmode.html#e':8"><span class="id" title="variable">e'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">),</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e:7"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e'':9"><span class="id" title="variable">e''</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#70086898232ea9f35274651a64a6780a"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e':8"><span class="id" title="variable">e'</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:5"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:4"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f4f4f3cda8233c03492a392432920388"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#70086898232ea9f35274651a64a6780a"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e:7"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:5"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:4"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f4f4f3cda8233c03492a392432920388"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">intros</span> -&gt;. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_expr_eval" <span class="id" title="var">tactic3</span>(<span class="id" title="var">t</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">notypeclasses</span> <span class="id" title="tactic">refine</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_expr_eval"><span class="id" title="lemma">tac_wbwp_expr_eval</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">e</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="var">t</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">x</span>; <span class="id" title="var">notypeclasses</span> <span class="id" title="tactic">refine</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>|]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_expr_eval: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_expr_simpl</span> := <span class="id" title="var">wbwp_expr_eval</span> <span class="id" title="tactic">simpl</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_pure" class="idref" href="#tac_wbwp_pure"><span class="id" title="lemma">tac_wbwp_pure</span></a> `{<a id="wbheapGS0:11" class="idref" href="#wbheapGS0:11"><span class="id" title="binder">!</span></a><a id="wbheapGS0:11" class="idref" href="#wbheapGS0:11"><span class="id" title="binder">wbheapGS</span></a> <a id="2ab75602e9b8af2ca6fd6dbdb1e68a19" class="idref" href="#2ab75602e9b8af2ca6fd6dbdb1e68a19"><span class="id" title="binder"><span id="wbheapGS0:11" class="id">Σ</span></span></a>} <a id="4486f22a746bf7e8d11c811eaad4efd7" class="idref" href="#4486f22a746bf7e8d11c811eaad4efd7"><span class="id" title="binder">Δ</span></a> <a id="f8867afcc2b429628f50571046fee966" class="idref" href="#f8867afcc2b429628f50571046fee966"><span class="id" title="binder">Δ'</span></a> <a id="E:14" class="idref" href="#E:14"><span class="id" title="binder">E</span></a> <a id="out:15" class="idref" href="#out:15"><span class="id" title="binder">out</span></a> <a id="K:16" class="idref" href="#K:16"><span class="id" title="binder">K</span></a> <a id="e1:17" class="idref" href="#e1:17"><span class="id" title="binder">e1</span></a> <a id="e2:18" class="idref" href="#e2:18"><span class="id" title="binder">e2</span></a> <a id="811db5421995400350703bd290e285cb" class="idref" href="#811db5421995400350703bd290e285cb"><span class="id" title="binder">φ</span></a> <a id="n:20" class="idref" href="#n:20"><span class="id" title="binder">n</span></a> <a id="ead8a4e0181169e465090bd4715a840c" class="idref" href="#ead8a4e0181169e465090bd4715a840c"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">PureExec</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#811db5421995400350703bd290e285cb"><span class="id" title="variable">φ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#n:20"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e1:17"><span class="id" title="variable">e1</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e2:18"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang.proofmode.html#811db5421995400350703bd290e285cb"><span class="id" title="variable">φ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#n:20"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#4486f22a746bf7e8d11c811eaad4efd7"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f8867afcc2b429628f50571046fee966"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f8867afcc2b429628f50571046fee966"><span class="id" title="variable">Δ'</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:16"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e2:18"><span class="id" title="variable">e2</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:15"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:14"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#ead8a4e0181169e465090bd4715a840c"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#4486f22a746bf7e8d11c811eaad4efd7"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:16"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e1:17"><span class="id" title="variable">e1</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:15"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:14"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#ead8a4e0181169e465090bd4715a840c"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">HΔ'</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> /=.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;want&nbsp;<span class="inlinecode"><span class="id" title="var">pure_exec_fill</span></span>&nbsp;to&nbsp;be&nbsp;available&nbsp;to&nbsp;TC&nbsp;search&nbsp;locally.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<span class="id" title="lemma">pure_exec_fill</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">HΔ'</span> -<a class="idref" href="WBLogic.program_logic.lifting.html#wbwp_pure_step_later"><span class="id" title="lemma">lifting.wbwp_pure_step_later</span></a> //.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hwp !&gt; _" =&gt; //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_pure_credit" class="idref" href="#tac_wbwp_pure_credit"><span class="id" title="lemma">tac_wbwp_pure_credit</span></a> `{<a id="wbheapGS0:23" class="idref" href="#wbheapGS0:23"><span class="id" title="binder">!</span></a><a id="wbheapGS0:23" class="idref" href="#wbheapGS0:23"><span class="id" title="binder">wbheapGS</span></a> <a id="d0cc8ffb472da08f91141220c07a3c85" class="idref" href="#d0cc8ffb472da08f91141220c07a3c85"><span class="id" title="binder"><span id="wbheapGS0:23" class="id">Σ</span></span></a>} <a id="64bb63c1bf688d4964b97da2c0898b2a" class="idref" href="#64bb63c1bf688d4964b97da2c0898b2a"><span class="id" title="binder">Δ</span></a> <a id="b61a11ba4d04814ece0788eb3aa7cf4a" class="idref" href="#b61a11ba4d04814ece0788eb3aa7cf4a"><span class="id" title="binder">Δ'</span></a> <a id="E:26" class="idref" href="#E:26"><span class="id" title="binder">E</span></a> <a id="out:27" class="idref" href="#out:27"><span class="id" title="binder">out</span></a> <a id="j:28" class="idref" href="#j:28"><span class="id" title="binder">j</span></a> <a id="K:29" class="idref" href="#K:29"><span class="id" title="binder">K</span></a> <a id="e1:30" class="idref" href="#e1:30"><span class="id" title="binder">e1</span></a> <a id="e2:31" class="idref" href="#e2:31"><span class="id" title="binder">e2</span></a> <a id="cdbed30b4c1490afb1ebd012462587ff" class="idref" href="#cdbed30b4c1490afb1ebd012462587ff"><span class="id" title="binder">ϕ</span></a> <a id="3d0db6eb58d9d9f901ac0308b2414dfe" class="idref" href="#3d0db6eb58d9d9f901ac0308b2414dfe"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">PureExec</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#cdbed30b4c1490afb1ebd012462587ff"><span class="id" title="variable">ϕ</span></a> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#e1:30"><span class="id" title="variable">e1</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e2:31"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang.proofmode.html#cdbed30b4c1490afb1ebd012462587ff"><span class="id" title="variable">ϕ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#64bb63c1bf688d4964b97da2c0898b2a"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#b61a11ba4d04814ece0788eb3aa7cf4a"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_app</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#j:28"><span class="id" title="variable">j</span></a> (<span class="id" title="notation">£</span> 1)) <a class="idref" href="WBLogic.heap_lang.proofmode.html#b61a11ba4d04814ece0788eb3aa7cf4a"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:29"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e2:31"><span class="id" title="variable">e2</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:27"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:26"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#3d0db6eb58d9d9f901ac0308b2414dfe"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#64bb63c1bf688d4964b97da2c0898b2a"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:29"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e1:30"><span class="id" title="variable">e1</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:27"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:26"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#3d0db6eb58d9d9f901ac0308b2414dfe"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">HΔ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<span class="id" title="lemma">pure_exec_fill</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.lifting.html#wbwp_pure_step_later"><span class="id" title="lemma">lifting.wbwp_pure_step_later</span></a>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> /=. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_app</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_app_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_r</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">wand_elim_l</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_value_nofupd" class="idref" href="#tac_wbwp_value_nofupd"><span class="id" title="lemma">tac_wbwp_value_nofupd</span></a> `{<a id="wbheapGS0:35" class="idref" href="#wbheapGS0:35"><span class="id" title="binder">!</span></a><a id="wbheapGS0:35" class="idref" href="#wbheapGS0:35"><span class="id" title="binder">wbheapGS</span></a> <a id="c9c14b58eeeaee559bef0d4f884fa28f" class="idref" href="#c9c14b58eeeaee559bef0d4f884fa28f"><span class="id" title="binder"><span id="wbheapGS0:35" class="id">Σ</span></span></a>} <a id="cb2aea9873e9c48b6aed75f059ae789d" class="idref" href="#cb2aea9873e9c48b6aed75f059ae789d"><span class="id" title="binder">Δ</span></a> <a id="E:37" class="idref" href="#E:37"><span class="id" title="binder">E</span></a> <a id="out:38" class="idref" href="#out:38"><span class="id" title="binder">out</span></a> <a id="aa38dbc400642f4a3ca12e2ac1acc621" class="idref" href="#aa38dbc400642f4a3ca12e2ac1acc621"><span class="id" title="binder">Φ</span></a> <a id="v:40" class="idref" href="#v:40"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#cb2aea9873e9c48b6aed75f059ae789d"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#aa38dbc400642f4a3ca12e2ac1acc621"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:40"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#cb2aea9873e9c48b6aed75f059ae789d"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:40"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:38"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:37"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#aa38dbc400642f4a3ca12e2ac1acc621"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_value"><span class="id" title="lemma">wbwp_value</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_value" class="idref" href="#tac_wbwp_value"><span class="id" title="lemma">tac_wbwp_value</span></a> `{<a id="wbheapGS0:42" class="idref" href="#wbheapGS0:42"><span class="id" title="binder">!</span></a><a id="wbheapGS0:42" class="idref" href="#wbheapGS0:42"><span class="id" title="binder">wbheapGS</span></a> <a id="b2fa38fbaf9e73dda3ce249d373db916" class="idref" href="#b2fa38fbaf9e73dda3ce249d373db916"><span class="id" title="binder"><span id="wbheapGS0:42" class="id">Σ</span></span></a>} <a id="8607d6c2a9ec9a03517c9fec6401a571" class="idref" href="#8607d6c2a9ec9a03517c9fec6401a571"><span class="id" title="binder">Δ</span></a> <a id="E:44" class="idref" href="#E:44"><span class="id" title="binder">E</span></a> <a id="out:45" class="idref" href="#out:45"><span class="id" title="binder">out</span></a> (<a id="4e0856880cdba251d5033850f8057534" class="idref" href="#4e0856880cdba251d5033850f8057534"><span class="id" title="binder">Φ</span></a> : <span class="id" title="inductive">val</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iPropI</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#b2fa38fbaf9e73dda3ce249d373db916"><span class="id" title="variable">Σ</span></a>) <a id="v:47" class="idref" href="#v:47"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#8607d6c2a9ec9a03517c9fec6401a571"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">|={</span><a class="idref" href="WBLogic.heap_lang.proofmode.html#E:44"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=&gt;</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#4e0856880cdba251d5033850f8057534"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:47"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#8607d6c2a9ec9a03517c9fec6401a571"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:47"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:45"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:44"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#4e0856880cdba251d5033850f8057534"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt;. <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_value_fupd"><span class="id" title="lemma">wbwp_value_fupd</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Simplify the goal if it is <span class="inlinecode"><span class="id" title="var">WP</span></span> of a value.
  If the postcondition already allows a fupd, do not add a second one.
  But otherwise, *do* add a fupd. This ensures that all the lemmas applied
  here are bidirectional, so we never will make a goal unprovable. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_value_head</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> (<span class="id" title="constructor">Val</span> <span class="id" title="var">_</span>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">fupd</span> ?<span class="id" title="var">E</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">tac_wp_value_nofupd</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> (<span class="id" title="constructor">Val</span> <span class="id" title="var">_</span>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">wp</span> <span class="id" title="var">_</span> ?<span class="id" title="var">E</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_value_nofupd"><span class="id" title="lemma">tac_wbwp_value_nofupd</span></a><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> (<span class="id" title="constructor">Val</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">tac_wp_value</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_finish</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_expr_simpl</span>;      <span class="comment">(*&nbsp;simplify&nbsp;occurences&nbsp;of&nbsp;subst/fill&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">wbwp_value_head</span>;  <span class="comment">(*&nbsp;in&nbsp;case&nbsp;we&nbsp;have&nbsp;reached&nbsp;a&nbsp;value,&nbsp;get&nbsp;rid&nbsp;of&nbsp;the&nbsp;WP&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">pm_prettify</span>. <span class="comment">(*&nbsp;prettify&nbsp;▷s&nbsp;caused&nbsp;by&nbsp;<span class="inlinecode"><span class="id" title="var">MaybeIntoLaterNEnvs</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;λs&nbsp;caused&nbsp;by&nbsp;wp_value&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
The argument <span class="inlinecode"><span class="id" title="var">efoc</span></span> can be used to specify the construct that should be
reduced. For example, you can write <span class="inlinecode"><span class="id" title="var">wp_pure</span></span> <span class="inlinecode">(<span class="id" title="var">EIf</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>, which will search
for an <span class="inlinecode"><span class="id" title="var">EIf</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> in the expression, and reduce it.

<div class="paragraph"> </div>

The use of <span class="inlinecode"><span class="id" title="var">open_constr</span></span> in this tactic is essential. It will convert all holes
(i.e. <span class="inlinecode"><span class="id" title="var">_</span></span>s) into evars, that later get unified when an occurences is found
(see <span class="inlinecode"><span class="id" title="var">unify</span></span> <span class="inlinecode"><span class="id" title="var">e'</span></span> <span class="inlinecode"><span class="id" title="var">efoc</span></span> in the code below). 
</div>
<div class="code">
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pure" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">e</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_pure"><span class="id" title="lemma">tac_wbwp_pure</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;PureExec&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span>    <span class="comment">(*&nbsp;The&nbsp;pure&nbsp;condition&nbsp;for&nbsp;PureExec&nbsp;--<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handles&nbsp;trivial&nbsp;goals,&nbsp;including&nbsp;<span class="inlinecode"><span class="id" title="var">vals_compare_safe</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;IntoLaters&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wbwp_finish</span>                      <span class="comment">(*&nbsp;new&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" title="tactic">fail</span> "wbwp_pure: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> "or" <span class="id" title="var">efoc</span> "is not a redex"<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_pure: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pure" :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pure</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pure" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) "credit:" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Htmp</span> := <span class="id" title="var">iFresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">finish</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pm_reduce</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">iDestructHyp</span> <span class="id" title="var">Htmp</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H</span> || <span class="id" title="tactic">fail</span> 2 "wbwp_pure:" <span class="id" title="var">H</span> "is not fresh");<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">e</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_pure_credit"><span class="id" title="lemma">tac_wbwp_pure_credit</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Htmp</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;PureExec&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span>    <span class="comment">(*&nbsp;The&nbsp;pure&nbsp;condition&nbsp;for&nbsp;PureExec&nbsp;--<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handles&nbsp;trivial&nbsp;goals,&nbsp;including&nbsp;<span class="inlinecode"><span class="id" title="var">vals_compare_safe</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;IntoLaters&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">finish</span> ()                      <span class="comment">(*&nbsp;new&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" title="tactic">fail</span> "wbwp_pure: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> "or" <span class="id" title="var">efoc</span> "is not a redex"<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_pure: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pure" "credit:" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pure</span> <span class="id" title="var">_</span> <span class="id" title="var">credit</span>: <span class="id" title="var">H</span>.<br/>

<br/>
<span class="comment">(*&nbsp;TODO:&nbsp;do&nbsp;this&nbsp;in&nbsp;one&nbsp;go,&nbsp;without&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_pures</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="comment">(*&nbsp;The&nbsp;`;<span class="inlinecode"></span>`&nbsp;makes&nbsp;sure&nbsp;that&nbsp;no&nbsp;side-condition&nbsp;magically&nbsp;spawns.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">progress</span> <span class="id" title="tactic">repeat</span> (<span class="id" title="var">wbwp_pure</span> <span class="id" title="var">_</span>; [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">wbwp_finish</span> <span class="comment">(*&nbsp;In&nbsp;case&nbsp;wp_pure&nbsp;never&nbsp;ran,&nbsp;make&nbsp;sure&nbsp;we&nbsp;do&nbsp;the&nbsp;usual&nbsp;cleanup.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
Unlike <span class="inlinecode"><span class="id" title="var">wp_pures</span></span>, the tactics <span class="inlinecode"><span class="id" title="var">wp_rec</span></span> and <span class="inlinecode"><span class="id" title="var">wp_lam</span></span> should also reduce
lambdas/recs that are hidden behind a definition, i.e. they should use
<span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.class_instances.html#AsRecV_recv"><span class="id" title="definition">AsRecV_recv</span></a></span> as a proper instance instead of a <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Extern</span></span>.

<div class="paragraph"> </div>

We achieve this by putting <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.class_instances.html#AsRecV_recv"><span class="id" title="definition">AsRecV_recv</span></a></span> in the current environment so that it
can be used as an instance by the typeclass resolution system. We then perform
the reduction, and finally we clear this new hypothesis. 
</div>
<div class="code">
<span class="id" title="keyword">Tactic Notation</span> "wbwp_rec" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span> := <span class="id" title="definition">AsRecV_recv</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">App</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_if" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">If</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_if_true" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">If</span> (<span class="id" title="constructor">LitV</span> (<span class="id" title="constructor">LitBool</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_if_false" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">If</span> (<span class="id" title="constructor">LitV</span> (<span class="id" title="constructor">LitBool</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_unop" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">UnOp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_binop" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">BinOp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_op" := <span class="id" title="var">wbwp_unop</span> || <span class="id" title="var">wbwp_binop</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_lam" := <span class="id" title="var">wbwp_rec</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_let" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">Rec</span> <span class="id" title="constructor">BAnon</span> (<span class="id" title="constructor">BNamed</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>); <span class="id" title="var">wbwp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_seq" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">Rec</span> <span class="id" title="constructor">BAnon</span> <span class="id" title="constructor">BAnon</span> <span class="id" title="var">_</span>); <span class="id" title="var">wbwp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_proj" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">Fst</span> <span class="id" title="var">_</span>) || <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">Snd</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_case" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">Case</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_match" := <span class="id" title="var">wbwp_case</span>; <span class="id" title="var">wp_pure</span> (<span class="id" title="constructor">Rec</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="var">wbwp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_inj" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">InjL</span> <span class="id" title="var">_</span>) || <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">InjR</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pair" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">Pair</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_closure" := <span class="id" title="var">wbwp_pure</span> (<span class="id" title="constructor">Rec</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_bind" class="idref" href="#tac_wbwp_bind"><span class="id" title="lemma">tac_wbwp_bind</span></a> `{<a id="wbheapGS0:49" class="idref" href="#wbheapGS0:49"><span class="id" title="binder">!</span></a><a id="wbheapGS0:49" class="idref" href="#wbheapGS0:49"><span class="id" title="binder">wbheapGS</span></a> <a id="1599156b531db08541b0ea734472e882" class="idref" href="#1599156b531db08541b0ea734472e882"><span class="id" title="binder"><span id="wbheapGS0:49" class="id">Σ</span></span></a>} <a id="K:50" class="idref" href="#K:50"><span class="id" title="binder">K</span></a> <a id="470a1afdbbe48f100e3c886f9cdd5bf9" class="idref" href="#470a1afdbbe48f100e3c886f9cdd5bf9"><span class="id" title="binder">Δ</span></a> <a id="E:52" class="idref" href="#E:52"><span class="id" title="binder">E</span></a> <a id="out:53" class="idref" href="#out:53"><span class="id" title="binder">out</span></a> <a id="b62930ba920d094619afe8ef0203354e" class="idref" href="#b62930ba920d094619afe8ef0203354e"><span class="id" title="binder">Φ</span></a> <a id="e:55" class="idref" href="#e:55"><span class="id" title="binder">e</span></a> <a id="f:56" class="idref" href="#f:56"><span class="id" title="binder">f</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang.proofmode.html#f:56"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <a id="e:57" class="idref" href="#e:57"><span class="id" title="binder">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:50"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e:57"><span class="id" title="variable">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="comment">(*&nbsp;as&nbsp;an&nbsp;eta&nbsp;expanded&nbsp;hypothesis&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;`simpl`&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#470a1afdbbe48f100e3c886f9cdd5bf9"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e:55"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:53"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:52"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">{{</span></a> <a id="v:58" class="idref" href="#v:58"><span class="id" title="binder">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f:56"><span class="id" title="variable">f</span></a> (<span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:58"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:53"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:52"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#b62930ba920d094619afe8ef0203354e"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">}}</span></a>)%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#470a1afdbbe48f100e3c886f9cdd5bf9"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:50"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e:55"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:53"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:52"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#b62930ba920d094619afe8ef0203354e"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span>: <a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_bind_core</span> <span class="id" title="var">K</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="tactic">eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">K</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_bind"><span class="id" title="lemma">tac_wbwp_bind</span></a> <span class="id" title="var">K</span>); [<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>|<span class="id" title="var">reduction.pm_prettify</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_bind" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>; <span class="id" title="var">wbwp_bind_core</span> <span class="id" title="var">K</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">fail</span> 1 "wp_bind: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> ]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_bind: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Heap tactics 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a id="heap" class="idref" href="#heap"><span class="id" title="section">heap</span></a>.<br/>
<span class="id" title="keyword">Context</span> `{<a id="wbheapGS0:60" class="idref" href="#wbheapGS0:60"><span class="id" title="binder">!</span></a><a id="wbheapGS0:60" class="idref" href="#wbheapGS0:60"><span class="id" title="binder">wbheapGS</span></a> <a id="0685bd56931f2020ec61d62cd42607cf" class="idref" href="#0685bd56931f2020ec61d62cd42607cf"><span class="id" title="binder"><span id="wbheapGS0:60" class="id">Σ</span></span></a>}.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Φ</span> : <span class="id" title="inductive">val</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Δ</span> : <span class="id" title="record">envs</span> (<span class="id" title="definition">uPredI</span> (<span class="id" title="definition">iResUR</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>)).<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> : <span class="id" title="inductive">val</span>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">z</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_allocN" class="idref" href="#tac_wbwp_allocN"><span class="id" title="lemma">tac_wbwp_allocN</span></a> <a id="e889f5459734bf7cd51e4fdb10aa3a03" class="idref" href="#e889f5459734bf7cd51e4fdb10aa3a03"><span class="id" title="binder">Δ</span></a> <a id="955a3665889e45d6449fb87bd1e66ada" class="idref" href="#955a3665889e45d6449fb87bd1e66ada"><span class="id" title="binder">Δ'</span></a> <a id="E:63" class="idref" href="#E:63"><span class="id" title="binder">E</span></a> <a id="out:64" class="idref" href="#out:64"><span class="id" title="binder">out</span></a> <a id="j:65" class="idref" href="#j:65"><span class="id" title="binder">j</span></a> <a id="K:66" class="idref" href="#K:66"><span class="id" title="binder">K</span></a> <a id="v:67" class="idref" href="#v:67"><span class="id" title="binder">v</span></a> <a id="n:68" class="idref" href="#n:68"><span class="id" title="binder">n</span></a> <a id="69f172393263167da34f45cb2fc47c28" class="idref" href="#69f172393263167da34f45cb2fc47c28"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;(0 <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#::Z_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#n:68"><span class="id" title="variable">n</span></a>)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#e889f5459734bf7cd51e4fdb10aa3a03"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#955a3665889e45d6449fb87bd1e66ada"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a id="l:70" class="idref" href="#l:70"><span class="id" title="binder">l</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_app</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#j:65"><span class="id" title="variable">j</span></a> (<span class="id" title="definition">array</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:70"><span class="id" title="variable">l</span></a> (<span class="id" title="constructor">DfracOwn</span> 1) (<span class="id" title="definition">replicate</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#n:68"><span class="id" title="variable">n</span></a>) <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:67"><span class="id" title="variable">v</span></a>))) <a class="idref" href="WBLogic.heap_lang.proofmode.html#955a3665889e45d6449fb87bd1e66ada"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:66"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitV</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitLoc</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:70"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:64"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:63"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#69f172393263167da34f45cb2fc47c28"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e889f5459734bf7cd51e4fdb10aa3a03"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:66"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">AllocN</span> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitV</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitInt</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#n:68"><span class="id" title="variable">n</span></a>) (<span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:67"><span class="id" title="variable">v</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:64"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:63"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#69f172393263167da34f45cb2fc47c28"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ? ? <span class="id" title="var">HΔ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.derived_laws.html#wbwp_allocN"><span class="id" title="lemma">wbwp_allocN</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">left_id</span> <span class="id" title="lemma">into_laterN_env_sound</span>; <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">forall_intro</span>=&gt; <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">HΔ</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_app</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_app_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_l</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="lemma">sep_elim_l</span> (<span class="id" title="var">l</span> <span class="id" title="notation">↦∗</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span>) <span class="id" title="definition">right_id</span> <span class="id" title="lemma">wand_elim_r</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_alloc" class="idref" href="#tac_wbwp_alloc"><span class="id" title="lemma">tac_wbwp_alloc</span></a> <a id="93d7c3fe8fde73ab9297f9d23edc4b8c" class="idref" href="#93d7c3fe8fde73ab9297f9d23edc4b8c"><span class="id" title="binder">Δ</span></a> <a id="2a3fd75db62da4f34d5c6ee2010bb68c" class="idref" href="#2a3fd75db62da4f34d5c6ee2010bb68c"><span class="id" title="binder">Δ'</span></a> <a id="E:73" class="idref" href="#E:73"><span class="id" title="binder">E</span></a> <a id="out:74" class="idref" href="#out:74"><span class="id" title="binder">out</span></a> <a id="j:75" class="idref" href="#j:75"><span class="id" title="binder">j</span></a> <a id="K:76" class="idref" href="#K:76"><span class="id" title="binder">K</span></a> <a id="v:77" class="idref" href="#v:77"><span class="id" title="binder">v</span></a> <a id="e8282b68f20f3c9a21aea1d1b1422e79" class="idref" href="#e8282b68f20f3c9a21aea1d1b1422e79"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#93d7c3fe8fde73ab9297f9d23edc4b8c"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#2a3fd75db62da4f34d5c6ee2010bb68c"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a id="l:79" class="idref" href="#l:79"><span class="id" title="binder">l</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_app</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#j:75"><span class="id" title="variable">j</span></a> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#l:79"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:77"><span class="id" title="variable">v</span></a>)) <a class="idref" href="WBLogic.heap_lang.proofmode.html#2a3fd75db62da4f34d5c6ee2010bb68c"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:76"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:79"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:74"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:73"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e8282b68f20f3c9a21aea1d1b1422e79"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#93d7c3fe8fde73ab9297f9d23edc4b8c"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:76"><span class="id" title="variable">K</span></a> (<span class="id" title="abbreviation">Alloc</span> (<span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:77"><span class="id" title="variable">v</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:74"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:73"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e8282b68f20f3c9a21aea1d1b1422e79"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ? <span class="id" title="var">HΔ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_alloc"><span class="id" title="lemma">wbwp_alloc</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">left_id</span> <span class="id" title="lemma">into_laterN_env_sound</span>; <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">forall_intro</span>=&gt; <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">HΔ</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_app</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_app_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_l</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="lemma">sep_elim_l</span> (<span class="id" title="var">l</span> <span class="id" title="notation">↦</span> <span class="id" title="var">v</span>)%<span class="id" title="var">I</span>) <span class="id" title="definition">right_id</span> <span class="id" title="lemma">wand_elim_r</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_free" class="idref" href="#tac_wbwp_free"><span class="id" title="lemma">tac_wbwp_free</span></a> <a id="b23b8783ae23f38cc03ba07a68baceae" class="idref" href="#b23b8783ae23f38cc03ba07a68baceae"><span class="id" title="binder">Δ</span></a> <a id="8bbbde7be59138f706ddc924b820375c" class="idref" href="#8bbbde7be59138f706ddc924b820375c"><span class="id" title="binder">Δ'</span></a> <a id="E:82" class="idref" href="#E:82"><span class="id" title="binder">E</span></a> <a id="out:83" class="idref" href="#out:83"><span class="id" title="binder">out</span></a> <a id="i:84" class="idref" href="#i:84"><span class="id" title="binder">i</span></a> <a id="K:85" class="idref" href="#K:85"><span class="id" title="binder">K</span></a> <a id="l:86" class="idref" href="#l:86"><span class="id" title="binder">l</span></a> <a id="v:87" class="idref" href="#v:87"><span class="id" title="binder">v</span></a> <a id="e05567719bace2504f16ae8fb46148a7" class="idref" href="#e05567719bace2504f16ae8fb46148a7"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#b23b8783ae23f38cc03ba07a68baceae"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#8bbbde7be59138f706ddc924b820375c"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:84"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#8bbbde7be59138f706ddc924b820375c"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:86"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:87"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><span class="id" title="keyword">let</span> <a id="9d81f442c76620bb31c05358f2adcd5b" class="idref" href="#9d81f442c76620bb31c05358f2adcd5b"><span class="id" title="binder">Δ''</span></a> := <span class="id" title="definition">envs_delete</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:84"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#8bbbde7be59138f706ddc924b820375c"><span class="id" title="variable">Δ'</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#9d81f442c76620bb31c05358f2adcd5b"><span class="id" title="variable">Δ''</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:85"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitV</span> <span class="id" title="constructor">LitUnit</span>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:83"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:82"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e05567719bace2504f16ae8fb46148a7"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#b23b8783ae23f38cc03ba07a68baceae"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:85"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Free</span> (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:86"><span class="id" title="variable">l</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:83"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:82"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e05567719bace2504f16ae8fb46148a7"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ? <span class="id" title="var">Hlk</span> <span class="id" title="var">Hfin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_free"><span class="id" title="lemma">wbwp_free</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="var">Hfin</span> <span class="id" title="lemma">wand_elim_r</span> (<span class="id" title="lemma">envs_lookup_sound'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hlk</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_intro_r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span> //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_load" class="idref" href="#tac_wbwp_load"><span class="id" title="lemma">tac_wbwp_load</span></a> <a id="25e92cdafd8d2b0aa541afdd2db035eb" class="idref" href="#25e92cdafd8d2b0aa541afdd2db035eb"><span class="id" title="binder">Δ</span></a> <a id="060ce47f4a0714b6d6c1db752da17c54" class="idref" href="#060ce47f4a0714b6d6c1db752da17c54"><span class="id" title="binder">Δ'</span></a> <a id="E:92" class="idref" href="#E:92"><span class="id" title="binder">E</span></a> <a id="out:93" class="idref" href="#out:93"><span class="id" title="binder">out</span></a> <a id="i:94" class="idref" href="#i:94"><span class="id" title="binder">i</span></a> <a id="K:95" class="idref" href="#K:95"><span class="id" title="binder">K</span></a> <a id="b:96" class="idref" href="#b:96"><span class="id" title="binder">b</span></a> <a id="l:97" class="idref" href="#l:97"><span class="id" title="binder">l</span></a> <a id="q:98" class="idref" href="#q:98"><span class="id" title="binder">q</span></a> <a id="v:99" class="idref" href="#v:99"><span class="id" title="binder">v</span></a> <a id="ba9644d1d3fd74f247771a7b51c94638" class="idref" href="#ba9644d1d3fd74f247771a7b51c94638"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#25e92cdafd8d2b0aa541afdd2db035eb"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#060ce47f4a0714b6d6c1db752da17c54"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:94"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#060ce47f4a0714b6d6c1db752da17c54"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang.proofmode.html#b:96"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:97"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang.proofmode.html#q:98"><span class="id" title="variable">q</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:99"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#060ce47f4a0714b6d6c1db752da17c54"><span class="id" title="variable">Δ'</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:95"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:99"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:93"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:92"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#ba9644d1d3fd74f247771a7b51c94638"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#25e92cdafd8d2b0aa541afdd2db035eb"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:95"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Load</span> (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:97"><span class="id" title="variable">l</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:93"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:92"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#ba9644d1d3fd74f247771a7b51c94638"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?? <span class="id" title="var">Hi</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_load"><span class="id" title="lemma">wbwp_load</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="var">iIntros</span> "[#$ He]". <span class="id" title="var">iIntros</span> "_". <span class="id" title="var">iApply</span> <span class="id" title="var">Hi</span>. <span class="id" title="var">iApply</span> "He". <span class="id" title="var">iFrame</span> "#".<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_store" class="idref" href="#tac_wbwp_store"><span class="id" title="lemma">tac_wbwp_store</span></a> <a id="221c1aaa62dce03a81da09831f639e1d" class="idref" href="#221c1aaa62dce03a81da09831f639e1d"><span class="id" title="binder">Δ</span></a> <a id="0fbe12770f5f557f0d0476e89bf470c7" class="idref" href="#0fbe12770f5f557f0d0476e89bf470c7"><span class="id" title="binder">Δ'</span></a> <a id="E:103" class="idref" href="#E:103"><span class="id" title="binder">E</span></a> <a id="out:104" class="idref" href="#out:104"><span class="id" title="binder">out</span></a> <a id="i:105" class="idref" href="#i:105"><span class="id" title="binder">i</span></a> <a id="K:106" class="idref" href="#K:106"><span class="id" title="binder">K</span></a> <a id="l:107" class="idref" href="#l:107"><span class="id" title="binder">l</span></a> <a id="v:108" class="idref" href="#v:108"><span class="id" title="binder">v</span></a> <a id="v':109" class="idref" href="#v':109"><span class="id" title="binder">v'</span></a> <a id="0a45200a7472e3efb6d9ad27e974a7df" class="idref" href="#0a45200a7472e3efb6d9ad27e974a7df"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#221c1aaa62dce03a81da09831f639e1d"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0fbe12770f5f557f0d0476e89bf470c7"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:105"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0fbe12770f5f557f0d0476e89bf470c7"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:107"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:108"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:105"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:105"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#l:107"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v':109"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.heap_lang.proofmode.html#0fbe12770f5f557f0d0476e89bf470c7"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:106"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitV</span> <span class="id" title="constructor">LitUnit</span>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:104"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:103"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0a45200a7472e3efb6d9ad27e974a7df"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#221c1aaa62dce03a81da09831f639e1d"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:106"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Store</span> (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:107"><span class="id" title="variable">l</span></a>) (<span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v':109"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:104"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:103"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0a45200a7472e3efb6d9ad27e974a7df"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_store"><span class="id" title="lemma">wbwp_store</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_xchg" class="idref" href="#tac_wbwp_xchg"><span class="id" title="lemma">tac_wbwp_xchg</span></a> <a id="f4afae4c60ced6ff1c05aee1830e5299" class="idref" href="#f4afae4c60ced6ff1c05aee1830e5299"><span class="id" title="binder">Δ</span></a> <a id="c6d548e0003a7c4efb2d05bff24903dd" class="idref" href="#c6d548e0003a7c4efb2d05bff24903dd"><span class="id" title="binder">Δ'</span></a> <a id="E:113" class="idref" href="#E:113"><span class="id" title="binder">E</span></a> <a id="out:114" class="idref" href="#out:114"><span class="id" title="binder">out</span></a> <a id="i:115" class="idref" href="#i:115"><span class="id" title="binder">i</span></a> <a id="K:116" class="idref" href="#K:116"><span class="id" title="binder">K</span></a> <a id="l:117" class="idref" href="#l:117"><span class="id" title="binder">l</span></a> <a id="v:118" class="idref" href="#v:118"><span class="id" title="binder">v</span></a> <a id="v':119" class="idref" href="#v':119"><span class="id" title="binder">v'</span></a> <a id="72ea5747da4d13d2822d1f9efc10ec0b" class="idref" href="#72ea5747da4d13d2822d1f9efc10ec0b"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#f4afae4c60ced6ff1c05aee1830e5299"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#c6d548e0003a7c4efb2d05bff24903dd"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:115"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#c6d548e0003a7c4efb2d05bff24903dd"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:117"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:118"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:115"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:115"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#l:117"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v':119"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.heap_lang.proofmode.html#c6d548e0003a7c4efb2d05bff24903dd"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:116"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:118"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:114"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:113"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#72ea5747da4d13d2822d1f9efc10ec0b"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f4afae4c60ced6ff1c05aee1830e5299"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:116"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Xchg</span> (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:117"><span class="id" title="variable">l</span></a>) (<span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v':119"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:114"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:113"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#72ea5747da4d13d2822d1f9efc10ec0b"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_xchg"><span class="id" title="lemma">wbwp_xchg</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_cmpxchg" class="idref" href="#tac_wbwp_cmpxchg"><span class="id" title="lemma">tac_wbwp_cmpxchg</span></a> <a id="e50a66ed72ab25cb744b64f121d7df7f" class="idref" href="#e50a66ed72ab25cb744b64f121d7df7f"><span class="id" title="binder">Δ</span></a> <a id="0df0704c33dda487ad58f92f173be70e" class="idref" href="#0df0704c33dda487ad58f92f173be70e"><span class="id" title="binder">Δ'</span></a> <a id="E:123" class="idref" href="#E:123"><span class="id" title="binder">E</span></a> <a id="out:124" class="idref" href="#out:124"><span class="id" title="binder">out</span></a> <a id="i:125" class="idref" href="#i:125"><span class="id" title="binder">i</span></a> <a id="K:126" class="idref" href="#K:126"><span class="id" title="binder">K</span></a> <a id="l:127" class="idref" href="#l:127"><span class="id" title="binder">l</span></a> <a id="v:128" class="idref" href="#v:128"><span class="id" title="binder">v</span></a> <a id="v1:129" class="idref" href="#v1:129"><span class="id" title="binder">v1</span></a> <a id="v2:130" class="idref" href="#v2:130"><span class="id" title="binder">v2</span></a> <a id="f254557ae0abbcc933c4b9c123cb7884" class="idref" href="#f254557ae0abbcc933c4b9c123cb7884"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#e50a66ed72ab25cb744b64f121d7df7f"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0df0704c33dda487ad58f92f173be70e"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:125"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0df0704c33dda487ad58f92f173be70e"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:127"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:128"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">vals_compare_safe</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:128"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:129"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:125"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:125"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#l:127"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v2:130"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.heap_lang.proofmode.html#0df0704c33dda487ad58f92f173be70e"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang.proofmode.html#v:128"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:129"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:126"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">PairV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:128"><span class="id" title="variable">v</span></a> (<span class="id" title="constructor">LitV</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitBool</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:124"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:123"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f254557ae0abbcc933c4b9c123cb7884"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang.proofmode.html#v:128"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:129"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0df0704c33dda487ad58f92f173be70e"><span class="id" title="variable">Δ'</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:126"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">PairV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:128"><span class="id" title="variable">v</span></a> (<span class="id" title="constructor">LitV</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitBool</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:124"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:123"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f254557ae0abbcc933c4b9c123cb7884"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#e50a66ed72ab25cb744b64f121d7df7f"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:126"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">CmpXchg</span> (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:127"><span class="id" title="variable">l</span></a>) (<span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:129"><span class="id" title="variable">v1</span></a>) (<span class="id" title="constructor">Val</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v2:130"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:124"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:123"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#f254557ae0abbcc933c4b9c123cb7884"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">Hsuc</span> <span class="id" title="var">Hfail</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v1</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span>|<span class="id" title="var">Hne</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_cmpxchg_suc"><span class="id" title="lemma">wbwp_cmpxchg_suc</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> /= {1}<span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_cmpxchg_fail"><span class="id" title="lemma">wbwp_cmpxchg_fail</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> /= {1}<span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_cmpxchg_fail" class="idref" href="#tac_wbwp_cmpxchg_fail"><span class="id" title="lemma">tac_wbwp_cmpxchg_fail</span></a> <a id="989f03d30900731e9c2b2e43f994e054" class="idref" href="#989f03d30900731e9c2b2e43f994e054"><span class="id" title="binder">Δ</span></a> <a id="7e1f13090c5e3597d2c8f4d35d069000" class="idref" href="#7e1f13090c5e3597d2c8f4d35d069000"><span class="id" title="binder">Δ'</span></a> <a id="E:134" class="idref" href="#E:134"><span class="id" title="binder">E</span></a> <a id="out:135" class="idref" href="#out:135"><span class="id" title="binder">out</span></a> <a id="i:136" class="idref" href="#i:136"><span class="id" title="binder">i</span></a> <a id="K:137" class="idref" href="#K:137"><span class="id" title="binder">K</span></a> <a id="l:138" class="idref" href="#l:138"><span class="id" title="binder">l</span></a> <a id="q:139" class="idref" href="#q:139"><span class="id" title="binder">q</span></a> <a id="v:140" class="idref" href="#v:140"><span class="id" title="binder">v</span></a> <a id="v1:141" class="idref" href="#v1:141"><span class="id" title="binder">v1</span></a> <a id="v2:142" class="idref" href="#v2:142"><span class="id" title="binder">v2</span></a> <a id="707e9817eb00447b460e33c4c17f4b6f" class="idref" href="#707e9817eb00447b460e33c4c17f4b6f"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#989f03d30900731e9c2b2e43f994e054"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#7e1f13090c5e3597d2c8f4d35d069000"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:136"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#7e1f13090c5e3597d2c8f4d35d069000"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:138"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang.proofmode.html#q:139"><span class="id" title="variable">q</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:140"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang.proofmode.html#v:140"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:141"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">vals_compare_safe</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:140"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:141"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#7e1f13090c5e3597d2c8f4d35d069000"><span class="id" title="variable">Δ'</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:137"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">PairV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:140"><span class="id" title="variable">v</span></a> (<span class="id" title="constructor">LitV</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitBool</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:135"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:134"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#707e9817eb00447b460e33c4c17f4b6f"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#989f03d30900731e9c2b2e43f994e054"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:137"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">CmpXchg</span> (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:138"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:141"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v2:142"><span class="id" title="variable">v2</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:135"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:134"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#707e9817eb00447b460e33c4c17f4b6f"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?????.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_cmpxchg_fail"><span class="id" title="lemma">wbwp_cmpxchg_fail</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_cmpxchg_suc" class="idref" href="#tac_wbwp_cmpxchg_suc"><span class="id" title="lemma">tac_wbwp_cmpxchg_suc</span></a> <a id="5fee564226146d676f2841929b460a36" class="idref" href="#5fee564226146d676f2841929b460a36"><span class="id" title="binder">Δ</span></a> <a id="0d62c6459da3c0286c7ada27c2a62c55" class="idref" href="#0d62c6459da3c0286c7ada27c2a62c55"><span class="id" title="binder">Δ'</span></a> <a id="E:146" class="idref" href="#E:146"><span class="id" title="binder">E</span></a> <a id="out:147" class="idref" href="#out:147"><span class="id" title="binder">out</span></a> <a id="i:148" class="idref" href="#i:148"><span class="id" title="binder">i</span></a> <a id="K:149" class="idref" href="#K:149"><span class="id" title="binder">K</span></a> <a id="l:150" class="idref" href="#l:150"><span class="id" title="binder">l</span></a> <a id="v:151" class="idref" href="#v:151"><span class="id" title="binder">v</span></a> <a id="v1:152" class="idref" href="#v1:152"><span class="id" title="binder">v1</span></a> <a id="v2:153" class="idref" href="#v2:153"><span class="id" title="binder">v2</span></a> <a id="9e4db97892cd6c7e883913c5a17e63d6" class="idref" href="#9e4db97892cd6c7e883913c5a17e63d6"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#5fee564226146d676f2841929b460a36"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0d62c6459da3c0286c7ada27c2a62c55"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:148"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#0d62c6459da3c0286c7ada27c2a62c55"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:150"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:151"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang.proofmode.html#v:151"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:152"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">vals_compare_safe</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:151"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:152"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:148"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:148"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#l:150"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v2:153"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.heap_lang.proofmode.html#0d62c6459da3c0286c7ada27c2a62c55"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:149"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">PairV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v:151"><span class="id" title="variable">v</span></a> (<span class="id" title="constructor">LitV</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitBool</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:147"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:146"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#9e4db97892cd6c7e883913c5a17e63d6"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#5fee564226146d676f2841929b460a36"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:149"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">CmpXchg</span> (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:150"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang.proofmode.html#v1:152"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#v2:153"><span class="id" title="variable">v2</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:147"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:146"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#9e4db97892cd6c7e883913c5a17e63d6"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?????; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_cmpxchg_suc"><span class="id" title="lemma">wbwp_cmpxchg_suc</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_faa" class="idref" href="#tac_wbwp_faa"><span class="id" title="lemma">tac_wbwp_faa</span></a> <a id="c2595903ff4964438f355e339bc74b17" class="idref" href="#c2595903ff4964438f355e339bc74b17"><span class="id" title="binder">Δ</span></a> <a id="73f791b2fa670fac0431b6471f9ed8d0" class="idref" href="#73f791b2fa670fac0431b6471f9ed8d0"><span class="id" title="binder">Δ'</span></a> <a id="E:157" class="idref" href="#E:157"><span class="id" title="binder">E</span></a> <a id="out:158" class="idref" href="#out:158"><span class="id" title="binder">out</span></a> <a id="i:159" class="idref" href="#i:159"><span class="id" title="binder">i</span></a> <a id="K:160" class="idref" href="#K:160"><span class="id" title="binder">K</span></a> <a id="l:161" class="idref" href="#l:161"><span class="id" title="binder">l</span></a> <a id="z1:162" class="idref" href="#z1:162"><span class="id" title="binder">z1</span></a> <a id="z2:163" class="idref" href="#z2:163"><span class="id" title="binder">z2</span></a> <a id="2119c4126a491dbded48bda67ab5b79b" class="idref" href="#2119c4126a491dbded48bda67ab5b79b"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang.proofmode.html#c2595903ff4964438f355e339bc74b17"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#73f791b2fa670fac0431b6471f9ed8d0"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:159"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#73f791b2fa670fac0431b6471f9ed8d0"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:161"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#z1:162"><span class="id" title="variable">z1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:159"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#i:159"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#l:161"><span class="id" title="variable">l</span></a> <span class="id" title="notation">↦</span> <span class="id" title="constructor">LitV</span> (<span class="id" title="constructor">LitInt</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#z1:162"><span class="id" title="variable">z1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#z2:163"><span class="id" title="variable">z2</span></a>)))) <a class="idref" href="WBLogic.heap_lang.proofmode.html#73f791b2fa670fac0431b6471f9ed8d0"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:160"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">Val</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#z1:162"><span class="id" title="variable">z1</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:158"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:157"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#2119c4126a491dbded48bda67ab5b79b"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#c2595903ff4964438f355e339bc74b17"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#K:160"><span class="id" title="variable">K</span></a> (<span class="id" title="constructor">FAA</span> (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#l:161"><span class="id" title="variable">l</span></a>) (<span class="id" title="constructor">LitV</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#z2:163"><span class="id" title="variable">z2</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#out:158"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#E:157"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang.proofmode.html#2119c4126a491dbded48bda67ab5b79b"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> (<a class="idref" href="WBLogic.heap_lang.primitive_laws.html#wbwp_faa"><span class="id" title="lemma">wbwp_faa</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">z1</span> <span class="id" title="var">z2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="WBLogic.heap_lang.proofmode.html#heap"><span class="id" title="section">heap</span></a>.<br/>

<br/>
</div>

<div class="doc">
The tactic <span class="inlinecode"><span class="id" title="var">wp_apply_core</span></span> <span class="inlinecode"><span class="id" title="var">lem</span></span> <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">tac_fail</span></span> evaluates <span class="inlinecode"><span class="id" title="var">lem</span></span> to a
hypothesis <span class="inlinecode"><span class="id" title="var">H</span></span> that can be applied, and then runs <span class="inlinecode"><span class="id" title="var">wp_bind_core</span></span> <span class="inlinecode"><span class="id" title="var">K</span>;</span> <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span>
for every possible evaluation context <span class="inlinecode"><span class="id" title="var">K</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> The tactic <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> should do <span class="inlinecode"><span class="id" title="var">iApplyHyp</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> to actually apply the hypothesis,
  but can perform other operations in addition (see <span class="inlinecode"><span class="id" title="var">wp_apply</span></span> and <span class="inlinecode"><span class="id" title="var">awp_apply</span></span>
  below).

</li>
<li> The tactic <span class="inlinecode"><span class="id" title="var">tac_fail</span></span> <span class="inlinecode"><span class="id" title="var">cont</span></span> is called when <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> fails for all evaluation
  contexts <span class="inlinecode"><span class="id" title="var">K</span></span>, and can perform further operations before invoking <span class="inlinecode"><span class="id" title="var">cont</span></span> to
  try again.

</li>
</ul>

<div class="paragraph"> </div>

TC resolution of <span class="inlinecode"><span class="id" title="var">lem</span></span> premises happens *after* <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> got executed. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="var">tac_suc</span> <span class="id" title="var">tac_fail</span> := <span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;[<span class="id" title="var">iPoseProofCore</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">as</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wbwp_bind_core</span> <span class="id" title="var">K</span>; <span class="id" title="var">tac_suc</span> <span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> 1 "wbwp_apply: not a 'wp'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;|<span class="id" title="var">tac_fail</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">wp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="var">tac_suc</span> <span class="id" title="var">tac_fail</span>)<br/>
&nbsp;&nbsp;|<span class="id" title="keyword">let</span> <span class="id" title="var">P</span> := <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">lem</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fail</span> "wbwp_apply: cannot apply" <span class="id" title="var">lem</span> ":" <span class="id" title="var">P</span> ].<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_apply" <span class="id" title="var">open_constr</span>(<span class="id" title="var">lem</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">iApplyHyp</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">iNext</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">wbwp_expr_simpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">cont</span> =&gt; <span class="id" title="tactic">fail</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_smart_apply" <span class="id" title="var">open_constr</span>(<span class="id" title="var">lem</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">iApplyHyp</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">iNext</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">wbwp_expr_simpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">cont</span> =&gt; <span class="id" title="var">wbwp_pure</span> <span class="id" title="var">_</span>; []; <span class="id" title="var">cont</span> ()).<br/>

<br/>
<span class="comment">(*&nbsp;<span class="comment">(**&nbsp;Tactic&nbsp;tailored&nbsp;for&nbsp;atomic&nbsp;triples:&nbsp;the&nbsp;first,&nbsp;simple&nbsp;one&nbsp;just&nbsp;runs&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">iAuIntro</span></span>&nbsp;on&nbsp;the&nbsp;goal,&nbsp;as&nbsp;atomic&nbsp;triples&nbsp;always&nbsp;have&nbsp;an&nbsp;atomic&nbsp;update&nbsp;as&nbsp;their&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;premise.&nbsp;The&nbsp;second&nbsp;one&nbsp;additionaly&nbsp;does&nbsp;some&nbsp;framing:&nbsp;it&nbsp;gets&nbsp;rid&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">Hs</span></span>&nbsp;from&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;the&nbsp;context,&nbsp;reducing&nbsp;clutter.&nbsp;You&nbsp;get&nbsp;them&nbsp;all&nbsp;back&nbsp;in&nbsp;the&nbsp;continuation&nbsp;of&nbsp;the&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;atomic&nbsp;operation.&nbsp;*)</span>&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Tactic&nbsp;Notation&nbsp;"awp_apply"&nbsp;open_constr(lem)&nbsp;:=&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;wp_apply_core&nbsp;lem&nbsp;ltac:(fun&nbsp;H&nbsp;=&gt;&nbsp;iApplyHyp&nbsp;H)&nbsp;ltac:(fun&nbsp;cont&nbsp;=&gt;&nbsp;fail);&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;last&nbsp;iAuIntro.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Tactic&nbsp;Notation&nbsp;"awp_apply"&nbsp;open_constr(lem)&nbsp;"without"&nbsp;constr(Hs)&nbsp;:=&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Convert&nbsp;"list&nbsp;of&nbsp;hypothesis"&nbsp;into&nbsp;specialization&nbsp;pattern.&nbsp;*)</span>&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;let&nbsp;Hs&nbsp;:=&nbsp;words&nbsp;Hs&nbsp;in&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;let&nbsp;Hs&nbsp;:=&nbsp;eval&nbsp;vm_compute&nbsp;in&nbsp;(INamed&nbsp;&lt;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;wp_apply_core&nbsp;lem&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltac:(fun&nbsp;H&nbsp;=&gt;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iApply&nbsp;(wp_frame_wand&nbsp;with&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">SGoal</span></span> <span class="inlinecode">$</span> <span class="inlinecode"><span class="id" title="var">SpecGoal</span></span> <span class="inlinecode"><span class="id" title="var">GSpatial</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span> <span class="inlinecode">[]</span> <span class="inlinecode"><span class="id" title="var">Hs</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span>);&nbsp;<span class="inlinecode"><span class="id" title="var">iAccu</span>|<span class="id" title="var">iApplyHyp</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span>)&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltac:(fun&nbsp;cont&nbsp;=&gt;&nbsp;fail);&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;last&nbsp;iAuIntro.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_alloc" <span class="id" title="var">ident</span>(<span class="id" title="var">l</span>) "as" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Htmp</span> := <span class="id" title="var">iFresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">finish</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> | <span class="id" title="tactic">fail</span> 1 "wbwp_alloc:" <span class="id" title="var">l</span> "not fresh"];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pm_reduce</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="notation">False</span> =&gt; <span class="id" title="tactic">fail</span> 1 "wbwp_alloc:" <span class="id" title="var">H</span> "not fresh"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">iDestructHyp</span> <span class="id" title="var">Htmp</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>; <span class="id" title="var">wbwp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;</div>

<div class="doc">
The code first tries to use allocation lemma for a single reference,
     ie, <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_alloc"><span class="id" title="lemma">tac_wp_alloc</span></a></span> (respectively, <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_alloc"><span class="id" title="lemma">tac_twp_alloc</span></a></span>).
     If that fails, it tries to use the lemma <span class="inlinecode"><span class="id" title="var">tac_wp_allocN</span></span>
     (respectively, <span class="inlinecode"><span class="id" title="var">tac_twp_allocN</span></span>) for allocating an array.
     Notice that we could have used the array allocation lemma also for single
     references. However, that would produce the resource l ↦∗ <span class="inlinecode"><span class="id" title="var">v</span></span> instead of
     l ↦ v for single references. These are logically equivalent assertions
     but are not equal. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">process_single</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_alloc"><span class="id" title="lemma">tac_wbwp_alloc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Htmp</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_alloc: cannot find 'Alloc' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">finish</span> ()]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">process_array</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_allocN"><span class="id" title="lemma">tac_wbwp_allocN</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Htmp</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_alloc: cannot find 'Alloc' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">idtac</span>|<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">finish</span> ()]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span> (<span class="id" title="var">process_single</span> ()) || (<span class="id" title="var">process_array</span> ())<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_alloc: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_alloc" <span class="id" title="var">ident</span>(<span class="id" title="var">l</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_alloc</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> "?".<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_free" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_free: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_free"><span class="id" title="lemma">tac_wbwp_free</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_free: cannot find 'Free' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_free: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_load" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_load: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_load"><span class="id" title="lemma">tac_wbwp_load</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_load: cannot find 'Load' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_load: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_store" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_store: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_store"><span class="id" title="lemma">tac_wbwp_store</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_store: cannot find 'Store' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">first</span> [<span class="id" title="var">wbwp_seq</span>|<span class="id" title="var">wbwp_finish</span>]]<br/>
  | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_store: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_xchg" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_xchg: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_xchg"><span class="id" title="lemma">tac_wbwp_xchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_xchg: cannot find 'Xchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">first</span> [<span class="id" title="var">wbwp_seq</span>|<span class="id" title="var">wbwp_finish</span>]]<br/>
  | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_xchg: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_cmpxchg" "as" <span class="id" title="var">simple_intropattern</span>(<span class="id" title="var">H1</span>) "|" <span class="id" title="var">simple_intropattern</span>(<span class="id" title="var">H2</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_cmpxchg: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_cmpxchg"><span class="id" title="lemma">tac_wbwp_cmpxchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_cmpxchg: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H1</span>; <span class="id" title="var">wbwp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">intros</span> <span class="id" title="var">H2</span>; <span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_cmpxchg: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_cmpxchg_fail" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_cmpxchg_fail: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_cmpxchg_fail"><span class="id" title="lemma">tac_wbwp_cmpxchg_fail</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_cmpxchg_fail: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>) <span class="comment">(*&nbsp;value&nbsp;inequality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_cmpxchg_fail: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_cmpxchg_suc" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_cmpxchg_suc: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_cmpxchg_suc"><span class="id" title="lemma">tac_wbwp_cmpxchg_suc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_cmpxchg_suc: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>) <span class="comment">(*&nbsp;value&nbsp;equality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_cmpxchg_suc: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_faa" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <span class="id" title="notation">↦</span><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_faa: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang.proofmode.html#tac_wbwp_faa"><span class="id" title="lemma">tac_wbwp_faa</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_faa: cannot find 'FAA' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_faa: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
