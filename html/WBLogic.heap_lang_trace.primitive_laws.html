<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../index.html">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">WBLogic.heap_lang_trace.primitive_laws</h1>

<div class="code">
</div>

<div class="doc">
This file proves the basic laws of the HeapLang program logic by applying
the Iris lifting lemmas. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.heap_lang</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">primitive_laws</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">proofmode</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.bi.lib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">fractional</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.base_logic.lib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">mono_nat</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.base_logic.lib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">gen_heap</span> <span class="id" title="library">proph_map</span> <span class="id" title="library">gen_inv_heap</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.program_logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">weakestpre</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.program_logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#"><span class="id" title="library">weakestpre</span></a> <a class="idref" href="WBLogic.program_logic.lifting.html#"><span class="id" title="library">lifting</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.program_logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">ectx_lifting</span> <span class="id" title="library">total_ectx_lifting</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.heap_lang_trace</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="WBLogic.heap_lang_trace.class_instances.html#"><span class="id" title="library">class_instances</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.heap_lang_trace</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="WBLogic.heap_lang_trace.tactics.html#"><span class="id" title="library">tactics</span></a> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#"><span class="id" title="library">notation</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.heap_lang_trace</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#"><span class="id" title="library">trace_resources</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.heap_lang_trace</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#"><span class="id" title="library">lang</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.prelude</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">options</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="wbheapGS" class="idref" href="#wbheapGS"><span class="id" title="record">wbheapGS</span></a> <a id="0101b9beac487b383a5ba2a8f6922788" class="idref" href="#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="binder">Σ</span></a> := <span class="id" title="var">WBHeapGS</span> {<br/>
&nbsp;&nbsp;<a id="wbheapGS_invGS" class="idref" href="#wbheapGS_invGS"><span class="id" title="projection">wbheapGS_invGS</span></a> : <span class="id" title="class">invGS_gen</span> <span class="id" title="constructor">HasLc</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>;<br/>
&nbsp;&nbsp;<a id="wbheapGS_gen_heapGS" class="idref" href="#wbheapGS_gen_heapGS"><span class="id" title="projection">wbheapGS_gen_heapGS</span></a> :: <span class="id" title="class">gen_heapGS</span> <span class="id" title="record">loc</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>;<br/>
&nbsp;&nbsp;<a id="wbheapGS_inv_heapGS" class="idref" href="#wbheapGS_inv_heapGS"><span class="id" title="projection">wbheapGS_inv_heapGS</span></a> :: <span class="id" title="class">inv_heapGS</span> <span class="id" title="record">loc</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>;<br/>
&nbsp;&nbsp;<a id="wbheapGS_proph_mapGS" class="idref" href="#wbheapGS_proph_mapGS"><span class="id" title="projection">wbheapGS_proph_mapGS</span></a> :: <span class="id" title="class">proph_mapGS</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.proph_id"><span class="id" title="definition">proph_id</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>;<br/>
&nbsp;&nbsp;<a id="wbheapGS_step_name" class="idref" href="#wbheapGS_step_name"><span class="id" title="projection">wbheapGS_step_name</span></a> : <span class="id" title="definition">gname</span>;<br/>
&nbsp;&nbsp;<a id="wbheapGS_step_cnt" class="idref" href="#wbheapGS_step_cnt"><span class="id" title="projection">wbheapGS_step_cnt</span></a> : <span class="id" title="class">mono_natG</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>;<br/>
&nbsp;&nbsp;<a id="wbheapGS_gstacksGS" class="idref" href="#wbheapGS_gstacksGS"><span class="id" title="projection">wbheapGS_gstacksGS</span></a> :: <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacksIG"><span class="id" title="class">gstacksIG</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>;<br/>
&nbsp;&nbsp;<a id="wbheapGS_traceGS" class="idref" href="#wbheapGS_traceGS"><span class="id" title="projection">wbheapGS_traceGS</span></a> :: <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#traceGS"><span class="id" title="class">traceGS</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>;<br/>
}.<br/>
<span class="id" title="keyword">Local Existing Instance</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbheapGS_step_cnt"><span class="id" title="method">wbheapGS_step_cnt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="steps" class="idref" href="#steps"><span class="id" title="section">steps</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="wbheapGS0:12" class="idref" href="#wbheapGS0:12"><span class="id" title="binder">!</span></a><a id="wbheapGS0:12" class="idref" href="#wbheapGS0:12"><span class="id" title="binder">wbheapGS</span></a> <a id="0628ce849eb43988c0c2962e2467d294" class="idref" href="#0628ce849eb43988c0c2962e2467d294"><span class="id" title="binder"><span id="wbheapGS0:12" class="id">Σ</span></span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Definition</span> <a id="steps_auth" class="idref" href="#steps_auth"><span class="id" title="definition">steps_auth</span></a> (<a id="n:13" class="idref" href="#n:13"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#59b7e5b4b914c04c4670d445ddddca93"><span class="id" title="variable">Σ</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">mono_nat_auth_own</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbheapGS_step_name"><span class="id" title="method">wbheapGS_step_name</span></a> 1 <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:13"><span class="id" title="variable">n</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="steps_lb" class="idref" href="#steps_lb"><span class="id" title="definition">steps_lb</span></a> (<a id="n:14" class="idref" href="#n:14"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#59b7e5b4b914c04c4670d445ddddca93"><span class="id" title="variable">Σ</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">mono_nat_lb_own</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbheapGS_step_name"><span class="id" title="method">wbheapGS_step_name</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:14"><span class="id" title="variable">n</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Lemma</span> <a id="steps_lb_valid" class="idref" href="#steps_lb_valid"><span class="id" title="lemma">steps_lb_valid</span></a> <a id="n:15" class="idref" href="#n:15"><span class="id" title="binder">n</span></a> <a id="m:16" class="idref" href="#m:16"><span class="id" title="binder">m</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth"><span class="id" title="definition">steps_auth</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:15"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#m:16"><span class="id" title="variable">m</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#m:16"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8.html#3ccab6e0e5cec5d8305913b11c2aa678"><span class="id" title="notation">≤</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:15"><span class="id" title="variable">n</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hauth Hlb".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">mono_nat_lb_own_valid</span> <span class="id" title="notation">with</span> "Hauth Hlb"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %[<span class="id" title="var">_</span> <span class="id" title="var">Hle</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Lemma</span> <a id="steps_lb_get" class="idref" href="#steps_lb_get"><span class="id" title="lemma">steps_lb_get</span></a> <a id="n:17" class="idref" href="#n:17"><span class="id" title="binder">n</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth"><span class="id" title="definition">steps_auth</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:17"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:17"><span class="id" title="variable">n</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">mono_nat_lb_own_get</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Lemma</span> <a id="steps_auth_update" class="idref" href="#steps_auth_update"><span class="id" title="lemma">steps_auth_update</span></a> <a id="n:18" class="idref" href="#n:18"><span class="id" title="binder">n</span></a> <a id="n':19" class="idref" href="#n':19"><span class="id" title="binder">n'</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:18"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8.html#3ccab6e0e5cec5d8305913b11c2aa678"><span class="id" title="notation">≤</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n':19"><span class="id" title="variable">n'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth"><span class="id" title="definition">steps_auth</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:18"><span class="id" title="variable">n</span></a> <span class="id" title="notation">==∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth"><span class="id" title="definition">steps_auth</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n':19"><span class="id" title="variable">n'</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n':19"><span class="id" title="variable">n'</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hle</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">mono_nat_own_update</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Lemma</span> <a id="steps_auth_update_S" class="idref" href="#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <a id="n:20" class="idref" href="#n:20"><span class="id" title="binder">n</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth"><span class="id" title="definition">steps_auth</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:20"><span class="id" title="variable">n</span></a> <span class="id" title="notation">==∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth"><span class="id" title="definition">steps_auth</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:20"><span class="id" title="variable">n</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hauth".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">mono_nat_own_update</span> <span class="id" title="notation">with</span> "Hauth"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ _]"; [<span class="id" title="var">lia</span>|<span class="id" title="var">done</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="steps_lb_le" class="idref" href="#steps_lb_le"><span class="id" title="lemma">steps_lb_le</span></a> <a id="n:21" class="idref" href="#n:21"><span class="id" title="binder">n</span></a> <a id="n':22" class="idref" href="#n':22"><span class="id" title="binder">n'</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n':22"><span class="id" title="variable">n'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8.html#3ccab6e0e5cec5d8305913b11c2aa678"><span class="id" title="notation">≤</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:21"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:21"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n':22"><span class="id" title="variable">n'</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hle</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">mono_nat_lb_own_le</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps"><span class="id" title="section">steps</span></a>.<br/>

<br/>
<span class="id" title="keyword">Global Program Instance</span> <a id="wbheapG_irisG" class="idref" href="#wbheapG_irisG"><span class="id" title="instance">wbheapG_irisG</span></a> `{<a id="wbheapGS0:24" class="idref" href="#wbheapGS0:24"><span class="id" title="binder">!</span></a><a id="wbheapGS0:24" class="idref" href="#wbheapGS0:24"><span class="id" title="binder">wbheapGS</span></a> <a id="3eadb2a0aeaeef49bd6cd27b7316c266" class="idref" href="#3eadb2a0aeaeef49bd6cd27b7316c266"><span class="id" title="binder"><span id="wbheapGS0:24" class="id">Σ</span></span></a>} : <span class="id" title="class">irisGS_gen</span> <span class="id" title="constructor">HasLc</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang"><span class="id" title="definition">heap_lang</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#3eadb2a0aeaeef49bd6cd27b7316c266"><span class="id" title="variable">Σ</span></a> := {<br/>
&nbsp;&nbsp;<span class="id" title="method">iris_invGS</span> := <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbheapGS_invGS"><span class="id" title="method">wbheapGS_invGS</span></a>;<br/>
&nbsp;&nbsp;<span class="id" title="method">state_interp</span> <a id="671d6a60fe91a45440b15b3b4e49a57f" class="idref" href="#671d6a60fe91a45440b15b3b4e49a57f"><span class="id" title="binder">σ</span></a> <a id="step_cnt:26" class="idref" href="#step_cnt:26"><span class="id" title="binder">step_cnt</span></a> <a id="31205b653fdc09d1a66bb6f3fb76d088" class="idref" href="#31205b653fdc09d1a66bb6f3fb76d088"><span class="id" title="binder">κs</span></a> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="definition">gen_heap_interp</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#671d6a60fe91a45440b15b3b4e49a57f"><span class="id" title="variable">σ</span></a>.(<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.heap"><span class="id" title="projection">heap</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_auth"><span class="id" title="definition">trace_auth</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#671d6a60fe91a45440b15b3b4e49a57f"><span class="id" title="variable">σ</span></a>.(<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.trace"><span class="id" title="projection">trace</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <span class="id" title="definition">proph_map_interp</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#31205b653fdc09d1a66bb6f3fb76d088"><span class="id" title="variable">κs</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#671d6a60fe91a45440b15b3b4e49a57f"><span class="id" title="variable">σ</span></a>.(<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.used_proph_id"><span class="id" title="projection">used_proph_id</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth"><span class="id" title="definition">steps_auth</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#step_cnt:26"><span class="id" title="variable">step_cnt</span></a>)%<span class="id" title="var">I</span>;<br/>
&nbsp;&nbsp;<span class="id" title="method">fork_post</span> <span class="id" title="var">_</span> := <span class="id" title="notation">True</span>%<span class="id" title="var">I</span>;<br/>
&nbsp;&nbsp;<span class="id" title="method">num_laters_per_step</span> <a id="n:28" class="idref" href="#n:28"><span class="id" title="binder">n</span></a> := <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:28"><span class="id" title="variable">n</span></a><br/>
}.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?? σ <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>)  "/= ($ &amp; $ &amp; $ &amp; H)".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "H"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "$".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Since we use an <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a></span> <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a></span> instance of <span class="inlinecode"><span class="id" title="library">gen_heap</span></span>, we need to overwrite
the notations.  That also helps for scopes and coercions. 
</div>
<div class="code">
<span class="id" title="keyword">Notation</span> <a id="577098eb17c8bdfdf51b301e275a88bb" class="idref" href="#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">&quot;</span></a>l ↦ dq v" := (<span class="id" title="definition">mapsto</span> (<span class="id" title="var">L</span>:=<span class="id" title="record">loc</span>) (<span class="id" title="var">V</span>:=<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>) <span class="id" title="var">l</span> <span class="id" title="var">dq</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">v</span>%<span class="id" title="var">V</span>))<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20, <span class="id" title="var">dq</span> <span class="id" title="var">custom</span> <span class="id" title="var">dfrac</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 1, <span class="id" title="var">format</span> "l  ↦ dq  v") : <span class="id" title="var">bi_scope</span>.<br/>

<br/>
</div>

<div class="doc">
Same for <span class="inlinecode"><span class="id" title="library">gen_inv_heap</span></span>, except that these are higher-order notations so to
make setoid rewriting in the predicate <span class="inlinecode"><span class="id" title="var">I</span></span> work we need actual definitions
here. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a id="definitions" class="idref" href="#definitions"><span class="id" title="section">definitions</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="wbheapGS0:30" class="idref" href="#wbheapGS0:30"><span class="id" title="binder">!</span></a><a id="wbheapGS0:30" class="idref" href="#wbheapGS0:30"><span class="id" title="binder">wbheapGS</span></a> <a id="b45015ea779d7a6908b541de791ac941" class="idref" href="#b45015ea779d7a6908b541de791ac941"><span class="id" title="binder"><span id="wbheapGS0:30" class="id">Σ</span></span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="inv_mapsto_own" class="idref" href="#inv_mapsto_own"><span class="id" title="definition">inv_mapsto_own</span></a> (<a id="l:31" class="idref" href="#l:31"><span class="id" title="binder">l</span></a> : <span class="id" title="record">loc</span>) (<a id="v:32" class="idref" href="#v:32"><span class="id" title="binder">v</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>) (<a id="I:33" class="idref" href="#I:33"><span class="id" title="binder">I</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#eed89adbadd537e6f335b055deb22ab5"><span class="id" title="variable">Σ</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">inv_mapsto_own</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:31"><span class="id" title="variable">l</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:32"><span class="id" title="variable">v</span></a>) (<span class="id" title="definition">from_option</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:33"><span class="id" title="variable">I</span></a> <span class="id" title="notation">False</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="inv_mapsto" class="idref" href="#inv_mapsto"><span class="id" title="definition">inv_mapsto</span></a> (<a id="l:34" class="idref" href="#l:34"><span class="id" title="binder">l</span></a> : <span class="id" title="record">loc</span>) (<a id="I:35" class="idref" href="#I:35"><span class="id" title="binder">I</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#eed89adbadd537e6f335b055deb22ab5"><span class="id" title="variable">Σ</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">inv_mapsto</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:34"><span class="id" title="variable">l</span></a> (<span class="id" title="definition">from_option</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:35"><span class="id" title="variable">I</span></a> <span class="id" title="notation">False</span>).<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#definitions"><span class="id" title="section">definitions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a> (@<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto_own"><span class="id" title="definition">inv_mapsto_own</span></a>) 4 := {}.<br/>
<span class="id" title="keyword">Global Instance</span>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a> (@<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto"><span class="id" title="definition">inv_mapsto</span></a>) 3 := {}.<br/>

<br/>
<span class="id" title="keyword">Notation</span> <a id="inv_heap_inv" class="idref" href="#inv_heap_inv"><span class="id" title="abbreviation">inv_heap_inv</span></a> := (<span class="id" title="definition">inv_heap_inv</span> <span class="id" title="record">loc</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>)).<br/>
<span class="id" title="keyword">Notation</span> <a id="bf0d9bbf7b350f262bc2d3aeb5afeaf1" class="idref" href="#bf0d9bbf7b350f262bc2d3aeb5afeaf1"><span class="id" title="notation">&quot;</span></a>l '↦_' I □" := (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto"><span class="id" title="definition">inv_mapsto</span></a> <span class="id" title="var">l</span> <span class="id" title="var">I</span>%<span class="id" title="var">stdpp</span>%<span class="id" title="keyword">type</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20, <span class="id" title="var">I</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="var">format</span> "l  '↦_' I  '□'") : <span class="id" title="var">bi_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> <a id="017e3302e3dfba6f9234fe10d3ecb417" class="idref" href="#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">&quot;</span></a>l ↦_ I v" := (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto_own"><span class="id" title="definition">inv_mapsto_own</span></a> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">I</span>%<span class="id" title="var">stdpp</span>%<span class="id" title="keyword">type</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20, <span class="id" title="var">I</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 9, <span class="id" title="var">format</span> "l  ↦_ I  v") : <span class="id" title="var">bi_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="lifting" class="idref" href="#lifting"><span class="id" title="section">lifting</span></a>.<br/>
<span class="id" title="keyword">Context</span> `{<a id="wbheapGS0:37" class="idref" href="#wbheapGS0:37"><span class="id" title="binder">!</span></a><a id="wbheapGS0:37" class="idref" href="#wbheapGS0:37"><span class="id" title="binder">wbheapGS</span></a> <a id="06f02a2e1ae1dbc558fdd78ca814765d" class="idref" href="#06f02a2e1ae1dbc558fdd78ca814765d"><span class="id" title="binder"><span id="wbheapGS0:37" class="id">Σ</span></span></a>}.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#3f5501ec6239ef23d42bb010db261e47"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Φ</span> <span class="id" title="var">Ψ</span> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#3f5501ec6239ef23d42bb010db261e47"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">efs</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.expr"><span class="id" title="inductive">expr</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> σ : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.state"><span class="id" title="record">state</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">l</span> : <span class="id" title="record">loc</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_lb_init" class="idref" href="#wp_lb_init"><span class="id" title="lemma">wp_lb_init</span></a> <a id="s:38" class="idref" href="#s:38"><span class="id" title="binder">s</span></a> <a id="E:39" class="idref" href="#E:39"><span class="id" title="binder">E</span></a> <a id="e:40" class="idref" href="#e:40"><span class="id" title="binder">e</span></a> <a id="41d18e8a2b2e573b496086c21c3c16d4" class="idref" href="#41d18e8a2b2e573b496086c21c3c16d4"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">TCEq</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:40"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> 0 <span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:40"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:38"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:39"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a id="v:42" class="idref" href="#v:42"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#41d18e8a2b2e573b496086c21c3c16d4"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:42"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}}</span><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:40"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:38"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:39"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#41d18e8a2b2e573b496086c21c3c16d4"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
</div>

<div class="doc">
TODO: We should try to use a generic lifting lemma (and avoid <span class="inlinecode"><span class="id" title="lemma">wp_unfold</span></span>)
  here, since this breaks the WP abstraction. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">wp_unfold</span> /<span class="id" title="definition">wp_pre</span> /=. <span class="id" title="var">iIntros</span> (-&gt;) "Hwp".<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">m</span>) "(Hσ &amp; Ht &amp; Hκ &amp; Hsteps)".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb_get"><span class="id" title="lemma">steps_lb_get</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "#Hlb".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb_le"><span class="id" title="lemma">steps_lb_le</span></a> <span class="id" title="var">_</span> 0 <span class="id" title="notation">with</span> "Hlb"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hlb0"; [<span class="id" title="var">lia</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iSpecialize</span> <span class="id" title="notation">(</span>"Hwp" <span class="id" title="notation">with</span> "Hlb0"<span class="id" title="notation">)</span>. <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span>"Hwp" <span class="id" title="notation">$!</span> σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">m</span><span class="id" title="notation">)</span>. <span class="id" title="var">iFrame</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_lb_update" class="idref" href="#wp_lb_update"><span class="id" title="lemma">wp_lb_update</span></a> <a id="s:43" class="idref" href="#s:43"><span class="id" title="binder">s</span></a> <a id="n:44" class="idref" href="#n:44"><span class="id" title="binder">n</span></a> <a id="E:45" class="idref" href="#E:45"><span class="id" title="binder">E</span></a> <a id="e:46" class="idref" href="#e:46"><span class="id" title="binder">e</span></a> <a id="001faddda1c74c479de748020de17f40" class="idref" href="#001faddda1c74c479de748020de17f40"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">TCEq</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:46"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:44"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:46"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:43"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:45"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a id="v:48" class="idref" href="#v:48"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:44"><span class="id" title="variable">n</span></a>) <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#001faddda1c74c479de748020de17f40"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:48"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}}</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:46"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:43"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:45"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#001faddda1c74c479de748020de17f40"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
</div>

<div class="doc">
TODO: We should try to use a generic lifting lemma (and avoid <span class="inlinecode"><span class="id" title="lemma">wp_unfold</span></span>)
  here, since this breaks the WP abstraction. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">wp_unfold</span> /<span class="id" title="definition">wp_pre</span> /=. <span class="id" title="var">iIntros</span> (-&gt;) "Hlb Hwp".<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">m</span>) "(Hσ &amp; Ht &amp; Hκ &amp; Hsteps)".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb_valid"><span class="id" title="lemma">steps_lb_valid</span></a> <span class="id" title="notation">with</span> "Hsteps Hlb"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"Hwp" <span class="id" title="notation">$!</span> σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">m</span> <span class="id" title="notation">with</span> "[$Hσ $Ht $Hκ $Hsteps]"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[%Hs Hwp]".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iSplit</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">e2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>) "Hcred".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"Hwp" <span class="id" title="notation">with</span> "[//] Hcred"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hwp".<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt; !&gt;". <span class="id" title="var">iMod</span> "Hwp" <span class="id" title="keyword">as</span> "Hwp". <span class="id" title="var">iIntros</span> "!&gt;".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">step_fupdN_wand</span> <span class="id" title="notation">with</span> "Hwp"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hwp". <span class="id" title="var">iMod</span> "Hwp" <span class="id" title="keyword">as</span> "(($ &amp; $ &amp; $ &amp; Hsteps)&amp; Hwp &amp; $)".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb_get"><span class="id" title="lemma">steps_lb_get</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "#HlbS".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb_le"><span class="id" title="lemma">steps_lb_le</span></a> <span class="id" title="var">_</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">n</span>) <span class="id" title="notation">with</span> "HlbS"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "#HlbS'"; [<span class="id" title="var">lia</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">wp_wand</span> <span class="id" title="notation">with</span> "Hwp"<span class="id" title="notation">)</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span>) "HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_step_fupdN_lb" class="idref" href="#wp_step_fupdN_lb"><span class="id" title="lemma">wp_step_fupdN_lb</span></a> <a id="s:49" class="idref" href="#s:49"><span class="id" title="binder">s</span></a> <a id="n:50" class="idref" href="#n:50"><span class="id" title="binder">n</span></a> <a id="E1:51" class="idref" href="#E1:51"><span class="id" title="binder">E1</span></a> <a id="E2:52" class="idref" href="#E2:52"><span class="id" title="binder">E2</span></a> <a id="e:53" class="idref" href="#e:53"><span class="id" title="binder">e</span></a> <a id="P:54" class="idref" href="#P:54"><span class="id" title="binder">P</span></a> <a id="5cba7004d58c60b6de2180ca4e67d07a" class="idref" href="#5cba7004d58c60b6de2180ca4e67d07a"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">TCEq</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:53"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E2:52"><span class="id" title="variable">E2</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:51"><span class="id" title="variable">E1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:50"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">|={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:51"><span class="id" title="variable">E1</span></a><span class="id" title="notation">∖</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E2:52"><span class="id" title="variable">E2</span></a><span class="id" title="notation">,</span><span class="id" title="notation">∅</span><span class="id" title="notation">}=&gt;</span> <span class="id" title="notation">|={</span><span class="id" title="notation">∅</span><span class="id" title="notation">}▷=&gt;^(</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:50"><span class="id" title="variable">n</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">|={</span><span class="id" title="notation">∅</span><span class="id" title="notation">,</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:51"><span class="id" title="variable">E1</span></a><span class="id" title="notation">∖</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E2:52"><span class="id" title="variable">E2</span></a><span class="id" title="notation">}=&gt;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#P:54"><span class="id" title="variable">P</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:53"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:49"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E2:52"><span class="id" title="variable">E2</span></a> <span class="id" title="notation">{{</span> <a id="v:56" class="idref" href="#v:56"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#P:54"><span class="id" title="variable">P</span></a> <span class="id" title="notation">={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:51"><span class="id" title="variable">E1</span></a><span class="id" title="notation">}=∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#5cba7004d58c60b6de2180ca4e67d07a"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:56"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}}</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:53"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:49"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:51"><span class="id" title="variable">E1</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#5cba7004d58c60b6de2180ca4e67d07a"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">He</span> <span class="id" title="var">HE</span>) "Hlb HP Hwp".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">wp_step_fupdN</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; [|<span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(? &amp; ? &amp; ? &amp; Hsteps)".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb_valid"><span class="id" title="lemma">steps_lb_valid</span></a> <span class="id" title="notation">with</span> "Hsteps Hlb"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %<span class="id" title="var">Hle</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">fupd_mask_intro</span>; [<span class="id" title="var">set_solver</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "_". <span class="id" title="var">iPureIntro</span>. <span class="id" title="tactic">rewrite</span> /<span class="id" title="method">num_laters_per_step</span> /=. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Recursive functions: we do not use this lemmas as it is easier to use Löb
induction directly, but this demonstrates that we can state the expected
reasoning principle for recursive functions, without any visible ▷. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="43d40b776d7952fd7432b25ad19921f8" class="idref" href="#43d40b776d7952fd7432b25ad19921f8"><span class="id" title="lemma">wp_rec_löb</span></a> <a id="s:57" class="idref" href="#s:57"><span class="id" title="binder">s</span></a> <a id="E:58" class="idref" href="#E:58"><span class="id" title="binder">E</span></a> <a id="f:59" class="idref" href="#f:59"><span class="id" title="binder">f</span></a> <a id="x:60" class="idref" href="#x:60"><span class="id" title="binder">x</span></a> <a id="e:61" class="idref" href="#e:61"><span class="id" title="binder">e</span></a> <a id="071e8b4be4ab41d34ad0a9516fe03a12" class="idref" href="#071e8b4be4ab41d34ad0a9516fe03a12"><span class="id" title="binder">Φ</span></a> <a id="b26df13187901ed22d4f6c91c7902d37" class="idref" href="#b26df13187901ed22d4f6c91c7902d37"><span class="id" title="binder">Ψ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">□</span> <span class="id" title="notation">(</span> <span class="id" title="notation">□</span> <span class="id" title="notation">(</span><span class="id" title="notation">∀</span> <a id="v:64" class="idref" href="#v:64"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#b26df13187901ed22d4f6c91c7902d37"><span class="id" title="variable">Ψ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:64"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#f:59"><span class="id" title="variable">f</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#x:60"><span class="id" title="variable">x</span></a> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:61"><span class="id" title="variable">e</span></a>)%<span class="id" title="var">V</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:64"><span class="id" title="variable">v</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:57"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:58"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#071e8b4be4ab41d34ad0a9516fe03a12"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∀</span> <a id="v:65" class="idref" href="#v:65"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#b26df13187901ed22d4f6c91c7902d37"><span class="id" title="variable">Ψ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:65"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.subst'"><span class="id" title="definition">subst'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#x:60"><span class="id" title="variable">x</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:65"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.subst'"><span class="id" title="definition">subst'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#f:59"><span class="id" title="variable">f</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#f:59"><span class="id" title="variable">f</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#x:60"><span class="id" title="variable">x</span></a> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:61"><span class="id" title="variable">e</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:61"><span class="id" title="variable">e</span></a>)<span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:57"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:58"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#071e8b4be4ab41d34ad0a9516fe03a12"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">∀</span> <a id="v:66" class="idref" href="#v:66"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#b26df13187901ed22d4f6c91c7902d37"><span class="id" title="variable">Ψ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:66"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#f:59"><span class="id" title="variable">f</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#x:60"><span class="id" title="variable">x</span></a> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:61"><span class="id" title="variable">e</span></a>)%<span class="id" title="var">V</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:66"><span class="id" title="variable">v</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:57"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:58"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#071e8b4be4ab41d34ad0a9516fe03a12"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hrec". <span class="id" title="var">iLöb</span> <span class="id" title="keyword">as</span> "IH". <span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span>) "HΨ".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">lifting.wp_pure_step_later</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt; _". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span>"Hrec" <span class="id" title="notation">with</span> "[] HΨ"<span class="id" title="notation">)</span>. <span class="id" title="var">iIntros</span> "!&gt;" (<span class="id" title="var">w</span>) "HΨ".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span>"IH" <span class="id" title="notation">with</span> "HΨ"<span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Specification for <span class="inlinecode"><span class="id" title="var">emit</span></span>. Adds an event to the trace. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="wp_emit" class="idref" href="#wp_emit"><span class="id" title="lemma">wp_emit</span></a> <a id="s:67" class="idref" href="#s:67"><span class="id" title="binder">s</span></a> <a id="E:68" class="idref" href="#E:68"><span class="id" title="binder">E</span></a> <a id="tr:69" class="idref" href="#tr:69"><span class="id" title="binder">tr</span></a> <a id="v:70" class="idref" href="#v:70"><span class="id" title="binder">v</span></a> <a id="N:71" class="idref" href="#N:71"><span class="id" title="binder">N</span></a> (<a id="I:72" class="idref" href="#I:72"><span class="id" title="binder">I</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="notation">↑</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#N:71"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:68"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:72"><span class="id" title="variable">I</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:69"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:70"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_is"><span class="id" title="definition">trace_is</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:69"><span class="id" title="variable">tr</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_inv"><span class="id" title="definition">trace_inv</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#N:71"><span class="id" title="variable">N</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:72"><span class="id" title="variable">I</span></a> <span class="id" title="notation">}}}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Emit"><span class="id" title="constructor">Emit</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:70"><span class="id" title="variable">v</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:67"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:68"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">RET</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a><span class="id" title="notation">);</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_is"><span class="id" title="definition">trace_is</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:69"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:70"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Hι</span> <span class="id" title="var">HI</span> φ) "[Ht Hi] Hφ".<br/>
&nbsp;&nbsp;<span class="id" title="var">iInv</span> "Hi" <span class="id" title="keyword">as</span> "&gt;Hi" "Hclose".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hi" <span class="id" title="keyword">as</span> (<span class="id" title="var">tr'</span>) "[Htr' _]".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_half_frag_agree"><span class="id" title="lemma">trace_half_frag_agree</span></a> <span class="id" title="notation">with</span> "Htr' Ht"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %-&gt;.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">wp_lift_atomic_head_step</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 ? <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">n</span>) "(? &amp; Hta &amp; ? &amp; Hsteps) !&gt;";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iNext</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>) "_"; <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_agree"><span class="id" title="lemma">trace_agree</span></a> <span class="id" title="notation">with</span> "Hta Ht"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %&lt;-.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_add_event"><span class="id" title="lemma">trace_add_event</span></a> <span class="id" title="notation">with</span> "Hta Ht Htr'"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "(Hta&amp;Ht&amp;Htr')".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iSplitL</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"Hclose" <span class="id" title="notation">with</span> "[Htr']"<span class="id" title="notation">)</span>. { <span class="id" title="var">iNext</span>. <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hφ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Specification for <span class="inlinecode"><span class="id" title="tactic">fresh</span></span>. Emits an event annotated with a fresh tag. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="wp_fresh" class="idref" href="#wp_fresh"><span class="id" title="lemma">wp_fresh</span></a> <a id="s:73" class="idref" href="#s:73"><span class="id" title="binder">s</span></a> <a id="E:74" class="idref" href="#E:74"><span class="id" title="binder">E</span></a> <a id="tr:75" class="idref" href="#tr:75"><span class="id" title="binder">tr</span></a> <a id="v:76" class="idref" href="#v:76"><span class="id" title="binder">v</span></a> <a id="N:77" class="idref" href="#N:77"><span class="id" title="binder">N</span></a> (<a id="I:78" class="idref" href="#I:78"><span class="id" title="binder">I</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="notation">↑</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#N:77"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:74"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">(</span></a><a id="tag:79" class="idref" href="#tag:79"><span class="id" title="binder">tag</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">),</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:79"><span class="id" title="variable">tag</span></a> <span class="id" title="notation">∉</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.tags"><span class="id" title="definition">tags</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:75"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:78"><span class="id" title="variable">I</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:75"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:79"><span class="id" title="variable">tag</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:76"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">)</span></a>%<span class="id" title="var">V</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_is"><span class="id" title="definition">trace_is</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:75"><span class="id" title="variable">tr</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_inv"><span class="id" title="definition">trace_inv</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#N:77"><span class="id" title="variable">N</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:78"><span class="id" title="variable">I</span></a> <span class="id" title="notation">}}}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Fresh"><span class="id" title="constructor">Fresh</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:76"><span class="id" title="variable">v</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:73"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:74"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">(</span><a id="tag:80" class="idref" href="#tag:80"><span class="id" title="binder">tag</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a><span class="id" title="notation">),</span> <span class="id" title="notation">RET</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:80"><span class="id" title="variable">tag</span></a><span class="id" title="notation">);</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_is"><span class="id" title="definition">trace_is</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:75"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:80"><span class="id" title="variable">tag</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:76"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">)</span></a>%<span class="id" title="var">V</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <span class="id" title="notation">∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:80"><span class="id" title="variable">tag</span></a> <span class="id" title="notation">∉</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.tags"><span class="id" title="definition">tags</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:75"><span class="id" title="variable">tr</span></a><span class="id" title="notation">⌝</span><span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Hι</span> <span class="id" title="var">HI</span> φ) "[Ht Hi] Hφ".<br/>
&nbsp;&nbsp;<span class="id" title="var">iInv</span> "Hi" <span class="id" title="keyword">as</span> "&gt;Hi" "Hclose".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hi" <span class="id" title="keyword">as</span> (<span class="id" title="var">tr'</span>) "[Htr' _]".<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_half_frag_agree"><span class="id" title="lemma">trace_half_frag_agree</span></a> <span class="id" title="notation">with</span> "Htr' Ht"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %-&gt;.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">wp_lift_atomic_head_step</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 ? <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">n</span>) "(? &amp; Hta &amp; ? &amp; Hsteps) !&gt;".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="method">infinite_is_fresh</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.tags"><span class="id" title="definition">tags</span></a> σ1.(<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.trace"><span class="id" title="projection">trace</span></a>))).<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; [ <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span> |]. <span class="id" title="var">iNext</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>) "_"; <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_agree"><span class="id" title="lemma">trace_agree</span></a> <span class="id" title="notation">with</span> "Hta Ht"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %&lt;-.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_add_event"><span class="id" title="lemma">trace_add_event</span></a> <span class="id" title="notation">with</span> "Hta Ht Htr'"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "(Hta &amp; Ht &amp; Htr')".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iSplitL</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"Hclose" <span class="id" title="notation">with</span> "[Htr']"<span class="id" title="notation">)</span>. { <span class="id" title="var">iNext</span>. <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iApply</span> "Hφ". <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Fork: Not using Texan triples to avoid some unnecessary <span class="inlinecode"><span class="id" title="var">True</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="wp_fork" class="idref" href="#wp_fork"><span class="id" title="lemma">wp_fork</span></a> <a id="s:81" class="idref" href="#s:81"><span class="id" title="binder">s</span></a> <a id="E:82" class="idref" href="#E:82"><span class="id" title="binder">E</span></a> <a id="e:83" class="idref" href="#e:83"><span class="id" title="binder">e</span></a> <a id="310360860ff83e40e0e11299ab1f4905" class="idref" href="#310360860ff83e40e0e11299ab1f4905"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">▷</span> <span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:83"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:81"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <span class="id" title="notation">⊤</span> <span class="id" title="notation">{{</span> <span class="id" title="var">_</span><span class="id" title="notation">,</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}}</span> <span class="id" title="notation">-∗</span> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#310360860ff83e40e0e11299ab1f4905"><span class="id" title="variable">Φ</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a>) <span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Fork"><span class="id" title="constructor">Fork</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:83"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:81"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:82"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#310360860ff83e40e0e11299ab1f4905"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "He HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">wp_lift_atomic_head_step</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(?&amp;?&amp;?&amp;Hsteps) !&gt;"; <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;" (<span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>) "_"; <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_fork" class="idref" href="#twp_fork"><span class="id" title="lemma">twp_fork</span></a> <a id="s:85" class="idref" href="#s:85"><span class="id" title="binder">s</span></a> <a id="E:86" class="idref" href="#E:86"><span class="id" title="binder">E</span></a> <a id="e:87" class="idref" href="#e:87"><span class="id" title="binder">e</span></a> <a id="e05567719bace2504f16ae8fb46148a7" class="idref" href="#e05567719bace2504f16ae8fb46148a7"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:87"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:85"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <span class="id" title="notation">⊤</span> <span class="id" title="notation">[{</span> <span class="id" title="var">_</span><span class="id" title="notation">,</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}]</span> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e05567719bace2504f16ae8fb46148a7"><span class="id" title="variable">Φ</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a>) <span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Fork"><span class="id" title="constructor">Fork</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:87"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:85"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:86"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e05567719bace2504f16ae8fb46148a7"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "He HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(?&amp;?&amp;?&amp;Hsteps) !&gt;"; <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Heap 
<div class="paragraph"> </div>

 We need to adjust the <span class="inlinecode"><span class="id" title="library">gen_heap</span></span> and <span class="inlinecode"><span class="id" title="library">gen_inv_heap</span></span> lemmas because of our
value type being <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a></span> <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="mapsto_valid" class="idref" href="#mapsto_valid"><span class="id" title="lemma">mapsto_valid</span></a> <a id="l:89" class="idref" href="#l:89"><span class="id" title="binder">l</span></a> <a id="dq:90" class="idref" href="#dq:90"><span class="id" title="binder">dq</span></a> <a id="v:91" class="idref" href="#v:91"><span class="id" title="binder">v</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:89"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:90"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:91"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><span class="id" title="notation">✓</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:90"><span class="id" title="variable">dq</span></a><span class="id" title="notation">⌝</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">mapsto_valid</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="mapsto_valid_2" class="idref" href="#mapsto_valid_2"><span class="id" title="lemma">mapsto_valid_2</span></a> <a id="l:92" class="idref" href="#l:92"><span class="id" title="binder">l</span></a> <a id="dq1:93" class="idref" href="#dq1:93"><span class="id" title="binder">dq1</span></a> <a id="dq2:94" class="idref" href="#dq2:94"><span class="id" title="binder">dq2</span></a> <a id="v1:95" class="idref" href="#v1:95"><span class="id" title="binder">v1</span></a> <a id="v2:96" class="idref" href="#v2:96"><span class="id" title="binder">v2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:92"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq1:93"><span class="id" title="variable">dq1</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:95"><span class="id" title="variable">v1</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:92"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq2:94"><span class="id" title="variable">dq2</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:96"><span class="id" title="variable">v2</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><span class="id" title="notation">✓</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq1:93"><span class="id" title="variable">dq1</span></a> <span class="id" title="notation">⋅</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq2:94"><span class="id" title="variable">dq2</span></a><span class="id" title="notation">)</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#3668992ecc3e95973d304a75a28051a2"><span class="id" title="notation">∧</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:95"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:96"><span class="id" title="variable">v2</span></a><span class="id" title="notation">⌝</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "H1 H2". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">mapsto_valid_2</span> <span class="id" title="notation">with</span> "H1 H2"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %[? [= ?]]. <span class="id" title="var">done</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="mapsto_agree" class="idref" href="#mapsto_agree"><span class="id" title="lemma">mapsto_agree</span></a> <a id="l:97" class="idref" href="#l:97"><span class="id" title="binder">l</span></a> <a id="dq1:98" class="idref" href="#dq1:98"><span class="id" title="binder">dq1</span></a> <a id="dq2:99" class="idref" href="#dq2:99"><span class="id" title="binder">dq2</span></a> <a id="v1:100" class="idref" href="#v1:100"><span class="id" title="binder">v1</span></a> <a id="v2:101" class="idref" href="#v2:101"><span class="id" title="binder">v2</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:97"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq1:98"><span class="id" title="variable">dq1</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:100"><span class="id" title="variable">v1</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:97"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq2:99"><span class="id" title="variable">dq2</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:101"><span class="id" title="variable">v2</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:100"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:101"><span class="id" title="variable">v2</span></a><span class="id" title="notation">⌝</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> "H1 H2". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">mapsto_agree</span> <span class="id" title="notation">with</span> "H1 H2"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %[= ?]. <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="mapsto_combine" class="idref" href="#mapsto_combine"><span class="id" title="lemma">mapsto_combine</span></a> <a id="l:102" class="idref" href="#l:102"><span class="id" title="binder">l</span></a> <a id="dq1:103" class="idref" href="#dq1:103"><span class="id" title="binder">dq1</span></a> <a id="dq2:104" class="idref" href="#dq2:104"><span class="id" title="binder">dq2</span></a> <a id="v1:105" class="idref" href="#v1:105"><span class="id" title="binder">v1</span></a> <a id="v2:106" class="idref" href="#v2:106"><span class="id" title="binder">v2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:102"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq1:103"><span class="id" title="variable">dq1</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:105"><span class="id" title="variable">v1</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:102"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq2:104"><span class="id" title="variable">dq2</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:106"><span class="id" title="variable">v2</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:102"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq1:103"><span class="id" title="variable">dq1</span></a> <span class="id" title="notation">⋅</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq2:104"><span class="id" title="variable">dq2</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:105"><span class="id" title="variable">v1</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:105"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:106"><span class="id" title="variable">v2</span></a><span class="id" title="notation">⌝</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hl1 Hl2". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">mapsto_combine</span> <span class="id" title="notation">with</span> "Hl1 Hl2"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ Heq]".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iDestruct</span> "Heq" <span class="id" title="keyword">as</span> %[= -&gt;].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="mapsto_frac_ne" class="idref" href="#mapsto_frac_ne"><span class="id" title="lemma">mapsto_frac_ne</span></a> <a id="l1:107" class="idref" href="#l1:107"><span class="id" title="binder">l1</span></a> <a id="l2:108" class="idref" href="#l2:108"><span class="id" title="binder">l2</span></a> <a id="dq1:109" class="idref" href="#dq1:109"><span class="id" title="binder">dq1</span></a> <a id="dq2:110" class="idref" href="#dq2:110"><span class="id" title="binder">dq2</span></a> <a id="v1:111" class="idref" href="#v1:111"><span class="id" title="binder">v1</span></a> <a id="v2:112" class="idref" href="#v2:112"><span class="id" title="binder">v2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#b02645851bc60f28087c4c8d90376442"><span class="id" title="notation">¬</span></a> <span class="id" title="notation">✓(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq1:109"><span class="id" title="variable">dq1</span></a> <span class="id" title="notation">⋅</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq2:110"><span class="id" title="variable">dq2</span></a><span class="id" title="notation">)</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l1:107"><span class="id" title="variable">l1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq1:109"><span class="id" title="variable">dq1</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:111"><span class="id" title="variable">v1</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l2:108"><span class="id" title="variable">l2</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq2:110"><span class="id" title="variable">dq2</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:112"><span class="id" title="variable">v2</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l1:107"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l2:108"><span class="id" title="variable">l2</span></a><span class="id" title="notation">⌝</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">mapsto_frac_ne</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="mapsto_ne" class="idref" href="#mapsto_ne"><span class="id" title="lemma">mapsto_ne</span></a> <a id="l1:113" class="idref" href="#l1:113"><span class="id" title="binder">l1</span></a> <a id="l2:114" class="idref" href="#l2:114"><span class="id" title="binder">l2</span></a> <a id="dq2:115" class="idref" href="#dq2:115"><span class="id" title="binder">dq2</span></a> <a id="v1:116" class="idref" href="#v1:116"><span class="id" title="binder">v1</span></a> <a id="v2:117" class="idref" href="#v2:117"><span class="id" title="binder">v2</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l1:113"><span class="id" title="variable">l1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:116"><span class="id" title="variable">v1</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l2:114"><span class="id" title="variable">l2</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq2:115"><span class="id" title="variable">dq2</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:117"><span class="id" title="variable">v2</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l1:113"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l2:114"><span class="id" title="variable">l2</span></a><span class="id" title="notation">⌝</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">mapsto_ne</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="mapsto_persist" class="idref" href="#mapsto_persist"><span class="id" title="lemma">mapsto_persist</span></a> <a id="l:118" class="idref" href="#l:118"><span class="id" title="binder">l</span></a> <a id="dq:119" class="idref" href="#dq:119"><span class="id" title="binder">dq</span></a> <a id="v:120" class="idref" href="#v:120"><span class="id" title="binder">v</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:118"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:119"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:120"><span class="id" title="variable">v</span></a> <span class="id" title="notation">==∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:118"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">□</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:120"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">mapsto_persist</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a id="inv_mapsto_own_proper" class="idref" href="#inv_mapsto_own_proper"><span class="id" title="instance">inv_mapsto_own_proper</span></a> <a id="l:121" class="idref" href="#l:121"><span class="id" title="binder">l</span></a> <a id="v:122" class="idref" href="#v:122"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#Proper"><span class="id" title="class">Proper</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#pointwise_relation"><span class="id" title="definition">pointwise_relation</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#iff"><span class="id" title="definition">iff</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#8dc5652698a6e16f72dd37bd17d3b973"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="notation">(≡)</span>) (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto_own"><span class="id" title="definition">inv_mapsto_own</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:121"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:122"><span class="id" title="variable">v</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">I1</span> <span class="id" title="var">I2</span> <span class="id" title="var">HI</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto_own"><span class="id" title="definition">inv_mapsto_own</span></a>. <span class="id" title="var">f_equiv</span>=&gt;-[<span class="id" title="var">w</span>|]; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">HI</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Global Instance</span> <a id="inv_mapsto_proper" class="idref" href="#inv_mapsto_proper"><span class="id" title="instance">inv_mapsto_proper</span></a> <a id="l:123" class="idref" href="#l:123"><span class="id" title="binder">l</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#Proper"><span class="id" title="class">Proper</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#pointwise_relation"><span class="id" title="definition">pointwise_relation</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#iff"><span class="id" title="definition">iff</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#8dc5652698a6e16f72dd37bd17d3b973"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="notation">(≡)</span>) (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto"><span class="id" title="definition">inv_mapsto</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:123"><span class="id" title="variable">l</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">I1</span> <span class="id" title="var">I2</span> <span class="id" title="var">HI</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto"><span class="id" title="definition">inv_mapsto</span></a>. <span class="id" title="var">f_equiv</span>=&gt;-[<span class="id" title="var">w</span>|]; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">HI</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_inv_mapsto" class="idref" href="#make_inv_mapsto"><span class="id" title="lemma">make_inv_mapsto</span></a> <a id="l:124" class="idref" href="#l:124"><span class="id" title="binder">l</span></a> <a id="v:125" class="idref" href="#v:125"><span class="id" title="binder">v</span></a> (<a id="I:126" class="idref" href="#I:126"><span class="id" title="binder">I</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) <a id="E:127" class="idref" href="#E:127"><span class="id" title="binder">E</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:127"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:126"><span class="id" title="variable">I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:125"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_heap_inv"><span class="id" title="abbreviation">inv_heap_inv</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:124"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:125"><span class="id" title="variable">v</span></a> <span class="id" title="notation">={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:127"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:124"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">↦</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">_I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:125"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (??) "#HI Hl". <span class="id" title="var">iApply</span> <span class="id" title="lemma">make_inv_mapsto</span>; <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="inv_mapsto_own_inv" class="idref" href="#inv_mapsto_own_inv"><span class="id" title="lemma">inv_mapsto_own_inv</span></a> <a id="l:128" class="idref" href="#l:128"><span class="id" title="binder">l</span></a> <a id="v:129" class="idref" href="#v:129"><span class="id" title="binder">v</span></a> <a id="I:130" class="idref" href="#I:130"><span class="id" title="binder">I</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:128"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">↦</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">_I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:129"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:128"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#bf0d9bbf7b350f262bc2d3aeb5afeaf1"><span class="id" title="notation">↦</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#bf0d9bbf7b350f262bc2d3aeb5afeaf1"><span class="id" title="notation">_I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#bf0d9bbf7b350f262bc2d3aeb5afeaf1"><span class="id" title="notation">□</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">inv_mapsto_own_inv</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="inv_mapsto_own_acc_strong" class="idref" href="#inv_mapsto_own_acc_strong"><span class="id" title="lemma">inv_mapsto_own_acc_strong</span></a> <a id="E:131" class="idref" href="#E:131"><span class="id" title="binder">E</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:131"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_heap_inv"><span class="id" title="abbreviation">inv_heap_inv</span></a> <span class="id" title="notation">={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:131"><span class="id" title="variable">E</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:131"><span class="id" title="variable">E</span></a> <span class="id" title="notation">∖</span> <span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span><span class="id" title="notation">}=∗</span> <span class="id" title="notation">∀</span> <a id="l:132" class="idref" href="#l:132"><span class="id" title="binder">l</span></a> <a id="v:133" class="idref" href="#v:133"><span class="id" title="binder">v</span></a> <a id="I:134" class="idref" href="#I:134"><span class="id" title="binder">I</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:132"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">↦</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">_I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:133"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:134"><span class="id" title="variable">I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:133"><span class="id" title="variable">v</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:132"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:133"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">(</span><span class="id" title="notation">∀</span> <a id="w:135" class="idref" href="#w:135"><span class="id" title="binder">w</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:134"><span class="id" title="variable">I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#w:135"><span class="id" title="variable">w</span></a> <span class="id" title="notation">⌝</span> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:132"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#w:135"><span class="id" title="variable">w</span></a> <span class="id" title="notation">==∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_mapsto_own"><span class="id" title="definition">inv_mapsto_own</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:132"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#w:135"><span class="id" title="variable">w</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:134"><span class="id" title="variable">I</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">|={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:131"><span class="id" title="variable">E</span></a> <span class="id" title="notation">∖</span> <span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:131"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=&gt;</span> <span class="id" title="notation">True</span><span class="id" title="notation">)</span><span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?) "#Hinv".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">inv_mapsto_own_acc_strong</span> <span class="id" title="notation">with</span> "Hinv"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hacc"; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;" (<span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">I</span>) "Hl". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span>"Hacc" <span class="id" title="notation">with</span> "Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "(% &amp; Hl &amp; Hclose)".<br/>
&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "%∗". <span class="id" title="var">iIntros</span> (<span class="id" title="var">w</span>) "% Hl". <span class="id" title="var">iApply</span> "Hclose"; <span class="id" title="var">done</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="inv_mapsto_own_acc" class="idref" href="#inv_mapsto_own_acc"><span class="id" title="lemma">inv_mapsto_own_acc</span></a> <a id="E:136" class="idref" href="#E:136"><span class="id" title="binder">E</span></a> <a id="l:137" class="idref" href="#l:137"><span class="id" title="binder">l</span></a> <a id="v:138" class="idref" href="#v:138"><span class="id" title="binder">v</span></a> <a id="I:139" class="idref" href="#I:139"><span class="id" title="binder">I</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:136"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_heap_inv"><span class="id" title="abbreviation">inv_heap_inv</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:137"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">↦</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">_I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:138"><span class="id" title="variable">v</span></a> <span class="id" title="notation">={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:136"><span class="id" title="variable">E</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:136"><span class="id" title="variable">E</span></a> <span class="id" title="notation">∖</span> <span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span><span class="id" title="notation">}=∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:139"><span class="id" title="variable">I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:138"><span class="id" title="variable">v</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:137"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:138"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">(</span><span class="id" title="notation">∀</span> <a id="w:140" class="idref" href="#w:140"><span class="id" title="binder">w</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:139"><span class="id" title="variable">I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#w:140"><span class="id" title="variable">w</span></a> <span class="id" title="notation">⌝</span> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:137"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#w:140"><span class="id" title="variable">w</span></a> <span class="id" title="notation">={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:136"><span class="id" title="variable">E</span></a> <span class="id" title="notation">∖</span> <span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:136"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:137"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">↦</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#017e3302e3dfba6f9234fe10d3ecb417"><span class="id" title="notation">_I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#w:140"><span class="id" title="variable">w</span></a><span class="id" title="notation">)</span><span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?) "#Hinv Hl".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">inv_mapsto_own_acc</span> <span class="id" title="notation">with</span> "Hinv Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "(% &amp; Hl &amp; Hclose)"; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "%∗". <span class="id" title="var">iIntros</span> "!&gt;" (<span class="id" title="var">w</span>) "% Hl". <span class="id" title="var">iApply</span> "Hclose"; <span class="id" title="var">done</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="inv_mapsto_acc" class="idref" href="#inv_mapsto_acc"><span class="id" title="lemma">inv_mapsto_acc</span></a> <a id="l:141" class="idref" href="#l:141"><span class="id" title="binder">l</span></a> <a id="I:142" class="idref" href="#I:142"><span class="id" title="binder">I</span></a> <a id="E:143" class="idref" href="#E:143"><span class="id" title="binder">E</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:143"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#inv_heap_inv"><span class="id" title="abbreviation">inv_heap_inv</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:141"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#bf0d9bbf7b350f262bc2d3aeb5afeaf1"><span class="id" title="notation">↦</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#bf0d9bbf7b350f262bc2d3aeb5afeaf1"><span class="id" title="notation">_I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#bf0d9bbf7b350f262bc2d3aeb5afeaf1"><span class="id" title="notation">□</span></a> <span class="id" title="notation">={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:143"><span class="id" title="variable">E</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:143"><span class="id" title="variable">E</span></a> <span class="id" title="notation">∖</span> <span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span><span class="id" title="notation">}=∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∃</span> <a id="v:144" class="idref" href="#v:144"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:142"><span class="id" title="variable">I</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:144"><span class="id" title="variable">v</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:141"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:144"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:141"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:144"><span class="id" title="variable">v</span></a> <span class="id" title="notation">={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:143"><span class="id" title="variable">E</span></a> <span class="id" title="notation">∖</span> <span class="id" title="notation">↑</span><span class="id" title="definition">inv_heapN</span><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:143"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=∗</span> <span class="id" title="notation">⌜</span><span class="id" title="notation">True</span><span class="id" title="notation">⌝</span><span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?) "#Hinv Hl".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">inv_mapsto_acc</span> <span class="id" title="notation">with</span> "Hinv Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> ([<span class="id" title="var">v</span>|]) "(% &amp; Hl &amp; Hclose)"; [<span class="id" title="var">done</span>| |<span class="id" title="var">done</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;". <span class="id" title="var">iExists</span> (<span class="id" title="var">v</span>). <span class="id" title="var">iFrame</span> "%∗".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The usable rules for <span class="inlinecode"><span class="id" title="var">allocN</span></span> stated in terms of the <span class="inlinecode"><span class="id" title="definition">array</span></span> proposition
are derived in te file <span class="inlinecode"><span class="id" title="definition">array</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="heap_array_to_seq_meta" class="idref" href="#heap_array_to_seq_meta"><span class="id" title="lemma">heap_array_to_seq_meta</span></a> <a id="l:145" class="idref" href="#l:145"><span class="id" title="binder">l</span></a> <a id="vs:146" class="idref" href="#vs:146"><span class="id" title="binder">vs</span></a> (<a id="n:147" class="idref" href="#n:147"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :<br/>
&nbsp;&nbsp;<span class="id" title="abbreviation">length</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#vs:146"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:147"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">[∗</span> <span class="id" title="notation">map</span><span class="id" title="notation">]</span> <a id="l':148" class="idref" href="#l':148"><span class="id" title="binder"><span id="l':149" class="id">l'</span></span></a> <span class="id" title="notation">↦</span> <a id="pat:150" class="idref" href="#pat:150"><span class="id" title="binder">_</span></a> <span class="id" title="notation">∈</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.heap_array"><span class="id" title="definition">heap_array</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:145"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#vs:146"><span class="id" title="variable">vs</span></a><span class="id" title="notation">,</span> <span class="id" title="definition">meta_token</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l':148"><span class="id" title="variable">l'</span></a> <span class="id" title="notation">⊤</span><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">[∗</span> <span class="id" title="notation">list</span><span class="id" title="notation">]</span> <a id="i:151" class="idref" href="#i:151"><span class="id" title="binder"><span id="i:152" class="id">i</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#seq"><span class="id" title="definition">seq</span></a> 0 <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:147"><span class="id" title="variable">n</span></a><span class="id" title="notation">,</span> <span class="id" title="definition">meta_token</span> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:145"><span class="id" title="variable">l</span></a> <span class="id" title="notation">+ₗ</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i:151"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><span class="id" title="notation">)</span>) <span class="id" title="notation">⊤</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (&lt;-) "Hvs". <span class="id" title="var">iInduction</span> <span class="id" title="var">vs</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">v</span> <span class="id" title="var">vs</span>] "IH" <span class="id" title="keyword">forall</span> (<span class="id" title="var">l</span>)=&gt; //=.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">big_opM_union</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">first</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">map_disjoint_spec</span>=&gt; <span class="id" title="var">l'</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span> /<span class="id" title="lemma">lookup_singleton_Some</span> [-&gt; <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">j</span>&amp;<span class="id" title="var">w</span>&amp;?&amp;<span class="id" title="var">Hjl</span>&amp;?&amp;?)%<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.heap_array_lookup"><span class="id" title="lemma">heap_array_lookup</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Loc.add_assoc</span> -{1}[<span class="id" title="var">l'</span>]<span class="id" title="lemma">Loc.add_0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hjl</span>. <span class="id" title="var">simplify_eq</span>; <span class="id" title="var">lia</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Loc.add_0</span> -<span class="id" title="lemma">fmap_S_seq</span> <span class="id" title="lemma">big_sepL_fmap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.Znat.html#Nat2Z.inj_succ"><span class="id" title="lemma">Nat2Z.inj_succ</span></a>. <span class="id" title="tactic">setoid_rewrite</span> &lt;-<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#Z.add_1_l"><span class="id" title="lemma">Z.add_1_l</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;-<span class="id" title="lemma">Loc.add_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">big_opM_singleton</span>; <span class="id" title="var">iDestruct</span> "Hvs" <span class="id" title="keyword">as</span> "[$ Hvs]". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "IH".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="heap_array_to_seq_mapsto" class="idref" href="#heap_array_to_seq_mapsto"><span class="id" title="lemma">heap_array_to_seq_mapsto</span></a> <a id="l:153" class="idref" href="#l:153"><span class="id" title="binder">l</span></a> <a id="v:154" class="idref" href="#v:154"><span class="id" title="binder">v</span></a> (<a id="n:155" class="idref" href="#n:155"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :<br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">[∗</span> <span class="id" title="notation">map</span><span class="id" title="notation">]</span> <a id="l':156" class="idref" href="#l':156"><span class="id" title="binder"><span id="l':157" class="id">l'</span></span></a> <span class="id" title="notation">↦</span> <a id="ov:158" class="idref" href="#ov:158"><span class="id" title="binder"><span id="ov:159" class="id">ov</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.heap_array"><span class="id" title="definition">heap_array</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:153"><span class="id" title="variable">l</span></a> (<span class="id" title="definition">replicate</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:155"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:154"><span class="id" title="variable">v</span></a>)<span class="id" title="notation">,</span> <span class="id" title="definition">gen_heap.mapsto</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l':156"><span class="id" title="variable">l'</span></a> (<span class="id" title="constructor">DfracOwn</span> 1) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#ov:158"><span class="id" title="variable">ov</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">[∗</span> <span class="id" title="notation">list</span><span class="id" title="notation">]</span> <a id="i:160" class="idref" href="#i:160"><span class="id" title="binder"><span id="i:161" class="id">i</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#seq"><span class="id" title="definition">seq</span></a> 0 <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:155"><span class="id" title="variable">n</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:153"><span class="id" title="variable">l</span></a> <span class="id" title="notation">+ₗ</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i:160"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><span class="id" title="notation">)</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:154"><span class="id" title="variable">v</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hvs". <span class="id" title="var">iInduction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n</span>] "IH" <span class="id" title="keyword">forall</span> (<span class="id" title="var">l</span>); <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">big_opM_union</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">first</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">map_disjoint_spec</span>=&gt; <span class="id" title="var">l'</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span> /<span class="id" title="lemma">lookup_singleton_Some</span> [-&gt; <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">j</span>&amp;<span class="id" title="var">w</span>&amp;?&amp;<span class="id" title="var">Hjl</span>&amp;<span class="id" title="var">_</span>)%<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.heap_array_lookup"><span class="id" title="lemma">heap_array_lookup</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Loc.add_assoc</span> -{1}[<span class="id" title="var">l'</span>]<span class="id" title="lemma">Loc.add_0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hjl</span>. <span class="id" title="var">simplify_eq</span>; <span class="id" title="var">lia</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Loc.add_0</span> -<span class="id" title="lemma">fmap_S_seq</span> <span class="id" title="lemma">big_sepL_fmap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.Znat.html#Nat2Z.inj_succ"><span class="id" title="lemma">Nat2Z.inj_succ</span></a>. <span class="id" title="tactic">setoid_rewrite</span> &lt;-<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#Z.add_1_l"><span class="id" title="lemma">Z.add_1_l</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;-<span class="id" title="lemma">Loc.add_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">big_opM_singleton</span>; <span class="id" title="var">iDestruct</span> "Hvs" <span class="id" title="keyword">as</span> "[$ Hvs]". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "IH".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_allocN_seq" class="idref" href="#twp_allocN_seq"><span class="id" title="lemma">twp_allocN_seq</span></a> <a id="s:162" class="idref" href="#s:162"><span class="id" title="binder">s</span></a> <a id="E:163" class="idref" href="#E:163"><span class="id" title="binder">E</span></a> <a id="v:164" class="idref" href="#v:164"><span class="id" title="binder">v</span></a> <a id="n:165" class="idref" href="#n:165"><span class="id" title="binder">n</span></a> :<br/>
&nbsp;&nbsp;(0 <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#::Z_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:165"><span class="id" title="variable">n</span></a>)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.AllocN"><span class="id" title="constructor">AllocN</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:165"><span class="id" title="variable">n</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:164"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:162"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:163"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <a id="l:166" class="idref" href="#l:166"><span class="id" title="binder">l</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:166"><span class="id" title="variable">l</span></a>)<span class="id" title="notation">;</span> <span class="id" title="notation">[∗</span> <span class="id" title="notation">list</span><span class="id" title="notation">]</span> <a id="i:167" class="idref" href="#i:167"><span class="id" title="binder"><span id="i:168" class="id">i</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#seq"><span class="id" title="definition">seq</span></a> 0 (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:165"><span class="id" title="variable">n</span></a>)<span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:166"><span class="id" title="variable">l</span></a> <span class="id" title="notation">+ₗ</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i:167"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><span class="id" title="notation">)</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:164"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="definition">meta_token</span> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:166"><span class="id" title="variable">l</span></a> <span class="id" title="notation">+ₗ</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i:167"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><span class="id" title="notation">)</span>) <span class="id" title="notation">⊤</span> <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Hn</span> <span class="id" title="var">Φ</span>) "_ HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκs &amp; Hsteps) !&gt;"; <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lia</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_alloc_big</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.heap_array"><span class="id" title="definition">heap_array</span></a> <span class="id" title="var">_</span> (<span class="id" title="definition">replicate</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> <span class="id" title="var">n</span>) <span class="id" title="var">v</span>)) <span class="id" title="notation">with</span> "Hσ"<span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> "(Hσ &amp; Hl &amp; Hm)".<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.heap_array_map_disjoint"><span class="id" title="lemma">heap_array_map_disjoint</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">replicate_length</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.Znat.html#Z2Nat.id"><span class="id" title="lemma">Z2Nat.id</span></a>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lia</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>; <span class="id" title="tactic">do</span> 2 (<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>). <span class="id" title="var">iFrame</span> "Hσ Ht Hκs Hsteps". <span class="id" title="var">iApply</span> "HΦ".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">big_sepL_sep</span>. <span class="id" title="var">iSplitL</span> "Hl".<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#heap_array_to_seq_mapsto"><span class="id" title="lemma">heap_array_to_seq_mapsto</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#heap_array_to_seq_meta"><span class="id" title="lemma">heap_array_to_seq_meta</span></a> <span class="id" title="notation">with</span> "Hm"<span class="id" title="notation">)</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">replicate_length</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_allocN_seq" class="idref" href="#wp_allocN_seq"><span class="id" title="lemma">wp_allocN_seq</span></a> <a id="s:169" class="idref" href="#s:169"><span class="id" title="binder">s</span></a> <a id="E:170" class="idref" href="#E:170"><span class="id" title="binder">E</span></a> <a id="v:171" class="idref" href="#v:171"><span class="id" title="binder">v</span></a> <a id="n:172" class="idref" href="#n:172"><span class="id" title="binder">n</span></a> :<br/>
&nbsp;&nbsp;(0 <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#::Z_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:172"><span class="id" title="variable">n</span></a>)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.AllocN"><span class="id" title="constructor">AllocN</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:172"><span class="id" title="variable">n</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:171"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:169"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:170"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <a id="l:173" class="idref" href="#l:173"><span class="id" title="binder">l</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:173"><span class="id" title="variable">l</span></a>)<span class="id" title="notation">;</span> <span class="id" title="notation">[∗</span> <span class="id" title="notation">list</span><span class="id" title="notation">]</span> <a id="i:174" class="idref" href="#i:174"><span class="id" title="binder"><span id="i:175" class="id">i</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#seq"><span class="id" title="definition">seq</span></a> 0 (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:172"><span class="id" title="variable">n</span></a>)<span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:173"><span class="id" title="variable">l</span></a> <span class="id" title="notation">+ₗ</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i:174"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><span class="id" title="notation">)</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:171"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="definition">meta_token</span> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:173"><span class="id" title="variable">l</span></a> <span class="id" title="notation">+ₗ</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i:174"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><span class="id" title="notation">)</span>) <span class="id" title="notation">⊤</span> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Hn</span> <span class="id" title="var">Φ</span>) "_ HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_allocN_seq"><span class="id" title="lemma">twp_allocN_seq</span></a>; [<span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>..|]; <span class="id" title="var">iIntros</span> (<span class="id" title="var">l</span>) "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_alloc" class="idref" href="#twp_alloc"><span class="id" title="lemma">twp_alloc</span></a> <a id="s:176" class="idref" href="#s:176"><span class="id" title="binder">s</span></a> <a id="E:177" class="idref" href="#E:177"><span class="id" title="binder">E</span></a> <a id="v:178" class="idref" href="#v:178"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#Alloc"><span class="id" title="abbreviation">Alloc</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:178"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:176"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:177"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[[{</span> <a id="l:179" class="idref" href="#l:179"><span class="id" title="binder">l</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:179"><span class="id" title="variable">l</span></a>)<span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:179"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:178"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="definition">meta_token</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:179"><span class="id" title="variable">l</span></a> <span class="id" title="notation">⊤</span> <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "_ HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_allocN_seq"><span class="id" title="lemma">twp_allocN_seq</span></a>; [<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lia</span>..|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">l</span>) "/= (? &amp; _)". <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Loc.add_0</span>. <span class="id" title="var">iApply</span> "HΦ"; <span class="id" title="var">iFrame</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_alloc" class="idref" href="#wp_alloc"><span class="id" title="lemma">wp_alloc</span></a> <a id="s:180" class="idref" href="#s:180"><span class="id" title="binder">s</span></a> <a id="E:181" class="idref" href="#E:181"><span class="id" title="binder">E</span></a> <a id="v:182" class="idref" href="#v:182"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#Alloc"><span class="id" title="abbreviation">Alloc</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:182"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:180"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:181"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{{</span> <a id="l:183" class="idref" href="#l:183"><span class="id" title="binder">l</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:183"><span class="id" title="variable">l</span></a>)<span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:183"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:182"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="definition">meta_token</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:183"><span class="id" title="variable">l</span></a> <span class="id" title="notation">⊤</span> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "_ HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_alloc"><span class="id" title="lemma">twp_alloc</span></a>; [<span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>..|]; <span class="id" title="var">iIntros</span> (<span class="id" title="var">l</span>) "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_free" class="idref" href="#twp_free"><span class="id" title="lemma">twp_free</span></a> <a id="s:184" class="idref" href="#s:184"><span class="id" title="binder">s</span></a> <a id="E:185" class="idref" href="#E:185"><span class="id" title="binder">E</span></a> <a id="l:186" class="idref" href="#l:186"><span class="id" title="binder">l</span></a> <a id="v:187" class="idref" href="#v:187"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:186"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:187"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Free"><span class="id" title="constructor">Free</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:186"><span class="id" title="variable">l</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:184"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:185"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a><span class="id" title="notation">;</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "Hl HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκs &amp; Hsteps) !&gt;". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_valid</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_update</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ Hl]".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_free" class="idref" href="#wp_free"><span class="id" title="lemma">wp_free</span></a> <a id="s:188" class="idref" href="#s:188"><span class="id" title="binder">s</span></a> <a id="E:189" class="idref" href="#E:189"><span class="id" title="binder">E</span></a> <a id="l:190" class="idref" href="#l:190"><span class="id" title="binder">l</span></a> <a id="v:191" class="idref" href="#v:191"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:190"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:191"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Free"><span class="id" title="constructor">Free</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:190"><span class="id" title="variable">l</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:188"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:189"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a><span class="id" title="notation">;</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_free"><span class="id" title="lemma">twp_free</span></a> <span class="id" title="notation">with</span> "H"<span class="id" title="notation">)</span>; [<span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>..|]; <span class="id" title="var">iIntros</span> "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_load" class="idref" href="#twp_load"><span class="id" title="lemma">twp_load</span></a> <a id="s:192" class="idref" href="#s:192"><span class="id" title="binder">s</span></a> <a id="E:193" class="idref" href="#E:193"><span class="id" title="binder">E</span></a> <a id="l:194" class="idref" href="#l:194"><span class="id" title="binder">l</span></a> <a id="dq:195" class="idref" href="#dq:195"><span class="id" title="binder">dq</span></a> <a id="v:196" class="idref" href="#v:196"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:194"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:195"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:196"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Load"><span class="id" title="constructor">Load</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:194"><span class="id" title="variable">l</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:192"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:193"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[[{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:196"><span class="id" title="variable">v</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:194"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:195"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:196"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "Hl HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκs &amp; Hsteps) !&gt;". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_valid</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iSplit</span>; [<span class="id" title="var">done</span>|]. <span class="id" title="var">iSplit</span>; [<span class="id" title="var">done</span>|]. <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_load" class="idref" href="#wp_load"><span class="id" title="lemma">wp_load</span></a> <a id="s:197" class="idref" href="#s:197"><span class="id" title="binder">s</span></a> <a id="E:198" class="idref" href="#E:198"><span class="id" title="binder">E</span></a> <a id="l:199" class="idref" href="#l:199"><span class="id" title="binder">l</span></a> <a id="dq:200" class="idref" href="#dq:200"><span class="id" title="binder">dq</span></a> <a id="v:201" class="idref" href="#v:201"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:199"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:200"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:201"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Load"><span class="id" title="constructor">Load</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:199"><span class="id" title="variable">l</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:197"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:198"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:201"><span class="id" title="variable">v</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:199"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:200"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:201"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_load"><span class="id" title="lemma">twp_load</span></a> <span class="id" title="notation">with</span> "H"<span class="id" title="notation">)</span>. <span class="id" title="var">iIntros</span> "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_store" class="idref" href="#twp_store"><span class="id" title="lemma">twp_store</span></a> <a id="s:202" class="idref" href="#s:202"><span class="id" title="binder">s</span></a> <a id="E:203" class="idref" href="#E:203"><span class="id" title="binder">E</span></a> <a id="l:204" class="idref" href="#l:204"><span class="id" title="binder">l</span></a> <a id="v':205" class="idref" href="#v':205"><span class="id" title="binder">v'</span></a> <a id="v:206" class="idref" href="#v:206"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:204"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':205"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Store"><span class="id" title="constructor">Store</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:204"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:206"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:202"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:203"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:204"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:206"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "Hl HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκs &amp; Hsteps) !&gt;". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_valid</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_update</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ Hl]".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_store" class="idref" href="#wp_store"><span class="id" title="lemma">wp_store</span></a> <a id="s:207" class="idref" href="#s:207"><span class="id" title="binder">s</span></a> <a id="E:208" class="idref" href="#E:208"><span class="id" title="binder">E</span></a> <a id="l:209" class="idref" href="#l:209"><span class="id" title="binder">l</span></a> <a id="v':210" class="idref" href="#v':210"><span class="id" title="binder">v'</span></a> <a id="v:211" class="idref" href="#v:211"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:209"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':210"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Store"><span class="id" title="constructor">Store</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:209"><span class="id" title="variable">l</span></a>)) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:211"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:207"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:208"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:209"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:211"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_store"><span class="id" title="lemma">twp_store</span></a> <span class="id" title="notation">with</span> "H"<span class="id" title="notation">)</span>; [<span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>..|]; <span class="id" title="var">iIntros</span> "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_xchg" class="idref" href="#twp_xchg"><span class="id" title="lemma">twp_xchg</span></a> <a id="s:212" class="idref" href="#s:212"><span class="id" title="binder">s</span></a> <a id="E:213" class="idref" href="#E:213"><span class="id" title="binder">E</span></a> <a id="l:214" class="idref" href="#l:214"><span class="id" title="binder">l</span></a> <a id="v':215" class="idref" href="#v':215"><span class="id" title="binder">v'</span></a> <a id="v:216" class="idref" href="#v:216"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:214"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':215"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Xchg"><span class="id" title="constructor">Xchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:214"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:216"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:212"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:213"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':215"><span class="id" title="variable">v'</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:214"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:216"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "Hl HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκs &amp; Hsteps) !&gt;". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_valid</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_update</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ Hl]".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_xchg" class="idref" href="#wp_xchg"><span class="id" title="lemma">wp_xchg</span></a> <a id="s:217" class="idref" href="#s:217"><span class="id" title="binder">s</span></a> <a id="E:218" class="idref" href="#E:218"><span class="id" title="binder">E</span></a> <a id="l:219" class="idref" href="#l:219"><span class="id" title="binder">l</span></a> <a id="v':220" class="idref" href="#v':220"><span class="id" title="binder">v'</span></a> <a id="v:221" class="idref" href="#v:221"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:219"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':220"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Xchg"><span class="id" title="constructor">Xchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:219"><span class="id" title="variable">l</span></a>)) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:221"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:217"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:218"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':220"><span class="id" title="variable">v'</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:219"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:221"><span class="id" title="variable">v</span></a> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_xchg"><span class="id" title="lemma">twp_xchg</span></a> <span class="id" title="notation">with</span> "H"<span class="id" title="notation">)</span>; [<span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>..|]. <span class="id" title="var">iIntros</span> "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_cmpxchg_fail" class="idref" href="#twp_cmpxchg_fail"><span class="id" title="lemma">twp_cmpxchg_fail</span></a> <a id="s:222" class="idref" href="#s:222"><span class="id" title="binder">s</span></a> <a id="E:223" class="idref" href="#E:223"><span class="id" title="binder">E</span></a> <a id="l:224" class="idref" href="#l:224"><span class="id" title="binder">l</span></a> <a id="dq:225" class="idref" href="#dq:225"><span class="id" title="binder">dq</span></a> <a id="v':226" class="idref" href="#v':226"><span class="id" title="binder">v'</span></a> <a id="v1:227" class="idref" href="#v1:227"><span class="id" title="binder">v1</span></a> <a id="v2:228" class="idref" href="#v2:228"><span class="id" title="binder">v2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':226"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:227"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':226"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:227"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:224"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:225"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':226"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:224"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:227"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:228"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:222"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:223"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':226"><span class="id" title="variable">v'</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)<span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:224"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:225"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':226"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?? <span class="id" title="var">Φ</span>) "Hl HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκs &amp; Hsteps) !&gt;". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_valid</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">v2'</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="abbreviation">bool_decide_false</span> //.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>; <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_cmpxchg_fail" class="idref" href="#wp_cmpxchg_fail"><span class="id" title="lemma">wp_cmpxchg_fail</span></a> <a id="s:229" class="idref" href="#s:229"><span class="id" title="binder">s</span></a> <a id="E:230" class="idref" href="#E:230"><span class="id" title="binder">E</span></a> <a id="l:231" class="idref" href="#l:231"><span class="id" title="binder">l</span></a> <a id="dq:232" class="idref" href="#dq:232"><span class="id" title="binder">dq</span></a> <a id="v':233" class="idref" href="#v':233"><span class="id" title="binder">v'</span></a> <a id="v1:234" class="idref" href="#v1:234"><span class="id" title="binder">v1</span></a> <a id="v2:235" class="idref" href="#v2:235"><span class="id" title="binder">v2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':233"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:234"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':233"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:234"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:231"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:232"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':233"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:231"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:234"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:235"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:229"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:230"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':233"><span class="id" title="variable">v'</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)<span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:231"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:232"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':233"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?? <span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_cmpxchg_fail"><span class="id" title="lemma">twp_cmpxchg_fail</span></a> <span class="id" title="notation">with</span> "H"<span class="id" title="notation">)</span>; [<span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>..|]; <span class="id" title="var">iIntros</span> "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_cmpxchg_suc" class="idref" href="#twp_cmpxchg_suc"><span class="id" title="lemma">twp_cmpxchg_suc</span></a> <a id="s:236" class="idref" href="#s:236"><span class="id" title="binder">s</span></a> <a id="E:237" class="idref" href="#E:237"><span class="id" title="binder">E</span></a> <a id="l:238" class="idref" href="#l:238"><span class="id" title="binder">l</span></a> <a id="v1:239" class="idref" href="#v1:239"><span class="id" title="binder">v1</span></a> <a id="v2:240" class="idref" href="#v2:240"><span class="id" title="binder">v2</span></a> <a id="v':241" class="idref" href="#v':241"><span class="id" title="binder">v'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':241"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:239"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':241"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:239"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:238"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':241"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:238"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:239"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:240"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:236"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:237"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':241"><span class="id" title="variable">v'</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:238"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:240"><span class="id" title="variable">v2</span></a> <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?? <span class="id" title="var">Φ</span>) "Hl HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκs &amp; Hsteps) !&gt;". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_valid</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">v2'</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="abbreviation">bool_decide_true</span> //.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_update</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ Hl]".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_cmpxchg_suc" class="idref" href="#wp_cmpxchg_suc"><span class="id" title="lemma">wp_cmpxchg_suc</span></a> <a id="s:242" class="idref" href="#s:242"><span class="id" title="binder">s</span></a> <a id="E:243" class="idref" href="#E:243"><span class="id" title="binder">E</span></a> <a id="l:244" class="idref" href="#l:244"><span class="id" title="binder">l</span></a> <a id="v1:245" class="idref" href="#v1:245"><span class="id" title="binder">v1</span></a> <a id="v2:246" class="idref" href="#v2:246"><span class="id" title="binder">v2</span></a> <a id="v':247" class="idref" href="#v':247"><span class="id" title="binder">v'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':247"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:245"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':247"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:245"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:244"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':247"><span class="id" title="variable">v'</span></a> <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:244"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:245"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:246"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:242"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:243"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':247"><span class="id" title="variable">v'</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:244"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:246"><span class="id" title="variable">v2</span></a> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?? <span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_cmpxchg_suc"><span class="id" title="lemma">twp_cmpxchg_suc</span></a> <span class="id" title="notation">with</span> "H"<span class="id" title="notation">)</span>; [<span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>..|]; <span class="id" title="var">iIntros</span> "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="twp_faa" class="idref" href="#twp_faa"><span class="id" title="lemma">twp_faa</span></a> <a id="s:248" class="idref" href="#s:248"><span class="id" title="binder">s</span></a> <a id="E:249" class="idref" href="#E:249"><span class="id" title="binder">E</span></a> <a id="l:250" class="idref" href="#l:250"><span class="id" title="binder">l</span></a> <a id="i1:251" class="idref" href="#i1:251"><span class="id" title="binder">i1</span></a> <a id="i2:252" class="idref" href="#i2:252"><span class="id" title="binder">i2</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:250"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:251"><span class="id" title="variable">i1</span></a>) <span class="id" title="notation">}]]</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.FAA"><span class="id" title="constructor">FAA</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:250"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i2:252"><span class="id" title="variable">i2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:248"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:249"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">[[{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:251"><span class="id" title="variable">i1</span></a>)<span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:250"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:251"><span class="id" title="variable">i1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i2:252"><span class="id" title="variable">i2</span></a>)) <span class="id" title="notation">}]]</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "Hl HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">twp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκs &amp; Hsteps) !&gt;". <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_valid</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">κ</span> <span class="id" title="var">e2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>); <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">gen_heap_update</span> <span class="id" title="notation">with</span> "Hσ Hl"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ Hl]".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="tactic">do</span> 2 (<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>). <span class="id" title="var">iFrame</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_faa" class="idref" href="#wp_faa"><span class="id" title="lemma">wp_faa</span></a> <a id="s:253" class="idref" href="#s:253"><span class="id" title="binder">s</span></a> <a id="E:254" class="idref" href="#E:254"><span class="id" title="binder">E</span></a> <a id="l:255" class="idref" href="#l:255"><span class="id" title="binder">l</span></a> <a id="i1:256" class="idref" href="#i1:256"><span class="id" title="binder">i1</span></a> <a id="i2:257" class="idref" href="#i2:257"><span class="id" title="binder">i2</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:255"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:256"><span class="id" title="variable">i1</span></a>) <span class="id" title="notation">}}}</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.FAA"><span class="id" title="constructor">FAA</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:255"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i2:257"><span class="id" title="variable">i2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:253"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:254"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">RET</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:256"><span class="id" title="variable">i1</span></a>)<span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:255"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:256"><span class="id" title="variable">i1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i2:257"><span class="id" title="variable">i2</span></a>)) <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">twp_wp_step</span> <span class="id" title="notation">with</span> "HΦ"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_faa"><span class="id" title="lemma">twp_faa</span></a> <span class="id" title="notation">with</span> "H"<span class="id" title="notation">)</span>; [<span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>..|]; <span class="id" title="var">iIntros</span> "H HΦ". <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_new_proph" class="idref" href="#wp_new_proph"><span class="id" title="lemma">wp_new_proph</span></a> <a id="s:258" class="idref" href="#s:258"><span class="id" title="binder">s</span></a> <a id="E:259" class="idref" href="#E:259"><span class="id" title="binder">E</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <span class="id" title="notation">True</span> <span class="id" title="notation">}}}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.NewProph"><span class="id" title="constructor">NewProph</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:258"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:259"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">{{{</span> <a id="pvs:260" class="idref" href="#pvs:260"><span class="id" title="binder">pvs</span></a> <a id="p:261" class="idref" href="#p:261"><span class="id" title="binder">p</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">RET</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitProphecy"><span class="id" title="constructor">LitProphecy</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:261"><span class="id" title="variable">p</span></a>)<span class="id" title="notation">);</span> <span class="id" title="definition">proph</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:261"><span class="id" title="variable">p</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs:260"><span class="id" title="variable">pvs</span></a> <span class="id" title="notation">}}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "_ HΦ". <span class="id" title="var">iApply</span> <span class="id" title="lemma">wp_lift_atomic_head_step_no_fork</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; HR &amp; Hsteps) !&gt;". <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;" (<span class="id" title="var">v2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">Hstep</span>) "_". <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">select</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.proph_id"><span class="id" title="definition">proph_id</span></a> <span class="id" title="var">into</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_auth_update_S"><span class="id" title="lemma">steps_auth_update_S</span></a> <span class="id" title="notation">with</span> "Hsteps"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hsteps".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">proph_map_new_proph</span> <span class="id" title="var">p</span> <span class="id" title="notation">with</span> "HR"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[HR Hp]"; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>; <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;In&nbsp;the&nbsp;following,&nbsp;strong&nbsp;atomicity&nbsp;is&nbsp;required&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">e</span></span>&nbsp;must<br/>
be&nbsp;able&nbsp;to&nbsp;make&nbsp;a&nbsp;head&nbsp;step&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="keyword">Resolve</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;not&nbsp;to&nbsp;be&nbsp;(head)&nbsp;stuck.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="resolve_reducible" class="idref" href="#resolve_reducible"><span class="id" title="lemma">resolve_reducible</span></a> <a id="e:262" class="idref" href="#e:262"><span class="id" title="binder">e</span></a> <a id="8be57689b8f556bcb0bf14fed46223d5" class="idref" href="#8be57689b8f556bcb0bf14fed46223d5"><span class="id" title="binder">σ</span></a> (<a id="p:264" class="idref" href="#p:264"><span class="id" title="binder">p</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.proph_id"><span class="id" title="definition">proph_id</span></a>) <a id="v:265" class="idref" href="#v:265"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">Atomic</span> <span class="id" title="constructor">StronglyAtomic</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:262"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">reducible</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:262"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#8be57689b8f556bcb0bf14fed46223d5"><span class="id" title="variable">σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">reducible</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Resolve"><span class="id" title="constructor">Resolve</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:262"><span class="id" title="variable">e</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitProphecy"><span class="id" title="constructor">LitProphecy</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:264"><span class="id" title="variable">p</span></a>))) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:265"><span class="id" title="variable">v</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#8be57689b8f556bcb0bf14fed46223d5"><span class="id" title="variable">σ</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> (<span class="id" title="var">κ</span> &amp; <span class="id" title="var">e'</span> &amp; σ' &amp; <span class="id" title="var">efs</span> &amp; <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">κ</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">p</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="abbreviation">default</span> <span class="id" title="var">v</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <span class="id" title="var">e'</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">))</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>), <span class="id" title="var">e'</span>, σ', <span class="id" title="var">efs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<span class="id" title="constructor">Ectx_step</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>); <span class="id" title="tactic">try</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#94e052c6337a815c52cda44eea9df276"><span class="id" title="notation">∃</span></a><a id="w:266" class="idref" href="#w:266"><span class="id" title="binder"><span id="w:267" class="id">w</span></span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#94e052c6337a815c52cda44eea9df276"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#w:266"><span class="id" title="variable">w</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">e'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">w</span> &lt;-].<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="class">Atomic</span> <span class="id" title="tactic">in</span> <span class="id" title="var">A</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">A</span> σ <span class="id" title="var">e'</span> <span class="id" title="var">κ</span> σ' <span class="id" title="var">efs</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="definition">is_Some</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">w</span> <span class="id" title="var">H</span>]. <span class="id" title="tactic">exists</span> <span class="id" title="var">w</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.of_to_val"><span class="id" title="lemma">of_to_val</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>). }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#prim_step_to_val_is_head_step"><span class="id" title="lemma">prim_step_to_val_is_head_step</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="step_resolve" class="idref" href="#step_resolve"><span class="id" title="lemma">step_resolve</span></a> <a id="e:268" class="idref" href="#e:268"><span class="id" title="binder">e</span></a> <a id="vp:269" class="idref" href="#vp:269"><span class="id" title="binder">vp</span></a> <a id="vt:270" class="idref" href="#vt:270"><span class="id" title="binder">vt</span></a> <a id="8efc9ac8ee62b259b22529de3888fa43" class="idref" href="#8efc9ac8ee62b259b22529de3888fa43"><span class="id" title="binder">σ1</span></a> <a id="4c9e042a8181f253708ffe12dd298eb8" class="idref" href="#4c9e042a8181f253708ffe12dd298eb8"><span class="id" title="binder">κ</span></a> <a id="e2:273" class="idref" href="#e2:273"><span class="id" title="binder">e2</span></a> <a id="963b1533a2ec71fdb52e78621c4ef84e" class="idref" href="#963b1533a2ec71fdb52e78621c4ef84e"><span class="id" title="binder">σ2</span></a> <a id="efs:275" class="idref" href="#efs:275"><span class="id" title="binder">efs</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">Atomic</span> <span class="id" title="constructor">StronglyAtomic</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:268"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="inductive">prim_step</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Resolve"><span class="id" title="constructor">Resolve</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:268"><span class="id" title="variable">e</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#vp:269"><span class="id" title="variable">vp</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#vt:270"><span class="id" title="variable">vt</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#8efc9ac8ee62b259b22529de3888fa43"><span class="id" title="variable">σ1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#4c9e042a8181f253708ffe12dd298eb8"><span class="id" title="variable">κ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e2:273"><span class="id" title="variable">e2</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#963b1533a2ec71fdb52e78621c4ef84e"><span class="id" title="variable">σ2</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#efs:275"><span class="id" title="variable">efs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.head_step"><span class="id" title="inductive">head_step</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Resolve"><span class="id" title="constructor">Resolve</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:268"><span class="id" title="variable">e</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#vp:269"><span class="id" title="variable">vp</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#vt:270"><span class="id" title="variable">vt</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#8efc9ac8ee62b259b22529de3888fa43"><span class="id" title="variable">σ1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#4c9e042a8181f253708ffe12dd298eb8"><span class="id" title="variable">κ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e2:273"><span class="id" title="variable">e2</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#963b1533a2ec71fdb52e78621c4ef84e"><span class="id" title="variable">σ2</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#efs:275"><span class="id" title="variable">efs</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> [<span class="id" title="var">Ks</span> <span class="id" title="var">e1'</span> <span class="id" title="var">e2'</span> <span class="id" title="var">Hfill</span> -&gt; <span class="id" title="var">step</span>]. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ks</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">K</span> <span class="id" title="var">Ks</span> <span class="id" title="var">_</span>] <span class="id" title="keyword">using</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#rev_ind"><span class="id" title="lemma">rev_ind</span></a>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">subst</span>. <span class="id" title="var">inv_head_step</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">fill_app</span> /= <span class="id" title="tactic">in</span> <span class="id" title="var">Hfill</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">K</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hfill</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Hfill</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rename</span> <span class="id" title="var">select</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.ectx_item"><span class="id" title="inductive">ectx_item</span></a> <span class="id" title="var">into</span> <span class="id" title="var">Ki</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.fill_item"><span class="id" title="definition">fill_item</span></a> <span class="id" title="var">Ki</span> (<span class="id" title="definition">fill</span> <span class="id" title="var">Ks</span> <span class="id" title="var">e1'</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">fill</span> (<span class="id" title="var">Ks</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><span class="id" title="var">Ki</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <span class="id" title="var">e1'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Eq1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">fill_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.fill_item"><span class="id" title="definition">fill_item</span></a> <span class="id" title="var">Ki</span> (<span class="id" title="definition">fill</span> <span class="id" title="var">Ks</span> <span class="id" title="var">e2'</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">fill</span> (<span class="id" title="var">Ks</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><span class="id" title="var">Ki</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <span class="id" title="var">e2'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Eq2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">fill_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">fill_app</span> /=. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eq1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="definition">is_Some</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> (<span class="id" title="definition">fill</span> (<span class="id" title="var">Ks</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><span class="id" title="var">Ki</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <span class="id" title="var">e2'</span>))) <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> (<span class="id" title="var">A</span> σ1 <span class="id" title="var">_</span> <span class="id" title="var">κ</span> σ2 <span class="id" title="var">efs</span>). <span class="id" title="tactic">eapply</span> (<span class="id" title="constructor">Ectx_step</span> (<span class="id" title="var">Ks</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><span class="id" title="var">Ki</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>)); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v</span> <span class="id" title="var">H</span>]. <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#to_val_fill_some"><span class="id" title="lemma">to_val_fill_some</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>, <span class="id" title="var">Ks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rename</span> <span class="id" title="var">select</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.of_val"><span class="id" title="abbreviation">of_val</span></a> <span class="id" title="var">vp</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">into</span> <span class="id" title="var">Hvp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> (<span class="id" title="definition">fill</span> <span class="id" title="var">Ks</span> <span class="id" title="var">e1'</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">vp</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hfillvp</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> -<span class="id" title="var">Hvp</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#to_val_fill_some"><span class="id" title="lemma">to_val_fill_some</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hfillvp</span> <span class="id" title="keyword">as</span> [-&gt; -&gt;]. <span class="id" title="var">inv_head_step</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rename</span> <span class="id" title="var">select</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.of_val"><span class="id" title="abbreviation">of_val</span></a> <span class="id" title="var">vt</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">into</span> <span class="id" title="var">Hvt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> (<span class="id" title="definition">fill</span> <span class="id" title="var">Ks</span> <span class="id" title="var">e1'</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">vt</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hfillvt</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> -<span class="id" title="var">Hvt</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#to_val_fill_some"><span class="id" title="lemma">to_val_fill_some</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hfillvt</span> <span class="id" title="keyword">as</span> [-&gt; -&gt;]. <span class="id" title="var">inv_head_step</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wp_resolve" class="idref" href="#wp_resolve"><span class="id" title="lemma">wp_resolve</span></a> <a id="s:276" class="idref" href="#s:276"><span class="id" title="binder">s</span></a> <a id="E:277" class="idref" href="#E:277"><span class="id" title="binder">E</span></a> <a id="e:278" class="idref" href="#e:278"><span class="id" title="binder">e</span></a> <a id="4dbd330a18bc27fb94879da5c29d6382" class="idref" href="#4dbd330a18bc27fb94879da5c29d6382"><span class="id" title="binder">Φ</span></a> (<a id="p:280" class="idref" href="#p:280"><span class="id" title="binder">p</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.proph_id"><span class="id" title="definition">proph_id</span></a>) <a id="v:281" class="idref" href="#v:281"><span class="id" title="binder">v</span></a> (<a id="pvs:282" class="idref" href="#pvs:282"><span class="id" title="binder">pvs</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>)) :<br/>
&nbsp;&nbsp;<span class="id" title="class">Atomic</span> <span class="id" title="constructor">StronglyAtomic</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:278"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:278"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">proph</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:280"><span class="id" title="variable">p</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs:282"><span class="id" title="variable">pvs</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:278"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:276"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:277"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a id="r:283" class="idref" href="#r:283"><span class="id" title="binder">r</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">∀</span> <a id="pvs':284" class="idref" href="#pvs':284"><span class="id" title="binder">pvs'</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs:282"><span class="id" title="variable">pvs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#r:283"><span class="id" title="variable">r</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:281"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs':284"><span class="id" title="variable">pvs'</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">-∗</span> <span class="id" title="definition">proph</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:280"><span class="id" title="variable">p</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs':284"><span class="id" title="variable">pvs'</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#4dbd330a18bc27fb94879da5c29d6382"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#r:283"><span class="id" title="variable">r</span></a> <span class="id" title="notation">}}</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Resolve"><span class="id" title="constructor">Resolve</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:278"><span class="id" title="variable">e</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitProphecy"><span class="id" title="constructor">LitProphecy</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:280"><span class="id" title="variable">p</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:281"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:276"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:277"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#4dbd330a18bc27fb94879da5c29d6382"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO&nbsp;we&nbsp;should&nbsp;try&nbsp;to&nbsp;use&nbsp;a&nbsp;generic&nbsp;lifting&nbsp;lemma&nbsp;(and&nbsp;avoid&nbsp;<span class="inlinecode"><span class="id" title="var">wp_unfold</span></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;here,&nbsp;since&nbsp;this&nbsp;breaks&nbsp;the&nbsp;WP&nbsp;abstraction.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">A</span> <span class="id" title="var">He</span>) "Hp WPe". <span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">wp_unfold</span> /<span class="id" title="definition">wp_pre</span> /= <span class="id" title="var">He</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (σ1 <span class="id" title="var">ns</span> <span class="id" title="var">κ</span> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span>) "(Hσ &amp; Ht &amp; Hκ &amp; Hsteps)".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">κ</span> <span class="id" title="keyword">as</span> [|[<span class="id" title="var">p'</span> [<span class="id" title="var">w'</span> <span class="id" title="var">v'</span>]] <span class="id" title="var">κ'</span> <span class="id" title="var">_</span>] <span class="id" title="keyword">using</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#rev_ind"><span class="id" title="lemma">rev_ind</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"WPe" <span class="id" title="notation">$!</span> σ1 <span class="id" title="var">ns</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <span class="id" title="var">κs</span> <span class="id" title="var">nt</span> <span class="id" title="notation">with</span> "[$Hσ $Ht $Hκ $Hsteps]"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[Hs WPe]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iSplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iDestruct</span> "Hs" <span class="id" title="keyword">as</span> "%". <span class="id" title="var">iPureIntro</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>; [ <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#resolve_reducible"><span class="id" title="lemma">resolve_reducible</span></a> | <span class="id" title="var">done</span>]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">e2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">step</span>). <span class="id" title="var">exfalso</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#step_resolve"><span class="id" title="lemma">step_resolve</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">step</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_head_step</span>. <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">H</span>: ?<span class="id" title="var">κs</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">by</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">κs</span> <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<span class="id" title="definition">assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"WPe" <span class="id" title="notation">$!</span> σ1 <span class="id" title="var">ns</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">nt</span> <span class="id" title="notation">with</span> "[$Hσ $Ht $Hκ $Hsteps]"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[Hs WPe]". <span class="id" title="var">iModIntro</span>. <span class="id" title="var">iSplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iDestruct</span> "Hs" <span class="id" title="keyword">as</span> %?. <span class="id" title="var">iPureIntro</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>; [ <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#resolve_reducible"><span class="id" title="lemma">resolve_reducible</span></a> | <span class="id" title="var">done</span>]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">e2</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="var">step</span>) "Hcred". <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#step_resolve"><span class="id" title="lemma">step_resolve</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">step</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_head_step</span>; <span class="id" title="var">simplify_list_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"WPe" <span class="id" title="notation">$!</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">w'</span><span class="id" title="notation">)</span> σ2 <span class="id" title="var">efs</span> <span class="id" title="notation">with</span> "[%] Hcred"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "WPe".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">by</span> <span class="id" title="tactic">eexists</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iNext</span>. <span class="id" title="var">iMod</span> "WPe" <span class="id" title="keyword">as</span> "WPe". <span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">step_fupdN_wand</span> <span class="id" title="notation">with</span> "WPe"<span class="id" title="notation">)</span>; <span class="id" title="var">iIntros</span> "&gt; [($ &amp; $ &amp; Hκ &amp; $) WPe]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">proph_map_resolve_proph</span> <span class="id" title="var">p'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">w'</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a><span class="id" title="var">v'</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="var">κs</span> <span class="id" title="notation">with</span> "[$Hκ $Hp]"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">vs'</span> -&gt;) "[$ HPost]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">wp_unfold</span> /<span class="id" title="definition">wp_pre</span> /=. <span class="id" title="var">iDestruct</span> "WPe" <span class="id" title="keyword">as</span> "[HΦ $]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> "HΦ". <span class="id" title="var">iModIntro</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_lb_init" class="idref" href="#wbwp_lb_init"><span class="id" title="lemma">wbwp_lb_init</span></a> <a id="E:285" class="idref" href="#E:285"><span class="id" title="binder">E</span></a> <a id="out:286" class="idref" href="#out:286"><span class="id" title="binder">out</span></a> <a id="e:287" class="idref" href="#e:287"><span class="id" title="binder">e</span></a> <a id="7acf753c6a7ca46958c08db02316cc9f" class="idref" href="#7acf753c6a7ca46958c08db02316cc9f"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">TCEq</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:287"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> 0 <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:287"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:286"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:285"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">{{</span></a> <a id="v:289" class="idref" href="#v:289"><span class="id" title="binder">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#7acf753c6a7ca46958c08db02316cc9f"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:289"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">}}</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:287"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:286"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:285"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#7acf753c6a7ca46958c08db02316cc9f"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a>. <span class="id" title="var">iIntros</span> (?) "Hwp". <span class="id" title="var">iIntros</span> (<span class="id" title="var">M</span>) "HM".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_lb_init"><span class="id" title="lemma">wp_lb_init</span></a>  <span class="id" title="notation">with</span> "[Hwp HM]"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hslb". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span>"Hwp" <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_lb_update" class="idref" href="#wbwp_lb_update"><span class="id" title="lemma">wbwp_lb_update</span></a> <a id="n:290" class="idref" href="#n:290"><span class="id" title="binder">n</span></a> <a id="E:291" class="idref" href="#E:291"><span class="id" title="binder">E</span></a> <a id="out:292" class="idref" href="#out:292"><span class="id" title="binder">out</span></a> <a id="e:293" class="idref" href="#e:293"><span class="id" title="binder">e</span></a> <a id="1f5830e8ea4358a26b1163e3548dbe86" class="idref" href="#1f5830e8ea4358a26b1163e3548dbe86"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">TCEq</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:293"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:290"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:293"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:292"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:291"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">{{</span></a> <a id="v:295" class="idref" href="#v:295"><span class="id" title="binder">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:290"><span class="id" title="variable">n</span></a>) <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#1f5830e8ea4358a26b1163e3548dbe86"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:295"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">}}</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:293"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:292"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:291"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#1f5830e8ea4358a26b1163e3548dbe86"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a>. <span class="id" title="var">iIntros</span> (?) "Hslb Hwp". <span class="id" title="var">iIntros</span> (<span class="id" title="var">M</span>) "HM".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_lb_update"><span class="id" title="lemma">wp_lb_update</span></a>  <span class="id" title="notation">with</span> "[$Hslb]"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">wp_wand</span> <span class="id" title="notation">with</span> "[Hwp HM]"<span class="id" title="notation">)</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hwp".<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?). <span class="id" title="var">iDestruct</span> 1 <span class="id" title="keyword">as</span> (?) "(?&amp;?&amp;H)". <span class="id" title="var">iIntros</span> "Hslb".<br/>
&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">_</span>; <span class="id" title="var">iFrame</span>; <span class="id" title="var">iApply</span> "H"; <span class="id" title="var">done</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_step_fupdN_lb" class="idref" href="#wbwp_step_fupdN_lb"><span class="id" title="lemma">wbwp_step_fupdN_lb</span></a> <a id="n:296" class="idref" href="#n:296"><span class="id" title="binder">n</span></a> <a id="E1:297" class="idref" href="#E1:297"><span class="id" title="binder">E1</span></a> <a id="E2:298" class="idref" href="#E2:298"><span class="id" title="binder">E2</span></a> <a id="out:299" class="idref" href="#out:299"><span class="id" title="binder">out</span></a> <a id="e:300" class="idref" href="#e:300"><span class="id" title="binder">e</span></a> <a id="P:301" class="idref" href="#P:301"><span class="id" title="binder">P</span></a> <a id="550b379f328e370795d0f3097fdc7e8e" class="idref" href="#550b379f328e370795d0f3097fdc7e8e"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">TCEq</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:300"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E2:298"><span class="id" title="variable">E2</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:297"><span class="id" title="variable">E1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#steps_lb"><span class="id" title="definition">steps_lb</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:296"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">|={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:297"><span class="id" title="variable">E1</span></a><span class="id" title="notation">∖</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E2:298"><span class="id" title="variable">E2</span></a><span class="id" title="notation">,</span><span class="id" title="notation">∅</span><span class="id" title="notation">}=&gt;</span> <span class="id" title="notation">|={</span><span class="id" title="notation">∅</span><span class="id" title="notation">}▷=&gt;^(</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:296"><span class="id" title="variable">n</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">|={</span><span class="id" title="notation">∅</span><span class="id" title="notation">,</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:297"><span class="id" title="variable">E1</span></a><span class="id" title="notation">∖</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E2:298"><span class="id" title="variable">E2</span></a><span class="id" title="notation">}=&gt;</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#P:301"><span class="id" title="variable">P</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:300"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:299"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E2:298"><span class="id" title="variable">E2</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">{{</span></a> <a id="v:303" class="idref" href="#v:303"><span class="id" title="binder">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#P:301"><span class="id" title="variable">P</span></a> <span class="id" title="notation">={</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:297"><span class="id" title="variable">E1</span></a><span class="id" title="notation">}=∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#550b379f328e370795d0f3097fdc7e8e"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:303"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">}}</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:300"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:299"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E1:297"><span class="id" title="variable">E1</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#550b379f328e370795d0f3097fdc7e8e"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">He</span> <span class="id" title="var">HE</span>) "Hlb HP Hwp".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?) "HM".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_step_fupdN_lb"><span class="id" title="lemma">wp_step_fupdN_lb</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>; [<span class="id" title="var">done</span>|].<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">wp_wand</span> <span class="id" title="notation">with</span> "[Hwp HM]"<span class="id" title="notation">)</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "Hwp".<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?). <span class="id" title="var">iDestruct</span> 1 <span class="id" title="keyword">as</span> (?) "(?&amp;?&amp;H)". <span class="id" title="var">iIntros</span> "HP".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"H" <span class="id" title="notation">with</span> "HP"<span class="id" title="notation">)</span>; <span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">_</span>; <span class="id" title="var">iFrame</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Recursive functions: we do not use this lemmas as it is easier to use Löb
induction directly, but this demonstrates that we can state the expected
reasoning principle for recursive functions, without any visible ▷. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="939470b230b92ed39f38700540dae862" class="idref" href="#939470b230b92ed39f38700540dae862"><span class="id" title="lemma">wbwp_rec_löb</span></a> <a id="s:304" class="idref" href="#s:304"><span class="id" title="binder">s</span></a> <a id="E:305" class="idref" href="#E:305"><span class="id" title="binder">E</span></a> <a id="f:306" class="idref" href="#f:306"><span class="id" title="binder">f</span></a> <a id="x:307" class="idref" href="#x:307"><span class="id" title="binder">x</span></a> <a id="e:308" class="idref" href="#e:308"><span class="id" title="binder">e</span></a> <a id="3a0b5ba51bda5cbb4d97c5601cf545ce" class="idref" href="#3a0b5ba51bda5cbb4d97c5601cf545ce"><span class="id" title="binder">Φ</span></a> <a id="7efa65cc5be42a4fc3d40e2f932e7087" class="idref" href="#7efa65cc5be42a4fc3d40e2f932e7087"><span class="id" title="binder">Ψ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="notation">□</span> <span class="id" title="notation">(</span> <span class="id" title="notation">□</span> <span class="id" title="notation">(</span><span class="id" title="notation">∀</span> <a id="v:311" class="idref" href="#v:311"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#7efa65cc5be42a4fc3d40e2f932e7087"><span class="id" title="variable">Ψ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:311"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#f:306"><span class="id" title="variable">f</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#x:307"><span class="id" title="variable">x</span></a> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:308"><span class="id" title="variable">e</span></a>)%<span class="id" title="var">V</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:311"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:304"><span class="id" title="variable">s</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:305"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#3a0b5ba51bda5cbb4d97c5601cf545ce"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∀</span> <a id="v:312" class="idref" href="#v:312"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#7efa65cc5be42a4fc3d40e2f932e7087"><span class="id" title="variable">Ψ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:312"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.subst'"><span class="id" title="definition">subst'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#x:307"><span class="id" title="variable">x</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:312"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.subst'"><span class="id" title="definition">subst'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#f:306"><span class="id" title="variable">f</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#f:306"><span class="id" title="variable">f</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#x:307"><span class="id" title="variable">x</span></a> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:308"><span class="id" title="variable">e</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:308"><span class="id" title="variable">e</span></a>)<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:304"><span class="id" title="variable">s</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:305"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#3a0b5ba51bda5cbb4d97c5601cf545ce"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<span class="id" title="notation">∀</span> <a id="v:313" class="idref" href="#v:313"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#7efa65cc5be42a4fc3d40e2f932e7087"><span class="id" title="variable">Ψ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:313"><span class="id" title="variable">v</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#f:306"><span class="id" title="variable">f</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#x:307"><span class="id" title="variable">x</span></a> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:308"><span class="id" title="variable">e</span></a>)%<span class="id" title="var">V</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:313"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:304"><span class="id" title="variable">s</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:305"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#3a0b5ba51bda5cbb4d97c5601cf545ce"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "#Hrec". <span class="id" title="var">iLöb</span> <span class="id" title="keyword">as</span> "IH". <span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span>) "HΨ".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.lifting.html#wbwp_pure_step_later"><span class="id" title="lemma">wbwp_pure_step_later</span></a>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt; _". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span>"Hrec" <span class="id" title="notation">with</span> "[] HΨ"<span class="id" title="notation">)</span>. <span class="id" title="var">iIntros</span> "!&gt;" (<span class="id" title="var">w</span>) "HΨ".<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span>"IH" <span class="id" title="notation">with</span> "HΨ"<span class="id" title="notation">)</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Forks&nbsp;break&nbsp;well-bracketedness!&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;<span class="comment">(**&nbsp;Fork:&nbsp;Not&nbsp;using&nbsp;Texan&nbsp;triples&nbsp;to&nbsp;avoid&nbsp;some&nbsp;unnecessary&nbsp;<span class="inlinecode"><span class="id" title="var">True</span></span>&nbsp;*)</span>&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Lemma&nbsp;wp_fork&nbsp;s&nbsp;E&nbsp;e&nbsp;Φ&nbsp;:&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;▷&nbsp;WP&nbsp;e&nbsp;@&nbsp;s;&nbsp;⊤&nbsp;{{&nbsp;_,&nbsp;True&nbsp;}}&nbsp;-∗&nbsp;▷&nbsp;Φ&nbsp;(LitV&nbsp;LitUnit)&nbsp;-∗&nbsp;WP&nbsp;Fork&nbsp;e&nbsp;@&nbsp;s;&nbsp;E&nbsp;{{&nbsp;Φ&nbsp;}}.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Proof.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;iIntros&nbsp;"He&nbsp;HΦ".&nbsp;iApply&nbsp;wp_lift_atomic_head_step;&nbsp;<span class="inlinecode"><span class="id" title="var">done</span>|</span>.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;iIntros&nbsp;(σ1&nbsp;ns&nbsp;κ&nbsp;κs&nbsp;nt)&nbsp;"(?&amp;?&amp;Hsteps)&nbsp;!&gt;";&nbsp;iSplit;&nbsp;first&nbsp;by&nbsp;eauto&nbsp;with&nbsp;head_step.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;iIntros&nbsp;"!&gt;"&nbsp;(v2&nbsp;σ2&nbsp;efs&nbsp;Hstep)&nbsp;"_";&nbsp;inv_head_step.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;iMod&nbsp;(steps_auth_update_S&nbsp;with&nbsp;"Hsteps")&nbsp;as&nbsp;"Hsteps".&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;by&nbsp;iFrame.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Qed.&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
Heap 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_allocN_seq" class="idref" href="#wbwp_allocN_seq"><span class="id" title="lemma">wbwp_allocN_seq</span></a> <a id="E:314" class="idref" href="#E:314"><span class="id" title="binder">E</span></a> <a id="out:315" class="idref" href="#out:315"><span class="id" title="binder">out</span></a> <a id="v:316" class="idref" href="#v:316"><span class="id" title="binder">v</span></a> <a id="n:317" class="idref" href="#n:317"><span class="id" title="binder">n</span></a> :<br/>
&nbsp;&nbsp;(0 <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#::Z_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:317"><span class="id" title="variable">n</span></a>)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">True</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.AllocN"><span class="id" title="constructor">AllocN</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:317"><span class="id" title="variable">n</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:316"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:315"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:314"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{{{</span></a> <a id="l:318" class="idref" href="#l:318"><span class="id" title="binder">l</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:318"><span class="id" title="variable">l</span></a>)<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">;</span></a> <span class="id" title="notation">[∗</span> <span class="id" title="notation">list</span><span class="id" title="notation">]</span> <a id="i:319" class="idref" href="#i:319"><span class="id" title="binder"><span id="i:320" class="id">i</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#seq"><span class="id" title="definition">seq</span></a> 0 (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#n:317"><span class="id" title="variable">n</span></a>)<span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:318"><span class="id" title="variable">l</span></a> <span class="id" title="notation">+ₗ</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i:319"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><span class="id" title="notation">)</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:316"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="definition">meta_token</span> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:318"><span class="id" title="variable">l</span></a> <span class="id" title="notation">+ₗ</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i:319"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><span class="id" title="notation">)</span>) <span class="id" title="notation">⊤</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">Hn</span> <span class="id" title="var">Φ</span>) "_ HΦ"; <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_allocN_seq"><span class="id" title="lemma">wp_allocN_seq</span></a>; <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_alloc" class="idref" href="#wbwp_alloc"><span class="id" title="lemma">wbwp_alloc</span></a> <a id="E:321" class="idref" href="#E:321"><span class="id" title="binder">E</span></a> <a id="out:322" class="idref" href="#out:322"><span class="id" title="binder">out</span></a> <a id="v:323" class="idref" href="#v:323"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">True</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#Alloc"><span class="id" title="abbreviation">Alloc</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:323"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:322"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:321"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{{{</span></a> <a id="l:324" class="idref" href="#l:324"><span class="id" title="binder">l</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:324"><span class="id" title="variable">l</span></a>)<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:324"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:323"><span class="id" title="variable">v</span></a> <span class="id" title="notation">∗</span> <span class="id" title="definition">meta_token</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:324"><span class="id" title="variable">l</span></a> <span class="id" title="notation">⊤</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "_ HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_alloc"><span class="id" title="lemma">wp_alloc</span></a>; <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_free" class="idref" href="#wbwp_free"><span class="id" title="lemma">wbwp_free</span></a> <a id="E:325" class="idref" href="#E:325"><span class="id" title="binder">E</span></a> <a id="out:326" class="idref" href="#out:326"><span class="id" title="binder">out</span></a> <a id="l:327" class="idref" href="#l:327"><span class="id" title="binder">l</span></a> <a id="v:328" class="idref" href="#v:328"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:327"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:328"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Free"><span class="id" title="constructor">Free</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:327"><span class="id" title="variable">l</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:326"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:325"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <span class="id" title="notation">True</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_free"><span class="id" title="lemma">wp_free</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_load" class="idref" href="#wbwp_load"><span class="id" title="lemma">wbwp_load</span></a> <a id="E:329" class="idref" href="#E:329"><span class="id" title="binder">E</span></a> <a id="out:330" class="idref" href="#out:330"><span class="id" title="binder">out</span></a> <a id="l:331" class="idref" href="#l:331"><span class="id" title="binder">l</span></a> <a id="dq:332" class="idref" href="#dq:332"><span class="id" title="binder">dq</span></a> <a id="v:333" class="idref" href="#v:333"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:331"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:332"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:333"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Load"><span class="id" title="constructor">Load</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:331"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:330"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:329"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:333"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:331"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:332"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:333"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_load"><span class="id" title="lemma">wp_load</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_store" class="idref" href="#wbwp_store"><span class="id" title="lemma">wbwp_store</span></a> <a id="E:334" class="idref" href="#E:334"><span class="id" title="binder">E</span></a> <a id="out:335" class="idref" href="#out:335"><span class="id" title="binder">out</span></a> <a id="l:336" class="idref" href="#l:336"><span class="id" title="binder">l</span></a> <a id="v':337" class="idref" href="#v':337"><span class="id" title="binder">v'</span></a> <a id="v:338" class="idref" href="#v:338"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:336"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':337"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Store"><span class="id" title="constructor">Store</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:336"><span class="id" title="variable">l</span></a>)) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:338"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:335"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:334"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:336"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:338"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_store"><span class="id" title="lemma">wp_store</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_xchg" class="idref" href="#wbwp_xchg"><span class="id" title="lemma">wbwp_xchg</span></a> <a id="E:339" class="idref" href="#E:339"><span class="id" title="binder">E</span></a> <a id="out:340" class="idref" href="#out:340"><span class="id" title="binder">out</span></a> <a id="l:341" class="idref" href="#l:341"><span class="id" title="binder">l</span></a> <a id="v':342" class="idref" href="#v':342"><span class="id" title="binder">v'</span></a> <a id="v:343" class="idref" href="#v:343"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:341"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':342"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Xchg"><span class="id" title="constructor">Xchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:341"><span class="id" title="variable">l</span></a>)) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:343"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:340"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:339"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':342"><span class="id" title="variable">v'</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:341"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:343"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_xchg"><span class="id" title="lemma">wp_xchg</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_cmpxchg_fail" class="idref" href="#wbwp_cmpxchg_fail"><span class="id" title="lemma">wbwp_cmpxchg_fail</span></a> <a id="E:344" class="idref" href="#E:344"><span class="id" title="binder">E</span></a> <a id="out:345" class="idref" href="#out:345"><span class="id" title="binder">out</span></a> <a id="l:346" class="idref" href="#l:346"><span class="id" title="binder">l</span></a> <a id="dq:347" class="idref" href="#dq:347"><span class="id" title="binder">dq</span></a> <a id="v':348" class="idref" href="#v':348"><span class="id" title="binder">v'</span></a> <a id="v1:349" class="idref" href="#v1:349"><span class="id" title="binder">v1</span></a> <a id="v2:350" class="idref" href="#v2:350"><span class="id" title="binder">v2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':348"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:349"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':348"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:349"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:346"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:347"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':348"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:346"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:349"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:350"><span class="id" title="variable">v2</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:345"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:344"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':348"><span class="id" title="variable">v'</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:346"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#dq:347"><span class="id" title="variable">dq</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':348"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (? ? <span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_cmpxchg_fail"><span class="id" title="lemma">wp_cmpxchg_fail</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>; <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_cmpxchg_suc" class="idref" href="#wbwp_cmpxchg_suc"><span class="id" title="lemma">wbwp_cmpxchg_suc</span></a> <a id="E:351" class="idref" href="#E:351"><span class="id" title="binder">E</span></a> <a id="out:352" class="idref" href="#out:352"><span class="id" title="binder">out</span></a> <a id="l:353" class="idref" href="#l:353"><span class="id" title="binder">l</span></a> <a id="v1:354" class="idref" href="#v1:354"><span class="id" title="binder">v1</span></a> <a id="v2:355" class="idref" href="#v2:355"><span class="id" title="binder">v2</span></a> <a id="v':356" class="idref" href="#v':356"><span class="id" title="binder">v'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':356"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:354"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':356"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:354"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:353"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':356"><span class="id" title="variable">v'</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:353"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v1:354"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:355"><span class="id" title="variable">v2</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:352"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:351"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v':356"><span class="id" title="variable">v'</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:353"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v2:355"><span class="id" title="variable">v2</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (?? <span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_cmpxchg_suc"><span class="id" title="lemma">wp_cmpxchg_suc</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>; <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_faa" class="idref" href="#wbwp_faa"><span class="id" title="lemma">wbwp_faa</span></a> <a id="E:357" class="idref" href="#E:357"><span class="id" title="binder">E</span></a> <a id="out:358" class="idref" href="#out:358"><span class="id" title="binder">out</span></a> <a id="l:359" class="idref" href="#l:359"><span class="id" title="binder">l</span></a> <a id="i1:360" class="idref" href="#i1:360"><span class="id" title="binder">i1</span></a> <a id="i2:361" class="idref" href="#i2:361"><span class="id" title="binder">i2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:359"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:360"><span class="id" title="variable">i1</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.FAA"><span class="id" title="constructor">FAA</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:359"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i2:361"><span class="id" title="variable">i2</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:358"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:357"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:360"><span class="id" title="variable">i1</span></a>)<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#l:359"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i1:360"><span class="id" title="variable">i1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#i2:361"><span class="id" title="variable">i2</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "&gt;H HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_faa"><span class="id" title="lemma">wp_faa</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_new_proph" class="idref" href="#wbwp_new_proph"><span class="id" title="lemma">wbwp_new_proph</span></a> <a id="E:362" class="idref" href="#E:362"><span class="id" title="binder">E</span></a> <a id="out:363" class="idref" href="#out:363"><span class="id" title="binder">out</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{{</span></a> <span class="id" title="notation">True</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">}}}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.NewProph"><span class="id" title="constructor">NewProph</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:363"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:362"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{{{</span></a> <a id="pvs:364" class="idref" href="#pvs:364"><span class="id" title="binder">pvs</span></a> <a id="p:365" class="idref" href="#p:365"><span class="id" title="binder">p</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitProphecy"><span class="id" title="constructor">LitProphecy</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:365"><span class="id" title="variable">p</span></a>)<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">);</span></a> <span class="id" title="definition">proph</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:365"><span class="id" title="variable">p</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs:364"><span class="id" title="variable">pvs</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "_ HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_new_proph"><span class="id" title="lemma">wp_new_proph</span></a> <span class="id" title="notation">with</span> "[$] [$]"<span class="id" title="notation">)</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Specification for <span class="inlinecode"><span class="id" title="var">emit</span></span>. Adds an event to the trace. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="wbwp_emit" class="idref" href="#wbwp_emit"><span class="id" title="lemma">wbwp_emit</span></a> <a id="s:366" class="idref" href="#s:366"><span class="id" title="binder">s</span></a> <a id="E:367" class="idref" href="#E:367"><span class="id" title="binder">E</span></a> <a id="tr:368" class="idref" href="#tr:368"><span class="id" title="binder">tr</span></a> <a id="v:369" class="idref" href="#v:369"><span class="id" title="binder">v</span></a> <a id="N:370" class="idref" href="#N:370"><span class="id" title="binder">N</span></a> (<a id="I:371" class="idref" href="#I:371"><span class="id" title="binder">I</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="notation">↑</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#N:370"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:367"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:371"><span class="id" title="variable">I</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:368"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:369"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_is"><span class="id" title="definition">trace_is</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:368"><span class="id" title="variable">tr</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_inv"><span class="id" title="definition">trace_inv</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#N:370"><span class="id" title="variable">N</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:371"><span class="id" title="variable">I</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Emit"><span class="id" title="constructor">Emit</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:369"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:366"><span class="id" title="variable">s</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:367"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">);</span></a> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_is"><span class="id" title="definition">trace_is</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:368"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:369"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#b123b7ada5e8681df69d4380d42f51d4"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (? ? <span class="id" title="var">Φ</span>) "? HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_emit"><span class="id" title="lemma">wp_emit</span></a> <span class="id" title="notation">with</span> "[$]"<span class="id" title="notation">)</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Specification for <span class="inlinecode"><span class="id" title="tactic">fresh</span></span>. Emits an event annotated with a fresh tag. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="wbwp_fresh" class="idref" href="#wbwp_fresh"><span class="id" title="lemma">wbwp_fresh</span></a> <a id="s:372" class="idref" href="#s:372"><span class="id" title="binder">s</span></a> <a id="E:373" class="idref" href="#E:373"><span class="id" title="binder">E</span></a> <a id="tr:374" class="idref" href="#tr:374"><span class="id" title="binder">tr</span></a> <a id="v:375" class="idref" href="#v:375"><span class="id" title="binder">v</span></a> <a id="N:376" class="idref" href="#N:376"><span class="id" title="binder">N</span></a> (<a id="I:377" class="idref" href="#I:377"><span class="id" title="binder">I</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="notation">↑</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#N:376"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:373"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">(</span></a><a id="tag:378" class="idref" href="#tag:378"><span class="id" title="binder">tag</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">),</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:378"><span class="id" title="variable">tag</span></a> <span class="id" title="notation">∉</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.tags"><span class="id" title="definition">tags</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:374"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:377"><span class="id" title="variable">I</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:374"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:378"><span class="id" title="variable">tag</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:375"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">)</span></a>%<span class="id" title="var">V</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">WB</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_is"><span class="id" title="definition">trace_is</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:374"><span class="id" title="variable">tr</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_inv"><span class="id" title="definition">trace_inv</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#N:376"><span class="id" title="variable">N</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#I:377"><span class="id" title="variable">I</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">}}}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Fresh"><span class="id" title="constructor">Fresh</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:375"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#s:372"><span class="id" title="variable">s</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:373"><span class="id" title="variable">E</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">{{{</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">(</span></a><a id="tag:379" class="idref" href="#tag:379"><span class="id" title="binder">tag</span></a>:<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">),</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">RET</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:379"><span class="id" title="variable">tag</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">);</span></a> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#trace_is"><span class="id" title="definition">trace_is</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:374"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:379"><span class="id" title="variable">tag</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:375"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.heap_lang_trace.notation.html#cc14470b8443804ba405fa710525256d"><span class="id" title="notation">)</span></a>%<span class="id" title="var">V</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>) <span class="id" title="notation">∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tag:379"><span class="id" title="variable">tag</span></a> <span class="id" title="notation">∉</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.tags"><span class="id" title="definition">tags</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#tr:374"><span class="id" title="variable">tr</span></a><span class="id" title="notation">⌝</span><a class="idref" href="WBLogic.program_logic.weakestpre.html#f18ec7e1f1ac01c7be72b6f7a2b0e622"><span class="id" title="notation">}}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">iIntros</span> (? ? <span class="id" title="var">Φ</span>) "? HΦ". <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_wbwp"><span class="id" title="lemma">wp_wbwp</span></a>; <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_fresh"><span class="id" title="lemma">wp_fresh</span></a> <span class="id" title="notation">with</span> "[$]"<span class="id" title="notation">)</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;In&nbsp;the&nbsp;following,&nbsp;strong&nbsp;atomicity&nbsp;is&nbsp;required&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">e</span></span>&nbsp;must<br/>
be&nbsp;able&nbsp;to&nbsp;make&nbsp;a&nbsp;head&nbsp;step&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="keyword">Resolve</span></span> <span class="inlinecode"><span class="id" title="var">e</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;not&nbsp;to&nbsp;be&nbsp;(head)&nbsp;stuck.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="wbwp_resolve" class="idref" href="#wbwp_resolve"><span class="id" title="lemma">wbwp_resolve</span></a> <a id="E:380" class="idref" href="#E:380"><span class="id" title="binder">E</span></a> <a id="out:381" class="idref" href="#out:381"><span class="id" title="binder">out</span></a> <a id="e:382" class="idref" href="#e:382"><span class="id" title="binder">e</span></a> <a id="0d760e37269cacee36b3a38abc8407d2" class="idref" href="#0d760e37269cacee36b3a38abc8407d2"><span class="id" title="binder">Φ</span></a> (<a id="p:384" class="idref" href="#p:384"><span class="id" title="binder">p</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.proph_id"><span class="id" title="definition">proph_id</span></a>) <a id="v:385" class="idref" href="#v:385"><span class="id" title="binder">v</span></a> (<a id="pvs:386" class="idref" href="#pvs:386"><span class="id" title="binder">pvs</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>)) :<br/>
&nbsp;&nbsp;<span class="id" title="class">Atomic</span> <span class="id" title="constructor">StronglyAtomic</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:382"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.to_val"><span class="id" title="definition">to_val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:382"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">proph</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:384"><span class="id" title="variable">p</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs:386"><span class="id" title="variable">pvs</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:382"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:381"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:380"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">{{</span></a> <a id="r:387" class="idref" href="#r:387"><span class="id" title="binder">r</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">,</span></a> <span class="id" title="notation">∀</span> <a id="pvs':388" class="idref" href="#pvs':388"><span class="id" title="binder">pvs'</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs:386"><span class="id" title="variable">pvs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#r:387"><span class="id" title="variable">r</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:385"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs':388"><span class="id" title="variable">pvs'</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">-∗</span> <span class="id" title="definition">proph</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:384"><span class="id" title="variable">p</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#pvs':388"><span class="id" title="variable">pvs'</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0d760e37269cacee36b3a38abc8407d2"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#r:387"><span class="id" title="variable">r</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">}}</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Resolve"><span class="id" title="constructor">Resolve</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#e:382"><span class="id" title="variable">e</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitProphecy"><span class="id" title="constructor">LitProphecy</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#p:384"><span class="id" title="variable">p</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#v:385"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#out:381"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#E:380"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#0d760e37269cacee36b3a38abc8407d2"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (??) "Hpr HWBWP".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?) "HM". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_resolve"><span class="id" title="lemma">wp_resolve</span></a> <span class="id" title="notation">with</span> "[$]"<span class="id" title="notation">)</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">wp_wand</span> <span class="id" title="notation">with</span> "[HWBWP HM]"<span class="id" title="notation">)</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HWBWP".<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?); <span class="id" title="var">iDestruct</span> 1 <span class="id" title="keyword">as</span> (?) "(?&amp;?&amp;H)".<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (? ?) "?".<br/>
&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">_</span>; <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iApply</span> "H"; <span class="id" title="var">done</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#lifting"><span class="id" title="section">lifting</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
