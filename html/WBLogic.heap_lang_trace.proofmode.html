<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../index.html">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">WBLogic.heap_lang_trace.proofmode</h1>

<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">From</span> <span class="id" title="var">iris.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">coq_tactics</span> <span class="id" title="library">reduction</span> <span class="id" title="library">spec_patterns</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">tactics</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.program_logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">atomic</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.heap_lang_trace</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="WBLogic.heap_lang_trace.trace_resources.html#"><span class="id" title="library">trace_resources</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.heap_lang_trace</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="WBLogic.heap_lang_trace.tactics.html#"><span class="id" title="library">tactics</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#"><span class="id" title="library">primitive_laws</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">WBLogic.heap_lang_trace</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="WBLogic.heap_lang_trace.notation.html#"><span class="id" title="library">notation</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.prelude</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">options</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="module">uPred</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_expr_eval" class="idref" href="#tac_wp_expr_eval"><span class="id" title="lemma">tac_wp_expr_eval</span></a> `{<a id="wbheapGS0:2" class="idref" href="#wbheapGS0:2"><span class="id" title="binder">!</span></a><a id="wbheapGS0:2" class="idref" href="#wbheapGS0:2"><span class="id" title="binder">wbheapGS</span></a> <a id="0101b9beac487b383a5ba2a8f6922788" class="idref" href="#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="binder"><span id="wbheapGS0:2" class="id">Σ</span></span></a>} <a id="70086898232ea9f35274651a64a6780a" class="idref" href="#70086898232ea9f35274651a64a6780a"><span class="id" title="binder">Δ</span></a> <a id="s:4" class="idref" href="#s:4"><span class="id" title="binder">s</span></a> <a id="E:5" class="idref" href="#E:5"><span class="id" title="binder">E</span></a> <a id="f4f4f3cda8233c03492a392432920388" class="idref" href="#f4f4f3cda8233c03492a392432920388"><span class="id" title="binder">Φ</span></a> <a id="e:7" class="idref" href="#e:7"><span class="id" title="binder">e</span></a> <a id="e':8" class="idref" href="#e':8"><span class="id" title="binder">e'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">(</span></a><a id="e'':9" class="idref" href="#e'':9"><span class="id" title="binder">e''</span></a>:=<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e':8"><span class="id" title="variable">e'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">),</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:7"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e'':9"><span class="id" title="variable">e''</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#70086898232ea9f35274651a64a6780a"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e':8"><span class="id" title="variable">e'</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:4"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:5"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f4f4f3cda8233c03492a392432920388"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#70086898232ea9f35274651a64a6780a"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:7"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:4"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:5"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f4f4f3cda8233c03492a392432920388"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">intros</span> -&gt;. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_expr_eval" class="idref" href="#tac_twp_expr_eval"><span class="id" title="lemma">tac_twp_expr_eval</span></a> `{<a id="wbheapGS0:11" class="idref" href="#wbheapGS0:11"><span class="id" title="binder">!</span></a><a id="wbheapGS0:11" class="idref" href="#wbheapGS0:11"><span class="id" title="binder">wbheapGS</span></a> <a id="2ab75602e9b8af2ca6fd6dbdb1e68a19" class="idref" href="#2ab75602e9b8af2ca6fd6dbdb1e68a19"><span class="id" title="binder"><span id="wbheapGS0:11" class="id">Σ</span></span></a>} <a id="4486f22a746bf7e8d11c811eaad4efd7" class="idref" href="#4486f22a746bf7e8d11c811eaad4efd7"><span class="id" title="binder">Δ</span></a> <a id="s:13" class="idref" href="#s:13"><span class="id" title="binder">s</span></a> <a id="E:14" class="idref" href="#E:14"><span class="id" title="binder">E</span></a> <a id="f5af5be01b05ea888980eb3fd3d8049b" class="idref" href="#f5af5be01b05ea888980eb3fd3d8049b"><span class="id" title="binder">Φ</span></a> <a id="e:16" class="idref" href="#e:16"><span class="id" title="binder">e</span></a> <a id="e':17" class="idref" href="#e':17"><span class="id" title="binder">e'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">(</span></a><a id="e'':18" class="idref" href="#e'':18"><span class="id" title="binder">e''</span></a>:=<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e':17"><span class="id" title="variable">e'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">),</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:16"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e'':18"><span class="id" title="variable">e''</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#4486f22a746bf7e8d11c811eaad4efd7"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e':17"><span class="id" title="variable">e'</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:13"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:14"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f5af5be01b05ea888980eb3fd3d8049b"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#4486f22a746bf7e8d11c811eaad4efd7"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:16"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:13"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:14"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f5af5be01b05ea888980eb3fd3d8049b"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">intros</span> -&gt;. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_expr_eval" <span class="id" title="var">tactic3</span>(<span class="id" title="var">t</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">notypeclasses</span> <span class="id" title="tactic">refine</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_expr_eval"><span class="id" title="lemma">tac_wp_expr_eval</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">e</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="var">t</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">x</span>; <span class="id" title="var">notypeclasses</span> <span class="id" title="tactic">refine</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>|]<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">notypeclasses</span> <span class="id" title="tactic">refine</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_expr_eval"><span class="id" title="lemma">tac_twp_expr_eval</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">e</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="var">t</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">x</span>; <span class="id" title="var">notypeclasses</span> <span class="id" title="tactic">refine</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>|]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_expr_eval: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wp_expr_simpl</span> := <span class="id" title="var">wp_expr_eval</span> <span class="id" title="tactic">simpl</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_pure" class="idref" href="#tac_wp_pure"><span class="id" title="lemma">tac_wp_pure</span></a> `{<a id="wbheapGS0:20" class="idref" href="#wbheapGS0:20"><span class="id" title="binder">!</span></a><a id="wbheapGS0:20" class="idref" href="#wbheapGS0:20"><span class="id" title="binder">wbheapGS</span></a> <a id="957e39afe9f7f3b3133a35f49f47db88" class="idref" href="#957e39afe9f7f3b3133a35f49f47db88"><span class="id" title="binder"><span id="wbheapGS0:20" class="id">Σ</span></span></a>} <a id="531c023394dd914fd03e5fa3ca768114" class="idref" href="#531c023394dd914fd03e5fa3ca768114"><span class="id" title="binder">Δ</span></a> <a id="3ea4882ebc23f7a1f98c5f2e10f555f3" class="idref" href="#3ea4882ebc23f7a1f98c5f2e10f555f3"><span class="id" title="binder">Δ'</span></a> <a id="s:23" class="idref" href="#s:23"><span class="id" title="binder">s</span></a> <a id="E:24" class="idref" href="#E:24"><span class="id" title="binder">E</span></a> <a id="K:25" class="idref" href="#K:25"><span class="id" title="binder">K</span></a> <a id="e1:26" class="idref" href="#e1:26"><span class="id" title="binder">e1</span></a> <a id="e2:27" class="idref" href="#e2:27"><span class="id" title="binder">e2</span></a> <a id="b3edb256fccb76e3c292eb66d9c38347" class="idref" href="#b3edb256fccb76e3c292eb66d9c38347"><span class="id" title="binder">φ</span></a> <a id="n:29" class="idref" href="#n:29"><span class="id" title="binder">n</span></a> <a id="01a46550ac8db3a3545feae0533fc1da" class="idref" href="#01a46550ac8db3a3545feae0533fc1da"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">PureExec</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b3edb256fccb76e3c292eb66d9c38347"><span class="id" title="variable">φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#n:29"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:26"><span class="id" title="variable">e1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:27"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b3edb256fccb76e3c292eb66d9c38347"><span class="id" title="variable">φ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#n:29"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#531c023394dd914fd03e5fa3ca768114"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#3ea4882ebc23f7a1f98c5f2e10f555f3"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#3ea4882ebc23f7a1f98c5f2e10f555f3"><span class="id" title="variable">Δ'</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:25"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:27"><span class="id" title="variable">e2</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:23"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:24"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#01a46550ac8db3a3545feae0533fc1da"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#531c023394dd914fd03e5fa3ca768114"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:25"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:26"><span class="id" title="variable">e1</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:23"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:24"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#01a46550ac8db3a3545feae0533fc1da"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">HΔ'</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> /=.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;want&nbsp;<span class="inlinecode"><span class="id" title="var">pure_exec_fill</span></span>&nbsp;to&nbsp;be&nbsp;available&nbsp;to&nbsp;TC&nbsp;search&nbsp;locally.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<span class="id" title="lemma">pure_exec_fill</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">HΔ'</span> -<span class="id" title="lemma">lifting.wp_pure_step_later</span> //.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hwp !&gt; _" =&gt; //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_pure" class="idref" href="#tac_twp_pure"><span class="id" title="lemma">tac_twp_pure</span></a> `{<a id="wbheapGS0:32" class="idref" href="#wbheapGS0:32"><span class="id" title="binder">!</span></a><a id="wbheapGS0:32" class="idref" href="#wbheapGS0:32"><span class="id" title="binder">wbheapGS</span></a> <a id="7374d4818eab9c7e7a123322e5aab0bf" class="idref" href="#7374d4818eab9c7e7a123322e5aab0bf"><span class="id" title="binder"><span id="wbheapGS0:32" class="id">Σ</span></span></a>} <a id="b73faf325f76646787a7bae4ee8ea0fb" class="idref" href="#b73faf325f76646787a7bae4ee8ea0fb"><span class="id" title="binder">Δ</span></a> <a id="s:34" class="idref" href="#s:34"><span class="id" title="binder">s</span></a> <a id="E:35" class="idref" href="#E:35"><span class="id" title="binder">E</span></a> <a id="K:36" class="idref" href="#K:36"><span class="id" title="binder">K</span></a> <a id="e1:37" class="idref" href="#e1:37"><span class="id" title="binder">e1</span></a> <a id="e2:38" class="idref" href="#e2:38"><span class="id" title="binder">e2</span></a> <a id="f670e0558f9ccb8c272365f4c1295f3f" class="idref" href="#f670e0558f9ccb8c272365f4c1295f3f"><span class="id" title="binder">φ</span></a> <a id="n:40" class="idref" href="#n:40"><span class="id" title="binder">n</span></a> <a id="41d18e8a2b2e573b496086c21c3c16d4" class="idref" href="#41d18e8a2b2e573b496086c21c3c16d4"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">PureExec</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f670e0558f9ccb8c272365f4c1295f3f"><span class="id" title="variable">φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#n:40"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:37"><span class="id" title="variable">e1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:38"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f670e0558f9ccb8c272365f4c1295f3f"><span class="id" title="variable">φ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b73faf325f76646787a7bae4ee8ea0fb"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:36"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:38"><span class="id" title="variable">e2</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:34"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:35"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#41d18e8a2b2e573b496086c21c3c16d4"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b73faf325f76646787a7bae4ee8ea0fb"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:36"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:37"><span class="id" title="variable">e1</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:34"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:35"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#41d18e8a2b2e573b496086c21c3c16d4"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?? -&gt;.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;want&nbsp;<span class="inlinecode"><span class="id" title="var">pure_exec_fill</span></span>&nbsp;to&nbsp;be&nbsp;available&nbsp;to&nbsp;TC&nbsp;search&nbsp;locally.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<span class="id" title="lemma">pure_exec_fill</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">total_lifting.twp_pure_step</span> //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_pure_credit" class="idref" href="#tac_wp_pure_credit"><span class="id" title="lemma">tac_wp_pure_credit</span></a> `{<a id="wbheapGS0:43" class="idref" href="#wbheapGS0:43"><span class="id" title="binder">!</span></a><a id="wbheapGS0:43" class="idref" href="#wbheapGS0:43"><span class="id" title="binder">wbheapGS</span></a> <a id="9cdd3744fef7e647d555c1b5b5ffd982" class="idref" href="#9cdd3744fef7e647d555c1b5b5ffd982"><span class="id" title="binder"><span id="wbheapGS0:43" class="id">Σ</span></span></a>} <a id="588d335e7ef83ff38b48f3b650112d02" class="idref" href="#588d335e7ef83ff38b48f3b650112d02"><span class="id" title="binder">Δ</span></a> <a id="e82a4e67a07a1bcca909b531b7e35eb8" class="idref" href="#e82a4e67a07a1bcca909b531b7e35eb8"><span class="id" title="binder">Δ'</span></a> <a id="s:46" class="idref" href="#s:46"><span class="id" title="binder">s</span></a> <a id="E:47" class="idref" href="#E:47"><span class="id" title="binder">E</span></a> <a id="j:48" class="idref" href="#j:48"><span class="id" title="binder">j</span></a> <a id="K:49" class="idref" href="#K:49"><span class="id" title="binder">K</span></a> <a id="e1:50" class="idref" href="#e1:50"><span class="id" title="binder">e1</span></a> <a id="e2:51" class="idref" href="#e2:51"><span class="id" title="binder">e2</span></a> <a id="198e589decd671952fc759985afc1dcd" class="idref" href="#198e589decd671952fc759985afc1dcd"><span class="id" title="binder">ϕ</span></a> <a id="e3ea349e0334713a705d94b9b7301960" class="idref" href="#e3ea349e0334713a705d94b9b7301960"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">PureExec</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#198e589decd671952fc759985afc1dcd"><span class="id" title="variable">ϕ</span></a> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:50"><span class="id" title="variable">e1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:51"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#198e589decd671952fc759985afc1dcd"><span class="id" title="variable">ϕ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#588d335e7ef83ff38b48f3b650112d02"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e82a4e67a07a1bcca909b531b7e35eb8"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_app</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#j:48"><span class="id" title="variable">j</span></a> (<span class="id" title="notation">£</span> 1)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e82a4e67a07a1bcca909b531b7e35eb8"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:49"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:51"><span class="id" title="variable">e2</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:46"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:47"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e3ea349e0334713a705d94b9b7301960"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#588d335e7ef83ff38b48f3b650112d02"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:49"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:50"><span class="id" title="variable">e1</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:46"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:47"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e3ea349e0334713a705d94b9b7301960"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">HΔ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<span class="id" title="lemma">pure_exec_fill</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">lifting.wp_pure_step_later</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> /=. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_app</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_app_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_r</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">wand_elim_l</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_value_nofupd" class="idref" href="#tac_wp_value_nofupd"><span class="id" title="lemma">tac_wp_value_nofupd</span></a> `{<a id="wbheapGS0:55" class="idref" href="#wbheapGS0:55"><span class="id" title="binder">!</span></a><a id="wbheapGS0:55" class="idref" href="#wbheapGS0:55"><span class="id" title="binder">wbheapGS</span></a> <a id="7674e0ce7f4ec5e4ff169924724c4b41" class="idref" href="#7674e0ce7f4ec5e4ff169924724c4b41"><span class="id" title="binder"><span id="wbheapGS0:55" class="id">Σ</span></span></a>} <a id="b1a57856048453fcdbc9d8258f6ba85e" class="idref" href="#b1a57856048453fcdbc9d8258f6ba85e"><span class="id" title="binder">Δ</span></a> <a id="s:57" class="idref" href="#s:57"><span class="id" title="binder">s</span></a> <a id="E:58" class="idref" href="#E:58"><span class="id" title="binder">E</span></a> <a id="49fb82757c559b3be20bc76fe0458281" class="idref" href="#49fb82757c559b3be20bc76fe0458281"><span class="id" title="binder">Φ</span></a> <a id="v:60" class="idref" href="#v:60"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b1a57856048453fcdbc9d8258f6ba85e"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#49fb82757c559b3be20bc76fe0458281"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:60"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b1a57856048453fcdbc9d8258f6ba85e"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:60"><span class="id" title="variable">v</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:57"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:58"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#49fb82757c559b3be20bc76fe0458281"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wp_value</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_value_nofupd" class="idref" href="#tac_twp_value_nofupd"><span class="id" title="lemma">tac_twp_value_nofupd</span></a> `{<a id="wbheapGS0:62" class="idref" href="#wbheapGS0:62"><span class="id" title="binder">!</span></a><a id="wbheapGS0:62" class="idref" href="#wbheapGS0:62"><span class="id" title="binder">wbheapGS</span></a> <a id="77616297ab8389c2db18b8aa996822b8" class="idref" href="#77616297ab8389c2db18b8aa996822b8"><span class="id" title="binder"><span id="wbheapGS0:62" class="id">Σ</span></span></a>} <a id="e5ddef8d847fa32d981296095a07b625" class="idref" href="#e5ddef8d847fa32d981296095a07b625"><span class="id" title="binder">Δ</span></a> <a id="s:64" class="idref" href="#s:64"><span class="id" title="binder">s</span></a> <a id="E:65" class="idref" href="#E:65"><span class="id" title="binder">E</span></a> <a id="d7d2fb85a05518e3f033c3167dccdae6" class="idref" href="#d7d2fb85a05518e3f033c3167dccdae6"><span class="id" title="binder">Φ</span></a> <a id="v:67" class="idref" href="#v:67"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e5ddef8d847fa32d981296095a07b625"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#d7d2fb85a05518e3f033c3167dccdae6"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:67"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e5ddef8d847fa32d981296095a07b625"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:67"><span class="id" title="variable">v</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:64"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:65"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#d7d2fb85a05518e3f033c3167dccdae6"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">twp_value</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_value" class="idref" href="#tac_wp_value"><span class="id" title="lemma">tac_wp_value</span></a> `{<a id="wbheapGS0:69" class="idref" href="#wbheapGS0:69"><span class="id" title="binder">!</span></a><a id="wbheapGS0:69" class="idref" href="#wbheapGS0:69"><span class="id" title="binder">wbheapGS</span></a> <a id="8d0ba020def2f27826d5cbe2d613c0cf" class="idref" href="#8d0ba020def2f27826d5cbe2d613c0cf"><span class="id" title="binder"><span id="wbheapGS0:69" class="id">Σ</span></span></a>} <a id="8f968192e18ee121db66203c0893cd62" class="idref" href="#8f968192e18ee121db66203c0893cd62"><span class="id" title="binder">Δ</span></a> <a id="s:71" class="idref" href="#s:71"><span class="id" title="binder">s</span></a> <a id="E:72" class="idref" href="#E:72"><span class="id" title="binder">E</span></a> (<a id="008858fd693db6f5aa77f1f7c6d2fd58" class="idref" href="#008858fd693db6f5aa77f1f7c6d2fd58"><span class="id" title="binder">Φ</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iPropI</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8d0ba020def2f27826d5cbe2d613c0cf"><span class="id" title="variable">Σ</span></a>) <a id="v:74" class="idref" href="#v:74"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8f968192e18ee121db66203c0893cd62"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">|={</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:72"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=&gt;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#008858fd693db6f5aa77f1f7c6d2fd58"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:74"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8f968192e18ee121db66203c0893cd62"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:74"><span class="id" title="variable">v</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:71"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:72"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#008858fd693db6f5aa77f1f7c6d2fd58"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">wp_value_fupd</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_value" class="idref" href="#tac_twp_value"><span class="id" title="lemma">tac_twp_value</span></a> `{<a id="wbheapGS0:76" class="idref" href="#wbheapGS0:76"><span class="id" title="binder">!</span></a><a id="wbheapGS0:76" class="idref" href="#wbheapGS0:76"><span class="id" title="binder">wbheapGS</span></a> <a id="5e616d60b6019fd1fcdddd9ee38e237a" class="idref" href="#5e616d60b6019fd1fcdddd9ee38e237a"><span class="id" title="binder"><span id="wbheapGS0:76" class="id">Σ</span></span></a>} <a id="c547ef66520605a4a48b0782100af2d4" class="idref" href="#c547ef66520605a4a48b0782100af2d4"><span class="id" title="binder">Δ</span></a> <a id="s:78" class="idref" href="#s:78"><span class="id" title="binder">s</span></a> <a id="E:79" class="idref" href="#E:79"><span class="id" title="binder">E</span></a> (<a id="efbda7adfd0eb3fbdfb6dad4ab59b902" class="idref" href="#efbda7adfd0eb3fbdfb6dad4ab59b902"><span class="id" title="binder">Φ</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iPropI</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5e616d60b6019fd1fcdddd9ee38e237a"><span class="id" title="variable">Σ</span></a>) <a id="v:81" class="idref" href="#v:81"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c547ef66520605a4a48b0782100af2d4"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">|={</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:79"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=&gt;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#efbda7adfd0eb3fbdfb6dad4ab59b902"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:81"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c547ef66520605a4a48b0782100af2d4"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:81"><span class="id" title="variable">v</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:78"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:79"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#efbda7adfd0eb3fbdfb6dad4ab59b902"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">twp_value_fupd</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Simplify the goal if it is <span class="inlinecode"><span class="id" title="var">WP</span></span> of a value.
  If the postcondition already allows a fupd, do not add a second one.
  But otherwise, *do* add a fupd. This ensures that all the lemmas applied
  here are bidirectional, so we never will make a goal unprovable. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wp_value_head</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">fupd</span> ?<span class="id" title="var">E</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_value_nofupd"><span class="id" title="lemma">tac_wp_value_nofupd</span></a><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">wp</span> <span class="id" title="var">_</span> ?<span class="id" title="var">E</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_value_nofupd"><span class="id" title="lemma">tac_wp_value_nofupd</span></a><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_value"><span class="id" title="lemma">tac_wp_value</span></a><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">fupd</span> ?<span class="id" title="var">E</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_value_nofupd"><span class="id" title="lemma">tac_twp_value_nofupd</span></a><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">twp</span> <span class="id" title="var">_</span> ?<span class="id" title="var">E</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_value_nofupd"><span class="id" title="lemma">tac_twp_value_nofupd</span></a><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_value"><span class="id" title="lemma">tac_twp_value</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wp_finish</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wp_expr_simpl</span>;      <span class="comment">(*&nbsp;simplify&nbsp;occurences&nbsp;of&nbsp;subst/fill&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">wp_value_head</span>;  <span class="comment">(*&nbsp;in&nbsp;case&nbsp;we&nbsp;have&nbsp;reached&nbsp;a&nbsp;value,&nbsp;get&nbsp;rid&nbsp;of&nbsp;the&nbsp;WP&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">pm_prettify</span>. <span class="comment">(*&nbsp;prettify&nbsp;▷s&nbsp;caused&nbsp;by&nbsp;<span class="inlinecode"><span class="id" title="var">MaybeIntoLaterNEnvs</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;λs&nbsp;caused&nbsp;by&nbsp;wp_value&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">solve_vals_compare_safe</span> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;first&nbsp;branch&nbsp;is&nbsp;for&nbsp;when&nbsp;we&nbsp;have&nbsp;<span class="inlinecode"><span class="id" title="var">vals_compare_safe</span></span>&nbsp;in&nbsp;the&nbsp;context.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;other&nbsp;two&nbsp;branches&nbsp;are&nbsp;for&nbsp;when&nbsp;either&nbsp;one&nbsp;of&nbsp;the&nbsp;branches&nbsp;reduces&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">True</span></span>&nbsp;or&nbsp;we&nbsp;have&nbsp;it&nbsp;in&nbsp;the&nbsp;context.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">fast_done</span> || (<span class="id" title="tactic">left</span>; <span class="id" title="var">fast_done</span>) || (<span class="id" title="tactic">right</span>; <span class="id" title="var">fast_done</span>).<br/>

<br/>
</div>

<div class="doc">
The argument <span class="inlinecode"><span class="id" title="var">efoc</span></span> can be used to specify the construct that should be
reduced. For example, you can write <span class="inlinecode"><span class="id" title="var">wp_pure</span></span> <span class="inlinecode">(<span class="id" title="var">EIf</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>, which will search
for an <span class="inlinecode"><span class="id" title="var">EIf</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> in the expression, and reduce it.

<div class="paragraph"> </div>

The use of <span class="inlinecode"><span class="id" title="var">open_constr</span></span> in this tactic is essential. It will convert all holes
(i.e. <span class="inlinecode"><span class="id" title="var">_</span></span>s) into evars, that later get unified when an occurences is found
(see <span class="inlinecode"><span class="id" title="var">unify</span></span> <span class="inlinecode"><span class="id" title="var">e'</span></span> <span class="inlinecode"><span class="id" title="var">efoc</span></span> in the code below). 
</div>
<div class="code">
<span class="id" title="keyword">Tactic Notation</span> "wp_pure" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">e</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_pure"><span class="id" title="lemma">tac_wp_pure</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;PureExec&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span>    <span class="comment">(*&nbsp;The&nbsp;pure&nbsp;condition&nbsp;for&nbsp;PureExec&nbsp;--<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handles&nbsp;trivial&nbsp;goals,&nbsp;including&nbsp;<span class="inlinecode"><span class="id" title="var">vals_compare_safe</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;IntoLaters&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wp_finish</span>                      <span class="comment">(*&nbsp;new&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" title="tactic">fail</span> "wp_pure: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> "or" <span class="id" title="var">efoc</span> "is not a redex"<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">e</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_pure"><span class="id" title="lemma">tac_twp_pure</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;PureExec&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span>    <span class="comment">(*&nbsp;The&nbsp;pure&nbsp;condition&nbsp;for&nbsp;PureExec&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wp_finish</span>                      <span class="comment">(*&nbsp;new&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" title="tactic">fail</span> "wp_pure: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> "or" <span class="id" title="var">efoc</span> "is not a redex"<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_pure: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_pure" :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pure</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_pure" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) "credit:" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Htmp</span> := <span class="id" title="var">iFresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">finish</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pm_reduce</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">iDestructHyp</span> <span class="id" title="var">Htmp</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H</span> || <span class="id" title="tactic">fail</span> 2 "wp_pure:" <span class="id" title="var">H</span> "is not fresh");<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">e</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_pure_credit"><span class="id" title="lemma">tac_wp_pure_credit</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Htmp</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;PureExec&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span>    <span class="comment">(*&nbsp;The&nbsp;pure&nbsp;condition&nbsp;for&nbsp;PureExec&nbsp;--<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handles&nbsp;trivial&nbsp;goals,&nbsp;including&nbsp;<span class="inlinecode"><span class="id" title="var">vals_compare_safe</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;IntoLaters&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">finish</span> ()                      <span class="comment">(*&nbsp;new&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" title="tactic">fail</span> "wp_pure: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> "or" <span class="id" title="var">efoc</span> "is not a redex"<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fail</span> "wp_pure: credit generation is not supported for a TWP"<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_pure: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_pure" "credit:" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pure</span> <span class="id" title="var">_</span> <span class="id" title="var">credit</span>: <span class="id" title="var">H</span>.<br/>

<br/>
<span class="comment">(*&nbsp;TODO:&nbsp;do&nbsp;this&nbsp;in&nbsp;one&nbsp;go,&nbsp;without&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wp_pures</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="comment">(*&nbsp;The&nbsp;`;<span class="inlinecode"></span>`&nbsp;makes&nbsp;sure&nbsp;that&nbsp;no&nbsp;side-condition&nbsp;magically&nbsp;spawns.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">progress</span> <span class="id" title="tactic">repeat</span> (<span class="id" title="var">wp_pure</span> <span class="id" title="var">_</span>; [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">wp_finish</span> <span class="comment">(*&nbsp;In&nbsp;case&nbsp;wp_pure&nbsp;never&nbsp;ran,&nbsp;make&nbsp;sure&nbsp;we&nbsp;do&nbsp;the&nbsp;usual&nbsp;cleanup.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
Unlike <span class="inlinecode"><span class="id" title="var">wp_pures</span></span>, the tactics <span class="inlinecode"><span class="id" title="var">wp_rec</span></span> and <span class="inlinecode"><span class="id" title="var">wp_lam</span></span> should also reduce
lambdas/recs that are hidden behind a definition, i.e. they should use
<span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.class_instances.html#AsRecV_recv"><span class="id" title="definition">AsRecV_recv</span></a></span> as a proper instance instead of a <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Extern</span></span>.

<div class="paragraph"> </div>

We achieve this by putting <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.class_instances.html#AsRecV_recv"><span class="id" title="definition">AsRecV_recv</span></a></span> in the current environment so that it
can be used as an instance by the typeclass resolution system. We then perform
the reduction, and finally we clear this new hypothesis. 
</div>
<div class="code">
<span class="id" title="keyword">Tactic Notation</span> "wp_rec" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span> := <span class="id" title="definition">AsRecV_recv</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.App"><span class="id" title="constructor">App</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_if" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.If"><span class="id" title="constructor">If</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_if_true" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.If"><span class="id" title="constructor">If</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_if_false" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.If"><span class="id" title="constructor">If</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_unop" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.UnOp"><span class="id" title="constructor">UnOp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_binop" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.BinOp"><span class="id" title="constructor">BinOp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_op" := <span class="id" title="var">wp_unop</span> || <span class="id" title="var">wp_binop</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_lam" := <span class="id" title="var">wp_rec</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_let" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Rec"><span class="id" title="constructor">Rec</span></a> <span class="id" title="constructor">BAnon</span> (<span class="id" title="constructor">BNamed</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>); <span class="id" title="var">wp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_seq" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Rec"><span class="id" title="constructor">Rec</span></a> <span class="id" title="constructor">BAnon</span> <span class="id" title="constructor">BAnon</span> <span class="id" title="var">_</span>); <span class="id" title="var">wp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_proj" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Fst"><span class="id" title="constructor">Fst</span></a> <span class="id" title="var">_</span>) || <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Snd"><span class="id" title="constructor">Snd</span></a> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_case" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Case"><span class="id" title="constructor">Case</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_match" := <span class="id" title="var">wp_case</span>; <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Rec"><span class="id" title="constructor">Rec</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="var">wp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_inj" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.InjL"><span class="id" title="constructor">InjL</span></a> <span class="id" title="var">_</span>) || <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.InjR"><span class="id" title="constructor">InjR</span></a> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_pair" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Pair"><span class="id" title="constructor">Pair</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_closure" := <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Rec"><span class="id" title="constructor">Rec</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_bind" class="idref" href="#tac_wp_bind"><span class="id" title="lemma">tac_wp_bind</span></a> `{<a id="wbheapGS0:83" class="idref" href="#wbheapGS0:83"><span class="id" title="binder">!</span></a><a id="wbheapGS0:83" class="idref" href="#wbheapGS0:83"><span class="id" title="binder">wbheapGS</span></a> <a id="cfef01e03494c5eba8f86f1492cd95f1" class="idref" href="#cfef01e03494c5eba8f86f1492cd95f1"><span class="id" title="binder"><span id="wbheapGS0:83" class="id">Σ</span></span></a>} <a id="K:84" class="idref" href="#K:84"><span class="id" title="binder">K</span></a> <a id="b6431cf79a451a286cac6c3d2b1e9de2" class="idref" href="#b6431cf79a451a286cac6c3d2b1e9de2"><span class="id" title="binder">Δ</span></a> <a id="s:86" class="idref" href="#s:86"><span class="id" title="binder">s</span></a> <a id="E:87" class="idref" href="#E:87"><span class="id" title="binder">E</span></a> <a id="e05567719bace2504f16ae8fb46148a7" class="idref" href="#e05567719bace2504f16ae8fb46148a7"><span class="id" title="binder">Φ</span></a> <a id="e:89" class="idref" href="#e:89"><span class="id" title="binder">e</span></a> <a id="f:90" class="idref" href="#f:90"><span class="id" title="binder">f</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f:90"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <a id="e:91" class="idref" href="#e:91"><span class="id" title="binder">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:84"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:91"><span class="id" title="variable">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="comment">(*&nbsp;as&nbsp;an&nbsp;eta&nbsp;expanded&nbsp;hypothesis&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;`simpl`&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b6431cf79a451a286cac6c3d2b1e9de2"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:89"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:86"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:87"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a id="v:92" class="idref" href="#v:92"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f:90"><span class="id" title="variable">f</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:92"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:86"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:87"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e05567719bace2504f16ae8fb46148a7"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span> <span class="id" title="notation">}}</span>)%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b6431cf79a451a286cac6c3d2b1e9de2"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:84"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:89"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:86"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:87"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e05567719bace2504f16ae8fb46148a7"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span>: <span class="id" title="lemma">wp_bind</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_bind" class="idref" href="#tac_twp_bind"><span class="id" title="lemma">tac_twp_bind</span></a> `{<a id="wbheapGS0:94" class="idref" href="#wbheapGS0:94"><span class="id" title="binder">!</span></a><a id="wbheapGS0:94" class="idref" href="#wbheapGS0:94"><span class="id" title="binder">wbheapGS</span></a> <a id="fc189c80b71ecc5231145e0c7fc7178c" class="idref" href="#fc189c80b71ecc5231145e0c7fc7178c"><span class="id" title="binder"><span id="wbheapGS0:94" class="id">Σ</span></span></a>} <a id="K:95" class="idref" href="#K:95"><span class="id" title="binder">K</span></a> <a id="05a9b8647fc60d99fca30e0c6eb7ace2" class="idref" href="#05a9b8647fc60d99fca30e0c6eb7ace2"><span class="id" title="binder">Δ</span></a> <a id="s:97" class="idref" href="#s:97"><span class="id" title="binder">s</span></a> <a id="E:98" class="idref" href="#E:98"><span class="id" title="binder">E</span></a> <a id="5b35d6cd62730be398cbee937a8b0e45" class="idref" href="#5b35d6cd62730be398cbee937a8b0e45"><span class="id" title="binder">Φ</span></a> <a id="e:100" class="idref" href="#e:100"><span class="id" title="binder">e</span></a> <a id="f:101" class="idref" href="#f:101"><span class="id" title="binder">f</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f:101"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <a id="e:102" class="idref" href="#e:102"><span class="id" title="binder">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:95"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:102"><span class="id" title="variable">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="comment">(*&nbsp;as&nbsp;an&nbsp;eta&nbsp;expanded&nbsp;hypothesis&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;`simpl`&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#05a9b8647fc60d99fca30e0c6eb7ace2"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:100"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:97"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:98"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a id="v:103" class="idref" href="#v:103"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">WP</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f:101"><span class="id" title="variable">f</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:103"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:97"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:98"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5b35d6cd62730be398cbee937a8b0e45"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span> <span class="id" title="notation">}]</span>)%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#05a9b8647fc60d99fca30e0c6eb7ace2"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:95"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:100"><span class="id" title="variable">e</span></a> <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:97"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:98"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5b35d6cd62730be398cbee937a8b0e45"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span>: <span class="id" title="lemma">twp_bind</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wp_bind_core</span> <span class="id" title="var">K</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="tactic">eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">K</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_bind"><span class="id" title="lemma">tac_wp_bind</span></a> <span class="id" title="var">K</span>); [<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>|<span class="id" title="var">reduction.pm_prettify</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">twp_bind_core</span> <span class="id" title="var">K</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="tactic">eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">K</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_bind"><span class="id" title="lemma">tac_twp_bind</span></a> <span class="id" title="var">K</span>); [<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>|<span class="id" title="var">reduction.pm_prettify</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_bind" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>; <span class="id" title="var">wp_bind_core</span> <span class="id" title="var">K</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">fail</span> 1 "wp_bind: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> ]<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>; <span class="id" title="var">twp_bind_core</span> <span class="id" title="var">K</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">fail</span> 1 "wp_bind: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> ]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_bind: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Heap tactics 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a id="heap" class="idref" href="#heap"><span class="id" title="section">heap</span></a>.<br/>
<span class="id" title="keyword">Context</span> `{<a id="wbheapGS0:105" class="idref" href="#wbheapGS0:105"><span class="id" title="binder">!</span></a><a id="wbheapGS0:105" class="idref" href="#wbheapGS0:105"><span class="id" title="binder">wbheapGS</span></a> <a id="186118668d07fd138a3ef5a9238c626f" class="idref" href="#186118668d07fd138a3ef5a9238c626f"><span class="id" title="binder"><span id="wbheapGS0:105" class="id">Σ</span></span></a>}.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Φ</span> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Δ</span> : <span class="id" title="record">envs</span> (<span class="id" title="definition">uPredI</span> (<span class="id" title="definition">iResUR</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>)).<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">z</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_alloc" class="idref" href="#tac_wp_alloc"><span class="id" title="lemma">tac_wp_alloc</span></a> <a id="f9f2baa53d8e6c4d685657d7461c6ad1" class="idref" href="#f9f2baa53d8e6c4d685657d7461c6ad1"><span class="id" title="binder">Δ</span></a> <a id="588faf21c7c494dfe708c2e52ca4de47" class="idref" href="#588faf21c7c494dfe708c2e52ca4de47"><span class="id" title="binder">Δ'</span></a> <a id="s:108" class="idref" href="#s:108"><span class="id" title="binder">s</span></a> <a id="E:109" class="idref" href="#E:109"><span class="id" title="binder">E</span></a> <a id="j:110" class="idref" href="#j:110"><span class="id" title="binder">j</span></a> <a id="K:111" class="idref" href="#K:111"><span class="id" title="binder">K</span></a> <a id="v:112" class="idref" href="#v:112"><span class="id" title="binder">v</span></a> <a id="641d75ecb82538e9ddfb3a14dfa9e3f9" class="idref" href="#641d75ecb82538e9ddfb3a14dfa9e3f9"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f9f2baa53d8e6c4d685657d7461c6ad1"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#588faf21c7c494dfe708c2e52ca4de47"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a id="l:114" class="idref" href="#l:114"><span class="id" title="binder">l</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_app</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#j:110"><span class="id" title="variable">j</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:114"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:112"><span class="id" title="variable">v</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#588faf21c7c494dfe708c2e52ca4de47"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:111"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:114"><span class="id" title="variable">l</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:108"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:109"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#641d75ecb82538e9ddfb3a14dfa9e3f9"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f9f2baa53d8e6c4d685657d7461c6ad1"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:111"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#Alloc"><span class="id" title="abbreviation">Alloc</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:112"><span class="id" title="variable">v</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:108"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:109"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#641d75ecb82538e9ddfb3a14dfa9e3f9"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ? <span class="id" title="var">HΔ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_alloc"><span class="id" title="lemma">wp_alloc</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">left_id</span> <span class="id" title="lemma">into_laterN_env_sound</span>; <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">forall_intro</span>=&gt; <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">HΔ</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_app</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_app_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_l</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="lemma">sep_elim_l</span> (<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <span class="id" title="var">v</span>)%<span class="id" title="var">I</span>) <span class="id" title="definition">right_id</span> <span class="id" title="lemma">wand_elim_r</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_alloc" class="idref" href="#tac_twp_alloc"><span class="id" title="lemma">tac_twp_alloc</span></a> <a id="b0a488e621cdda3663061c157ec625fe" class="idref" href="#b0a488e621cdda3663061c157ec625fe"><span class="id" title="binder">Δ</span></a> <a id="s:116" class="idref" href="#s:116"><span class="id" title="binder">s</span></a> <a id="E:117" class="idref" href="#E:117"><span class="id" title="binder">E</span></a> <a id="j:118" class="idref" href="#j:118"><span class="id" title="binder">j</span></a> <a id="K:119" class="idref" href="#K:119"><span class="id" title="binder">K</span></a> <a id="v:120" class="idref" href="#v:120"><span class="id" title="binder">v</span></a> <a id="c476930de6a9b03f4cd43a8cdb7bad9b" class="idref" href="#c476930de6a9b03f4cd43a8cdb7bad9b"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a id="l:122" class="idref" href="#l:122"><span class="id" title="binder">l</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_app</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#j:118"><span class="id" title="variable">j</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:122"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:120"><span class="id" title="variable">v</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b0a488e621cdda3663061c157ec625fe"><span class="id" title="variable">Δ</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ'</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:119"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitLoc"><span class="id" title="constructor">LitLoc</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:122"><span class="id" title="variable">l</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:116"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:117"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c476930de6a9b03f4cd43a8cdb7bad9b"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b0a488e621cdda3663061c157ec625fe"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:119"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#Alloc"><span class="id" title="abbreviation">Alloc</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:120"><span class="id" title="variable">v</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:116"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:117"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c476930de6a9b03f4cd43a8cdb7bad9b"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; <span class="id" title="var">HΔ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_alloc"><span class="id" title="lemma">twp_alloc</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">left_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">forall_intro</span>=&gt; <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">HΔ</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_app</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_app_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_l</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="lemma">sep_elim_l</span> (<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <span class="id" title="var">v</span>)%<span class="id" title="var">I</span>) <span class="id" title="definition">right_id</span> <span class="id" title="lemma">wand_elim_r</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_free" class="idref" href="#tac_wp_free"><span class="id" title="lemma">tac_wp_free</span></a> <a id="bbabf351a4e1160eb2b905aeacd371f5" class="idref" href="#bbabf351a4e1160eb2b905aeacd371f5"><span class="id" title="binder">Δ</span></a> <a id="95896ac41388b5ef9258edb1c472e82e" class="idref" href="#95896ac41388b5ef9258edb1c472e82e"><span class="id" title="binder">Δ'</span></a> <a id="s:125" class="idref" href="#s:125"><span class="id" title="binder">s</span></a> <a id="E:126" class="idref" href="#E:126"><span class="id" title="binder">E</span></a> <a id="i:127" class="idref" href="#i:127"><span class="id" title="binder">i</span></a> <a id="K:128" class="idref" href="#K:128"><span class="id" title="binder">K</span></a> <a id="l:129" class="idref" href="#l:129"><span class="id" title="binder">l</span></a> <a id="v:130" class="idref" href="#v:130"><span class="id" title="binder">v</span></a> <a id="f254557ae0abbcc933c4b9c123cb7884" class="idref" href="#f254557ae0abbcc933c4b9c123cb7884"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#bbabf351a4e1160eb2b905aeacd371f5"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#95896ac41388b5ef9258edb1c472e82e"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:127"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#95896ac41388b5ef9258edb1c472e82e"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:129"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:130"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><span class="id" title="keyword">let</span> <a id="70fe548bd774b101d1e7ded598c3c3ac" class="idref" href="#70fe548bd774b101d1e7ded598c3c3ac"><span class="id" title="binder">Δ''</span></a> := <span class="id" title="definition">envs_delete</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:127"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#95896ac41388b5ef9258edb1c472e82e"><span class="id" title="variable">Δ'</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#70fe548bd774b101d1e7ded598c3c3ac"><span class="id" title="variable">Δ''</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:128"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:125"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:126"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f254557ae0abbcc933c4b9c123cb7884"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#bbabf351a4e1160eb2b905aeacd371f5"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:128"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Free"><span class="id" title="constructor">Free</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:129"><span class="id" title="variable">l</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:125"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:126"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f254557ae0abbcc933c4b9c123cb7884"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ? <span class="id" title="var">Hlk</span> <span class="id" title="var">Hfin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_free"><span class="id" title="lemma">wp_free</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="var">Hfin</span> <span class="id" title="lemma">wand_elim_r</span> (<span class="id" title="lemma">envs_lookup_sound'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hlk</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_intro_r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span> //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_free" class="idref" href="#tac_twp_free"><span class="id" title="lemma">tac_twp_free</span></a> <a id="467f112c09ac965d6f71ea92adae3274" class="idref" href="#467f112c09ac965d6f71ea92adae3274"><span class="id" title="binder">Δ</span></a> <a id="s:134" class="idref" href="#s:134"><span class="id" title="binder">s</span></a> <a id="E:135" class="idref" href="#E:135"><span class="id" title="binder">E</span></a> <a id="i:136" class="idref" href="#i:136"><span class="id" title="binder">i</span></a> <a id="K:137" class="idref" href="#K:137"><span class="id" title="binder">K</span></a> <a id="l:138" class="idref" href="#l:138"><span class="id" title="binder">l</span></a> <a id="v:139" class="idref" href="#v:139"><span class="id" title="binder">v</span></a> <a id="12f7a123a4db8769b6aa0380e38373bf" class="idref" href="#12f7a123a4db8769b6aa0380e38373bf"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:136"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#467f112c09ac965d6f71ea92adae3274"><span class="id" title="variable">Δ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:138"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:139"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><span class="id" title="keyword">let</span> <a id="dbff8e573fba47ade509ff784f9dc209" class="idref" href="#dbff8e573fba47ade509ff784f9dc209"><span class="id" title="binder">Δ'</span></a> := <span class="id" title="definition">envs_delete</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:136"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#467f112c09ac965d6f71ea92adae3274"><span class="id" title="variable">Δ</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#dbff8e573fba47ade509ff784f9dc209"><span class="id" title="variable">Δ'</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:137"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:134"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:135"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#12f7a123a4db8769b6aa0380e38373bf"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#467f112c09ac965d6f71ea92adae3274"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:137"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Free"><span class="id" title="constructor">Free</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:138"><span class="id" title="variable">l</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:134"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:135"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#12f7a123a4db8769b6aa0380e38373bf"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; <span class="id" title="var">Hlk</span> <span class="id" title="var">Hfin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_free"><span class="id" title="lemma">twp_free</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="var">Hfin</span> <span class="id" title="lemma">wand_elim_r</span> (<span class="id" title="lemma">envs_lookup_sound'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hlk</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_intro_r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span> //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_load" class="idref" href="#tac_wp_load"><span class="id" title="lemma">tac_wp_load</span></a> <a id="1a3b200d154a801ce694cfe669154564" class="idref" href="#1a3b200d154a801ce694cfe669154564"><span class="id" title="binder">Δ</span></a> <a id="df119fcc0a69466595b3d5fd294cb90c" class="idref" href="#df119fcc0a69466595b3d5fd294cb90c"><span class="id" title="binder">Δ'</span></a> <a id="s:144" class="idref" href="#s:144"><span class="id" title="binder">s</span></a> <a id="E:145" class="idref" href="#E:145"><span class="id" title="binder">E</span></a> <a id="i:146" class="idref" href="#i:146"><span class="id" title="binder">i</span></a> <a id="K:147" class="idref" href="#K:147"><span class="id" title="binder">K</span></a> <a id="b:148" class="idref" href="#b:148"><span class="id" title="binder">b</span></a> <a id="l:149" class="idref" href="#l:149"><span class="id" title="binder">l</span></a> <a id="q:150" class="idref" href="#q:150"><span class="id" title="binder">q</span></a> <a id="v:151" class="idref" href="#v:151"><span class="id" title="binder">v</span></a> <a id="6f87ab2dc27c1f31d7cac04d2733384e" class="idref" href="#6f87ab2dc27c1f31d7cac04d2733384e"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1a3b200d154a801ce694cfe669154564"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#df119fcc0a69466595b3d5fd294cb90c"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:146"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#df119fcc0a69466595b3d5fd294cb90c"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b:148"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:149"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#q:150"><span class="id" title="variable">q</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:151"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#df119fcc0a69466595b3d5fd294cb90c"><span class="id" title="variable">Δ'</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:147"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:151"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:144"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:145"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#6f87ab2dc27c1f31d7cac04d2733384e"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1a3b200d154a801ce694cfe669154564"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:147"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Load"><span class="id" title="constructor">Load</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:149"><span class="id" title="variable">l</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:144"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:145"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#6f87ab2dc27c1f31d7cac04d2733384e"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?? <span class="id" title="var">Hi</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_load"><span class="id" title="lemma">wp_load</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="var">iIntros</span> "[#$ He]". <span class="id" title="var">iIntros</span> "_". <span class="id" title="var">iApply</span> <span class="id" title="var">Hi</span>. <span class="id" title="var">iApply</span> "He". <span class="id" title="var">iFrame</span> "#".<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_load" class="idref" href="#tac_twp_load"><span class="id" title="lemma">tac_twp_load</span></a> <a id="fc9a607e34d534ce7e16f29dadb460eb" class="idref" href="#fc9a607e34d534ce7e16f29dadb460eb"><span class="id" title="binder">Δ</span></a> <a id="s:154" class="idref" href="#s:154"><span class="id" title="binder">s</span></a> <a id="E:155" class="idref" href="#E:155"><span class="id" title="binder">E</span></a> <a id="i:156" class="idref" href="#i:156"><span class="id" title="binder">i</span></a> <a id="K:157" class="idref" href="#K:157"><span class="id" title="binder">K</span></a> <a id="b:158" class="idref" href="#b:158"><span class="id" title="binder">b</span></a> <a id="l:159" class="idref" href="#l:159"><span class="id" title="binder">l</span></a> <a id="q:160" class="idref" href="#q:160"><span class="id" title="binder">q</span></a> <a id="v:161" class="idref" href="#v:161"><span class="id" title="binder">v</span></a> <a id="b0f8dcf2915e3790ed08386138f29e00" class="idref" href="#b0f8dcf2915e3790ed08386138f29e00"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:156"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fc9a607e34d534ce7e16f29dadb460eb"><span class="id" title="variable">Δ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b:158"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:159"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#q:160"><span class="id" title="variable">q</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:161"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fc9a607e34d534ce7e16f29dadb460eb"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:157"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:161"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:154"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:155"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b0f8dcf2915e3790ed08386138f29e00"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fc9a607e34d534ce7e16f29dadb460eb"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:157"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Load"><span class="id" title="constructor">Load</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:159"><span class="id" title="variable">l</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:154"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:155"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b0f8dcf2915e3790ed08386138f29e00"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ? <span class="id" title="var">Hi</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_load"><span class="id" title="lemma">twp_load</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> "[#$ He]". <span class="id" title="var">iIntros</span> "_". <span class="id" title="var">iApply</span> <span class="id" title="var">Hi</span>. <span class="id" title="var">iApply</span> "He". <span class="id" title="var">iFrame</span> "#".<br/>
&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> "[$ He]". <span class="id" title="var">iIntros</span> "Hl". <span class="id" title="var">iApply</span> <span class="id" title="var">Hi</span>. <span class="id" title="var">iApply</span> "He". <span class="id" title="var">iFrame</span> "Hl".<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_store" class="idref" href="#tac_wp_store"><span class="id" title="lemma">tac_wp_store</span></a> <a id="df741f1932b64d046f79345362bbbe0f" class="idref" href="#df741f1932b64d046f79345362bbbe0f"><span class="id" title="binder">Δ</span></a> <a id="431ec4389f1b5575ccff3f6152545243" class="idref" href="#431ec4389f1b5575ccff3f6152545243"><span class="id" title="binder">Δ'</span></a> <a id="s:165" class="idref" href="#s:165"><span class="id" title="binder">s</span></a> <a id="E:166" class="idref" href="#E:166"><span class="id" title="binder">E</span></a> <a id="i:167" class="idref" href="#i:167"><span class="id" title="binder">i</span></a> <a id="K:168" class="idref" href="#K:168"><span class="id" title="binder">K</span></a> <a id="l:169" class="idref" href="#l:169"><span class="id" title="binder">l</span></a> <a id="v:170" class="idref" href="#v:170"><span class="id" title="binder">v</span></a> <a id="v':171" class="idref" href="#v':171"><span class="id" title="binder">v'</span></a> <a id="a82532dffacf71463e22e4f53d72cc85" class="idref" href="#a82532dffacf71463e22e4f53d72cc85"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#df741f1932b64d046f79345362bbbe0f"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#431ec4389f1b5575ccff3f6152545243"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:167"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#431ec4389f1b5575ccff3f6152545243"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:169"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:170"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:167"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:167"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:169"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':171"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#431ec4389f1b5575ccff3f6152545243"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:168"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:165"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:166"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#a82532dffacf71463e22e4f53d72cc85"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#df741f1932b64d046f79345362bbbe0f"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:168"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Store"><span class="id" title="constructor">Store</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:169"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':171"><span class="id" title="variable">v'</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:165"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:166"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#a82532dffacf71463e22e4f53d72cc85"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_store"><span class="id" title="lemma">wp_store</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_store" class="idref" href="#tac_twp_store"><span class="id" title="lemma">tac_twp_store</span></a> <a id="14b1161db93a4ee94501842a81ca97a8" class="idref" href="#14b1161db93a4ee94501842a81ca97a8"><span class="id" title="binder">Δ</span></a> <a id="s:174" class="idref" href="#s:174"><span class="id" title="binder">s</span></a> <a id="E:175" class="idref" href="#E:175"><span class="id" title="binder">E</span></a> <a id="i:176" class="idref" href="#i:176"><span class="id" title="binder">i</span></a> <a id="K:177" class="idref" href="#K:177"><span class="id" title="binder">K</span></a> <a id="l:178" class="idref" href="#l:178"><span class="id" title="binder">l</span></a> <a id="v:179" class="idref" href="#v:179"><span class="id" title="binder">v</span></a> <a id="v':180" class="idref" href="#v':180"><span class="id" title="binder">v'</span></a> <a id="17976cf8e0c3266a562c05506628db6a" class="idref" href="#17976cf8e0c3266a562c05506628db6a"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:176"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#14b1161db93a4ee94501842a81ca97a8"><span class="id" title="variable">Δ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:178"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:179"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:176"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:176"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:178"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':180"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#14b1161db93a4ee94501842a81ca97a8"><span class="id" title="variable">Δ</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ'</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ'</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:177"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:174"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:175"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#17976cf8e0c3266a562c05506628db6a"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#14b1161db93a4ee94501842a81ca97a8"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:177"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Store"><span class="id" title="constructor">Store</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:178"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':180"><span class="id" title="variable">v'</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:174"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:175"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#17976cf8e0c3266a562c05506628db6a"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_store"><span class="id" title="lemma">twp_store</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_xchg" class="idref" href="#tac_wp_xchg"><span class="id" title="lemma">tac_wp_xchg</span></a> <a id="e7e3bd9ae25c58ea3389e3988bf4faa7" class="idref" href="#e7e3bd9ae25c58ea3389e3988bf4faa7"><span class="id" title="binder">Δ</span></a> <a id="5e2a5a2c444083dac3b7cb7b72981eeb" class="idref" href="#5e2a5a2c444083dac3b7cb7b72981eeb"><span class="id" title="binder">Δ'</span></a> <a id="s:184" class="idref" href="#s:184"><span class="id" title="binder">s</span></a> <a id="E:185" class="idref" href="#E:185"><span class="id" title="binder">E</span></a> <a id="i:186" class="idref" href="#i:186"><span class="id" title="binder">i</span></a> <a id="K:187" class="idref" href="#K:187"><span class="id" title="binder">K</span></a> <a id="l:188" class="idref" href="#l:188"><span class="id" title="binder">l</span></a> <a id="v:189" class="idref" href="#v:189"><span class="id" title="binder">v</span></a> <a id="v':190" class="idref" href="#v':190"><span class="id" title="binder">v'</span></a> <a id="a3455d5ac310553f5c35d59064e0c3f9" class="idref" href="#a3455d5ac310553f5c35d59064e0c3f9"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e7e3bd9ae25c58ea3389e3988bf4faa7"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5e2a5a2c444083dac3b7cb7b72981eeb"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:186"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5e2a5a2c444083dac3b7cb7b72981eeb"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:188"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:189"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:186"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:186"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:188"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':190"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5e2a5a2c444083dac3b7cb7b72981eeb"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:187"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:189"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:184"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:185"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#a3455d5ac310553f5c35d59064e0c3f9"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e7e3bd9ae25c58ea3389e3988bf4faa7"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:187"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Xchg"><span class="id" title="constructor">Xchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:188"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':190"><span class="id" title="variable">v'</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:184"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:185"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#a3455d5ac310553f5c35d59064e0c3f9"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_xchg"><span class="id" title="lemma">wp_xchg</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_xchg" class="idref" href="#tac_twp_xchg"><span class="id" title="lemma">tac_twp_xchg</span></a> <a id="07c2048c9fea60edbbf1921003ad043d" class="idref" href="#07c2048c9fea60edbbf1921003ad043d"><span class="id" title="binder">Δ</span></a> <a id="s:193" class="idref" href="#s:193"><span class="id" title="binder">s</span></a> <a id="E:194" class="idref" href="#E:194"><span class="id" title="binder">E</span></a> <a id="i:195" class="idref" href="#i:195"><span class="id" title="binder">i</span></a> <a id="K:196" class="idref" href="#K:196"><span class="id" title="binder">K</span></a> <a id="l:197" class="idref" href="#l:197"><span class="id" title="binder">l</span></a> <a id="v:198" class="idref" href="#v:198"><span class="id" title="binder">v</span></a> <a id="v':199" class="idref" href="#v':199"><span class="id" title="binder">v'</span></a> <a id="ee39e3ce17a768741cbc8465d154173f" class="idref" href="#ee39e3ce17a768741cbc8465d154173f"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:195"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#07c2048c9fea60edbbf1921003ad043d"><span class="id" title="variable">Δ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:197"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:198"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:195"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:195"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:197"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':199"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#07c2048c9fea60edbbf1921003ad043d"><span class="id" title="variable">Δ</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ'</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ'</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:196"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:198"><span class="id" title="variable">v</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:193"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:194"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#ee39e3ce17a768741cbc8465d154173f"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#07c2048c9fea60edbbf1921003ad043d"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:196"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Xchg"><span class="id" title="constructor">Xchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:197"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':199"><span class="id" title="variable">v'</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:193"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:194"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#ee39e3ce17a768741cbc8465d154173f"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_xchg"><span class="id" title="lemma">twp_xchg</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_cmpxchg" class="idref" href="#tac_wp_cmpxchg"><span class="id" title="lemma">tac_wp_cmpxchg</span></a> <a id="e018644ce7175e34da461d199887b850" class="idref" href="#e018644ce7175e34da461d199887b850"><span class="id" title="binder">Δ</span></a> <a id="77ff5c26d83ec5cf9c602b55c09bd5f4" class="idref" href="#77ff5c26d83ec5cf9c602b55c09bd5f4"><span class="id" title="binder">Δ'</span></a> <a id="s:203" class="idref" href="#s:203"><span class="id" title="binder">s</span></a> <a id="E:204" class="idref" href="#E:204"><span class="id" title="binder">E</span></a> <a id="i:205" class="idref" href="#i:205"><span class="id" title="binder">i</span></a> <a id="K:206" class="idref" href="#K:206"><span class="id" title="binder">K</span></a> <a id="l:207" class="idref" href="#l:207"><span class="id" title="binder">l</span></a> <a id="v:208" class="idref" href="#v:208"><span class="id" title="binder">v</span></a> <a id="v1:209" class="idref" href="#v1:209"><span class="id" title="binder">v1</span></a> <a id="v2:210" class="idref" href="#v2:210"><span class="id" title="binder">v2</span></a> <a id="8a1a48e1a5cb26d32167f5f082e14bf2" class="idref" href="#8a1a48e1a5cb26d32167f5f082e14bf2"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e018644ce7175e34da461d199887b850"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#77ff5c26d83ec5cf9c602b55c09bd5f4"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:205"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#77ff5c26d83ec5cf9c602b55c09bd5f4"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:207"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:208"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:208"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:209"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:205"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:205"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:207"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:210"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#77ff5c26d83ec5cf9c602b55c09bd5f4"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:208"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:209"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:206"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:208"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:203"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:204"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8a1a48e1a5cb26d32167f5f082e14bf2"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:208"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:209"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#77ff5c26d83ec5cf9c602b55c09bd5f4"><span class="id" title="variable">Δ'</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:206"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:208"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:203"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:204"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8a1a48e1a5cb26d32167f5f082e14bf2"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e018644ce7175e34da461d199887b850"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:206"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:207"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:209"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:210"><span class="id" title="variable">v2</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:203"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:204"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8a1a48e1a5cb26d32167f5f082e14bf2"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">Hsuc</span> <span class="id" title="var">Hfail</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v1</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span>|<span class="id" title="var">Hne</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_cmpxchg_suc"><span class="id" title="lemma">wp_cmpxchg_suc</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> /= {1}<span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_cmpxchg_fail"><span class="id" title="lemma">wp_cmpxchg_fail</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> /= {1}<span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_cmpxchg" class="idref" href="#tac_twp_cmpxchg"><span class="id" title="lemma">tac_twp_cmpxchg</span></a> <a id="620d526049feb2958989af270d0b8a02" class="idref" href="#620d526049feb2958989af270d0b8a02"><span class="id" title="binder">Δ</span></a> <a id="s:213" class="idref" href="#s:213"><span class="id" title="binder">s</span></a> <a id="E:214" class="idref" href="#E:214"><span class="id" title="binder">E</span></a> <a id="i:215" class="idref" href="#i:215"><span class="id" title="binder">i</span></a> <a id="K:216" class="idref" href="#K:216"><span class="id" title="binder">K</span></a> <a id="l:217" class="idref" href="#l:217"><span class="id" title="binder">l</span></a> <a id="v:218" class="idref" href="#v:218"><span class="id" title="binder">v</span></a> <a id="v1:219" class="idref" href="#v1:219"><span class="id" title="binder">v1</span></a> <a id="v2:220" class="idref" href="#v2:220"><span class="id" title="binder">v2</span></a> <a id="67373ae35b674d64f946553a2c4fc49c" class="idref" href="#67373ae35b674d64f946553a2c4fc49c"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:215"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#620d526049feb2958989af270d0b8a02"><span class="id" title="variable">Δ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:217"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:218"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:218"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:219"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:215"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:215"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:217"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:220"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#620d526049feb2958989af270d0b8a02"><span class="id" title="variable">Δ</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:218"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:219"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ'</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:216"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:218"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:213"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:214"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#67373ae35b674d64f946553a2c4fc49c"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:218"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:219"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#620d526049feb2958989af270d0b8a02"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:216"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:218"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:213"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:214"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#67373ae35b674d64f946553a2c4fc49c"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#620d526049feb2958989af270d0b8a02"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:216"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:217"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:219"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:220"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:213"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:214"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#67373ae35b674d64f946553a2c4fc49c"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?? <span class="id" title="var">Hsuc</span> <span class="id" title="var">Hfail</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v1</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span>|<span class="id" title="var">Hne</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_cmpxchg_suc"><span class="id" title="lemma">twp_cmpxchg_suc</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /= {1}<span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_cmpxchg_fail"><span class="id" title="lemma">twp_cmpxchg_fail</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /= {1}<span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_cmpxchg_fail" class="idref" href="#tac_wp_cmpxchg_fail"><span class="id" title="lemma">tac_wp_cmpxchg_fail</span></a> <a id="4f87c8777246f6a47a1c59597baf8752" class="idref" href="#4f87c8777246f6a47a1c59597baf8752"><span class="id" title="binder">Δ</span></a> <a id="d2c707a203d6c33103b6f5958dfe55ff" class="idref" href="#d2c707a203d6c33103b6f5958dfe55ff"><span class="id" title="binder">Δ'</span></a> <a id="s:224" class="idref" href="#s:224"><span class="id" title="binder">s</span></a> <a id="E:225" class="idref" href="#E:225"><span class="id" title="binder">E</span></a> <a id="i:226" class="idref" href="#i:226"><span class="id" title="binder">i</span></a> <a id="K:227" class="idref" href="#K:227"><span class="id" title="binder">K</span></a> <a id="l:228" class="idref" href="#l:228"><span class="id" title="binder">l</span></a> <a id="q:229" class="idref" href="#q:229"><span class="id" title="binder">q</span></a> <a id="v:230" class="idref" href="#v:230"><span class="id" title="binder">v</span></a> <a id="v1:231" class="idref" href="#v1:231"><span class="id" title="binder">v1</span></a> <a id="v2:232" class="idref" href="#v2:232"><span class="id" title="binder">v2</span></a> <a id="e462da1ac4db14db6938463f00a4f360" class="idref" href="#e462da1ac4db14db6938463f00a4f360"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#4f87c8777246f6a47a1c59597baf8752"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#d2c707a203d6c33103b6f5958dfe55ff"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:226"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#d2c707a203d6c33103b6f5958dfe55ff"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:228"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#q:229"><span class="id" title="variable">q</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:230"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:230"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:231"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:230"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:231"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#d2c707a203d6c33103b6f5958dfe55ff"><span class="id" title="variable">Δ'</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:227"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:230"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:224"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:225"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e462da1ac4db14db6938463f00a4f360"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#4f87c8777246f6a47a1c59597baf8752"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:227"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:228"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:231"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:232"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:224"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:225"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e462da1ac4db14db6938463f00a4f360"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?????.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_cmpxchg_fail"><span class="id" title="lemma">wp_cmpxchg_fail</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_cmpxchg_fail" class="idref" href="#tac_twp_cmpxchg_fail"><span class="id" title="lemma">tac_twp_cmpxchg_fail</span></a> <a id="37d28d041aacbb0fcf719229354b46be" class="idref" href="#37d28d041aacbb0fcf719229354b46be"><span class="id" title="binder">Δ</span></a> <a id="s:235" class="idref" href="#s:235"><span class="id" title="binder">s</span></a> <a id="E:236" class="idref" href="#E:236"><span class="id" title="binder">E</span></a> <a id="i:237" class="idref" href="#i:237"><span class="id" title="binder">i</span></a> <a id="K:238" class="idref" href="#K:238"><span class="id" title="binder">K</span></a> <a id="l:239" class="idref" href="#l:239"><span class="id" title="binder">l</span></a> <a id="q:240" class="idref" href="#q:240"><span class="id" title="binder">q</span></a> <a id="v:241" class="idref" href="#v:241"><span class="id" title="binder">v</span></a> <a id="v1:242" class="idref" href="#v1:242"><span class="id" title="binder">v1</span></a> <a id="v2:243" class="idref" href="#v2:243"><span class="id" title="binder">v2</span></a> <a id="e9a2ca8da1e604e67080706459fa36fe" class="idref" href="#e9a2ca8da1e604e67080706459fa36fe"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:237"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#37d28d041aacbb0fcf719229354b46be"><span class="id" title="variable">Δ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:239"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#q:240"><span class="id" title="variable">q</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:241"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:241"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:242"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:241"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:242"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#37d28d041aacbb0fcf719229354b46be"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:238"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:241"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:235"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:236"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e9a2ca8da1e604e67080706459fa36fe"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#37d28d041aacbb0fcf719229354b46be"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:238"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:239"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:242"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:243"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:235"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:236"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e9a2ca8da1e604e67080706459fa36fe"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_cmpxchg_fail"><span class="id" title="lemma">twp_cmpxchg_fail</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode">//</span>&nbsp;solves&nbsp;some&nbsp;evars&nbsp;and&nbsp;enables&nbsp;further&nbsp;simplification.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_lookup_split</span> /= // /=. <span class="id" title="tactic">by</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="var">f_equiv</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_cmpxchg_suc" class="idref" href="#tac_wp_cmpxchg_suc"><span class="id" title="lemma">tac_wp_cmpxchg_suc</span></a> <a id="aa46a2174ae5da896c1dcf613ef155f2" class="idref" href="#aa46a2174ae5da896c1dcf613ef155f2"><span class="id" title="binder">Δ</span></a> <a id="af7415b6ec52922bbcb00f89e0ca0eec" class="idref" href="#af7415b6ec52922bbcb00f89e0ca0eec"><span class="id" title="binder">Δ'</span></a> <a id="s:247" class="idref" href="#s:247"><span class="id" title="binder">s</span></a> <a id="E:248" class="idref" href="#E:248"><span class="id" title="binder">E</span></a> <a id="i:249" class="idref" href="#i:249"><span class="id" title="binder">i</span></a> <a id="K:250" class="idref" href="#K:250"><span class="id" title="binder">K</span></a> <a id="l:251" class="idref" href="#l:251"><span class="id" title="binder">l</span></a> <a id="v:252" class="idref" href="#v:252"><span class="id" title="binder">v</span></a> <a id="v1:253" class="idref" href="#v1:253"><span class="id" title="binder">v1</span></a> <a id="v2:254" class="idref" href="#v2:254"><span class="id" title="binder">v2</span></a> <a id="c6302d50792f711a20e279a9515ff2b3" class="idref" href="#c6302d50792f711a20e279a9515ff2b3"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#aa46a2174ae5da896c1dcf613ef155f2"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#af7415b6ec52922bbcb00f89e0ca0eec"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:249"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#af7415b6ec52922bbcb00f89e0ca0eec"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:251"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:252"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:252"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:253"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:252"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:253"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:249"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:249"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:251"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:254"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#af7415b6ec52922bbcb00f89e0ca0eec"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:250"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:252"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:247"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:248"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c6302d50792f711a20e279a9515ff2b3"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#aa46a2174ae5da896c1dcf613ef155f2"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:250"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:251"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:253"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:254"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:247"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:248"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c6302d50792f711a20e279a9515ff2b3"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?????; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_cmpxchg_suc"><span class="id" title="lemma">wp_cmpxchg_suc</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_cmpxchg_suc" class="idref" href="#tac_twp_cmpxchg_suc"><span class="id" title="lemma">tac_twp_cmpxchg_suc</span></a> <a id="738ade578e4fe9f012e3986b7b648893" class="idref" href="#738ade578e4fe9f012e3986b7b648893"><span class="id" title="binder">Δ</span></a> <a id="s:257" class="idref" href="#s:257"><span class="id" title="binder">s</span></a> <a id="E:258" class="idref" href="#E:258"><span class="id" title="binder">E</span></a> <a id="i:259" class="idref" href="#i:259"><span class="id" title="binder">i</span></a> <a id="K:260" class="idref" href="#K:260"><span class="id" title="binder">K</span></a> <a id="l:261" class="idref" href="#l:261"><span class="id" title="binder">l</span></a> <a id="v:262" class="idref" href="#v:262"><span class="id" title="binder">v</span></a> <a id="v1:263" class="idref" href="#v1:263"><span class="id" title="binder">v1</span></a> <a id="v2:264" class="idref" href="#v2:264"><span class="id" title="binder">v2</span></a> <a id="16e78ce040b1e8884c23fd8b38d03f14" class="idref" href="#16e78ce040b1e8884c23fd8b38d03f14"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:259"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#738ade578e4fe9f012e3986b7b648893"><span class="id" title="variable">Δ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:261"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:262"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:262"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:263"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:262"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:263"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:259"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:259"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:261"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:264"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#738ade578e4fe9f012e3986b7b648893"><span class="id" title="variable">Δ</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ'</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:260"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:262"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:257"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:258"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#16e78ce040b1e8884c23fd8b38d03f14"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#738ade578e4fe9f012e3986b7b648893"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:260"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:261"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:263"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:264"><span class="id" title="variable">v2</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:257"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:258"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#16e78ce040b1e8884c23fd8b38d03f14"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt;????; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_cmpxchg_suc"><span class="id" title="lemma">twp_cmpxchg_suc</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wp_faa" class="idref" href="#tac_wp_faa"><span class="id" title="lemma">tac_wp_faa</span></a> <a id="6778128da0ab697d19a3ac5f48a7da3f" class="idref" href="#6778128da0ab697d19a3ac5f48a7da3f"><span class="id" title="binder">Δ</span></a> <a id="c90f2d16d1862985ccf0d6940aedb609" class="idref" href="#c90f2d16d1862985ccf0d6940aedb609"><span class="id" title="binder">Δ'</span></a> <a id="s:268" class="idref" href="#s:268"><span class="id" title="binder">s</span></a> <a id="E:269" class="idref" href="#E:269"><span class="id" title="binder">E</span></a> <a id="i:270" class="idref" href="#i:270"><span class="id" title="binder">i</span></a> <a id="K:271" class="idref" href="#K:271"><span class="id" title="binder">K</span></a> <a id="l:272" class="idref" href="#l:272"><span class="id" title="binder">l</span></a> <a id="z1:273" class="idref" href="#z1:273"><span class="id" title="binder">z1</span></a> <a id="z2:274" class="idref" href="#z2:274"><span class="id" title="binder">z2</span></a> <a id="56a8198ca110ef1dc2f9d79de4ab7a86" class="idref" href="#56a8198ca110ef1dc2f9d79de4ab7a86"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#6778128da0ab697d19a3ac5f48a7da3f"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c90f2d16d1862985ccf0d6940aedb609"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:270"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c90f2d16d1862985ccf0d6940aedb609"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:272"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:273"><span class="id" title="variable">z1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:270"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:270"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:272"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:273"><span class="id" title="variable">z1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z2:274"><span class="id" title="variable">z2</span></a>)))) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c90f2d16d1862985ccf0d6940aedb609"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:271"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:273"><span class="id" title="variable">z1</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:268"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:269"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#56a8198ca110ef1dc2f9d79de4ab7a86"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#6778128da0ab697d19a3ac5f48a7da3f"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:271"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.FAA"><span class="id" title="constructor">FAA</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:272"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z2:274"><span class="id" title="variable">z2</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:268"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:269"><span class="id" title="variable">E</span></a> <span class="id" title="notation">{{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#56a8198ca110ef1dc2f9d79de4ab7a86"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}}</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">wp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wp_faa"><span class="id" title="lemma">wp_faa</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">z1</span> <span class="id" title="var">z2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_twp_faa" class="idref" href="#tac_twp_faa"><span class="id" title="lemma">tac_twp_faa</span></a> <a id="bc2d8a48e6c20abe3821b03ae25856c4" class="idref" href="#bc2d8a48e6c20abe3821b03ae25856c4"><span class="id" title="binder">Δ</span></a> <a id="s:277" class="idref" href="#s:277"><span class="id" title="binder">s</span></a> <a id="E:278" class="idref" href="#E:278"><span class="id" title="binder">E</span></a> <a id="i:279" class="idref" href="#i:279"><span class="id" title="binder">i</span></a> <a id="K:280" class="idref" href="#K:280"><span class="id" title="binder">K</span></a> <a id="l:281" class="idref" href="#l:281"><span class="id" title="binder">l</span></a> <a id="z1:282" class="idref" href="#z1:282"><span class="id" title="binder">z1</span></a> <a id="z2:283" class="idref" href="#z2:283"><span class="id" title="binder">z2</span></a> <a id="ca979347327ace26bf27b3032c821e7b" class="idref" href="#ca979347327ace26bf27b3032c821e7b"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:279"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#bc2d8a48e6c20abe3821b03ae25856c4"><span class="id" title="variable">Δ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:281"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:282"><span class="id" title="variable">z1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:279"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:279"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:281"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:282"><span class="id" title="variable">z1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z2:283"><span class="id" title="variable">z2</span></a>)))) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#bc2d8a48e6c20abe3821b03ae25856c4"><span class="id" title="variable">Δ</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ'</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ'</span> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:280"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:282"><span class="id" title="variable">z1</span></a>) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:277"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:278"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#ca979347327ace26bf27b3032c821e7b"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#bc2d8a48e6c20abe3821b03ae25856c4"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">WP</span> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:280"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.FAA"><span class="id" title="constructor">FAA</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:281"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z2:283"><span class="id" title="variable">z2</span></a>)) <span class="id" title="notation">@</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#s:277"><span class="id" title="variable">s</span></a><span class="id" title="notation">;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:278"><span class="id" title="variable">E</span></a> <span class="id" title="notation">[{</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#ca979347327ace26bf27b3032c821e7b"><span class="id" title="variable">Φ</span></a> <span class="id" title="notation">}]</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ'</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">twp_bind</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#twp_faa"><span class="id" title="lemma">twp_faa</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">z1</span> <span class="id" title="var">z2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#heap"><span class="id" title="section">heap</span></a>.<br/>

<br/>
</div>

<div class="doc">
The tactic <span class="inlinecode"><span class="id" title="var">wp_apply_core</span></span> <span class="inlinecode"><span class="id" title="var">lem</span></span> <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">tac_fail</span></span> evaluates <span class="inlinecode"><span class="id" title="var">lem</span></span> to a
hypothesis <span class="inlinecode"><span class="id" title="var">H</span></span> that can be applied, and then runs <span class="inlinecode"><span class="id" title="var">wp_bind_core</span></span> <span class="inlinecode"><span class="id" title="var">K</span>;</span> <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span>
for every possible evaluation context <span class="inlinecode"><span class="id" title="var">K</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> The tactic <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> should do <span class="inlinecode"><span class="id" title="var">iApplyHyp</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> to actually apply the hypothesis,
  but can perform other operations in addition (see <span class="inlinecode"><span class="id" title="var">wp_apply</span></span> and <span class="inlinecode"><span class="id" title="var">awp_apply</span></span>
  below).

</li>
<li> The tactic <span class="inlinecode"><span class="id" title="var">tac_fail</span></span> <span class="inlinecode"><span class="id" title="var">cont</span></span> is called when <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> fails for all evaluation
  contexts <span class="inlinecode"><span class="id" title="var">K</span></span>, and can perform further operations before invoking <span class="inlinecode"><span class="id" title="var">cont</span></span> to
  try again.

</li>
</ul>

<div class="paragraph"> </div>

TC resolution of <span class="inlinecode"><span class="id" title="var">lem</span></span> premises happens *after* <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> got executed. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="var">tac_suc</span> <span class="id" title="var">tac_fail</span> := <span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;[<span class="id" title="var">iPoseProofCore</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">as</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_bind_core</span> <span class="id" title="var">K</span>; <span class="id" title="var">tac_suc</span> <span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">twp_bind_core</span> <span class="id" title="var">K</span>; <span class="id" title="var">tac_suc</span> <span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> 1 "wp_apply: not a 'wp'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;|<span class="id" title="var">tac_fail</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">wp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="var">tac_suc</span> <span class="id" title="var">tac_fail</span>)<br/>
&nbsp;&nbsp;|<span class="id" title="keyword">let</span> <span class="id" title="var">P</span> := <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">lem</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fail</span> "wp_apply: cannot apply" <span class="id" title="var">lem</span> ":" <span class="id" title="var">P</span> ].<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_apply" <span class="id" title="var">open_constr</span>(<span class="id" title="var">lem</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">iApplyHyp</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">iNext</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">wp_expr_simpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">cont</span> =&gt; <span class="id" title="tactic">fail</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_smart_apply" <span class="id" title="var">open_constr</span>(<span class="id" title="var">lem</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">iApplyHyp</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">iNext</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">wp_expr_simpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">cont</span> =&gt; <span class="id" title="var">wp_pure</span> <span class="id" title="var">_</span>; []; <span class="id" title="var">cont</span> ()).<br/>

<br/>
</div>

<div class="doc">
Tactic tailored for atomic triples: the first, simple one just runs
<span class="inlinecode"><span class="id" title="var">iAuIntro</span></span> on the goal, as atomic triples always have an atomic update as their
premise. The second one additionaly does some framing: it gets rid of <span class="inlinecode"><span class="id" title="var">Hs</span></span> from
the context, reducing clutter. You get them all back in the continuation of the
atomic operation. 
</div>
<div class="code">
<span class="id" title="keyword">Tactic Notation</span> "awp_apply" <span class="id" title="var">open_constr</span>(<span class="id" title="var">lem</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">iApplyHyp</span> <span class="id" title="var">H</span>) <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">cont</span> =&gt; <span class="id" title="tactic">fail</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">last</span> <span class="id" title="var">iAuIntro</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "awp_apply" <span class="id" title="var">open_constr</span>(<span class="id" title="var">lem</span>) "without" <span class="id" title="keyword">constr</span>(<span class="id" title="var">Hs</span>) :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Convert&nbsp;"list&nbsp;of&nbsp;hypothesis"&nbsp;into&nbsp;specialization&nbsp;pattern.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Hs</span> := <span class="id" title="var">words</span> <span class="id" title="var">Hs</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Hs</span> := <span class="id" title="tactic">eval</span> <span class="id" title="keyword">vm_compute</span> <span class="id" title="tactic">in</span> (<span class="id" title="constructor">INamed</span> <span class="id" title="notation">&lt;$&gt;</span> <span class="id" title="var">Hs</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_apply_core</span> <span class="id" title="var">lem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.weakestpre.html#wp_frame_wand"><span class="id" title="lemma">wp_frame_wand</span></a> <span class="id" title="notation">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><span class="id" title="constructor">SGoal</span> <span class="id" title="notation">$</span> <span class="id" title="constructor">SpecGoal</span> <span class="id" title="constructor">GSpatial</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <span class="id" title="var">Hs</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><span class="id" title="notation">)</span>; [<span class="id" title="var">iAccu</span>|<span class="id" title="var">iApplyHyp</span> <span class="id" title="var">H</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">cont</span> =&gt; <span class="id" title="tactic">fail</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">last</span> <span class="id" title="var">iAuIntro</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_alloc" <span class="id" title="var">ident</span>(<span class="id" title="var">l</span>) "as" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Htmp</span> := <span class="id" title="var">iFresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">finish</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> | <span class="id" title="tactic">fail</span> 1 "wp_alloc:" <span class="id" title="var">l</span> "not fresh"];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pm_reduce</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="notation">False</span> =&gt; <span class="id" title="tactic">fail</span> 1 "wp_alloc:" <span class="id" title="var">H</span> "not fresh"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">iDestructHyp</span> <span class="id" title="var">Htmp</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>; <span class="id" title="var">wp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;</div>

<div class="doc">
The code first tries to use allocation lemma for a single reference,
     ie, <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_alloc"><span class="id" title="lemma">tac_wp_alloc</span></a></span> (respectively, <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_alloc"><span class="id" title="lemma">tac_twp_alloc</span></a></span>).
     If that fails, it tries to use the lemma <span class="inlinecode"><span class="id" title="var">tac_wp_allocN</span></span>
     (respectively, <span class="inlinecode"><span class="id" title="var">tac_twp_allocN</span></span>) for allocating an array.
     Notice that we could have used the array allocation lemma also for single
     references. However, that would produce the resource l ↦∗ <span class="inlinecode"><span class="id" title="var">v</span></span> instead of
     l ↦ v for single references. These are logically equivalent assertions
     but are not equal. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">process_single</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_alloc"><span class="id" title="lemma">tac_wp_alloc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Htmp</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_alloc: cannot find 'Alloc' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">finish</span> ()]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span> <span class="id" title="var">process_single</span> ()<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">process_single</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_alloc"><span class="id" title="lemma">tac_twp_alloc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Htmp</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_alloc: cannot find 'Alloc' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finish</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span> <span class="id" title="var">process_single</span> ()<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_alloc: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_alloc" <span class="id" title="var">ident</span>(<span class="id" title="var">l</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wp_alloc</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> "?".<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_free" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wp_free: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_free"><span class="id" title="lemma">tac_wp_free</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_free: cannot find 'Free' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_free"><span class="id" title="lemma">tac_twp_free</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_free: cannot find 'Free' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_free: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_load" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wp_load: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_load"><span class="id" title="lemma">tac_wp_load</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_load: cannot find 'Load' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_load"><span class="id" title="lemma">tac_twp_load</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_load: cannot find 'Load' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_load: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_store" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wp_store: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_store"><span class="id" title="lemma">tac_wp_store</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_store: cannot find 'Store' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">first</span> [<span class="id" title="var">wp_seq</span>|<span class="id" title="var">wp_finish</span>]]<br/>
  | |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_store"><span class="id" title="lemma">tac_twp_store</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_store: cannot find 'Store' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">first</span> [<span class="id" title="var">wp_seq</span>|<span class="id" title="var">wp_finish</span>]]<br/>
  | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_store: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_xchg" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wp_xchg: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_xchg"><span class="id" title="lemma">tac_wp_xchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_xchg: cannot find 'Xchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">first</span> [<span class="id" title="var">wp_seq</span>|<span class="id" title="var">wp_finish</span>]]<br/>
  | |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_xchg"><span class="id" title="lemma">tac_twp_xchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_xchg: cannot find 'Xchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">first</span> [<span class="id" title="var">wp_seq</span>|<span class="id" title="var">wp_finish</span>]]<br/>
  | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_xchg: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_cmpxchg" "as" <span class="id" title="var">simple_intropattern</span>(<span class="id" title="var">H1</span>) "|" <span class="id" title="var">simple_intropattern</span>(<span class="id" title="var">H2</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wp_cmpxchg: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_cmpxchg"><span class="id" title="lemma">tac_wp_cmpxchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_cmpxchg: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H1</span>; <span class="id" title="var">wp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">intros</span> <span class="id" title="var">H2</span>; <span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_cmpxchg"><span class="id" title="lemma">tac_twp_cmpxchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_cmpxchg: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H1</span>; <span class="id" title="var">wp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">intros</span> <span class="id" title="var">H2</span>; <span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_cmpxchg: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_cmpxchg_fail" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wp_cmpxchg_fail: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_cmpxchg_fail"><span class="id" title="lemma">tac_wp_cmpxchg_fail</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_cmpxchg_fail: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>) <span class="comment">(*&nbsp;value&nbsp;inequality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_cmpxchg_fail"><span class="id" title="lemma">tac_twp_cmpxchg_fail</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_cmpxchg_fail: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>) <span class="comment">(*&nbsp;value&nbsp;inequality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_cmpxchg_fail: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_cmpxchg_suc" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wp_cmpxchg_suc: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_cmpxchg_suc"><span class="id" title="lemma">tac_wp_cmpxchg_suc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_cmpxchg_suc: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>) <span class="comment">(*&nbsp;value&nbsp;equality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_cmpxchg_suc"><span class="id" title="lemma">tac_twp_cmpxchg_suc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_cmpxchg_suc: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>) <span class="comment">(*&nbsp;value&nbsp;equality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_cmpxchg_suc: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wp_faa" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wp_faa: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">wp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_faa"><span class="id" title="lemma">tac_wp_faa</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_faa: cannot find 'FAA' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<span class="id" title="definition">twp</span> ?<span class="id" title="var">s</span> ?<span class="id" title="var">E</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_faa"><span class="id" title="lemma">tac_twp_faa</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wp_faa: cannot find 'FAA' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_faa: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_expr_eval" class="idref" href="#tac_wbwp_expr_eval"><span class="id" title="lemma">tac_wbwp_expr_eval</span></a> `{<a id="wbheapGS0:286" class="idref" href="#wbheapGS0:286"><span class="id" title="binder">!</span></a><a id="wbheapGS0:286" class="idref" href="#wbheapGS0:286"><span class="id" title="binder">wbheapGS</span></a> <a id="ecfbdabaddf4e5284d914e21ad7ca23c" class="idref" href="#ecfbdabaddf4e5284d914e21ad7ca23c"><span class="id" title="binder"><span id="wbheapGS0:286" class="id">Σ</span></span></a>} <a id="d323803bb95bf23730e708be573af49a" class="idref" href="#d323803bb95bf23730e708be573af49a"><span class="id" title="binder">Δ</span></a> <a id="E:288" class="idref" href="#E:288"><span class="id" title="binder">E</span></a> <a id="out:289" class="idref" href="#out:289"><span class="id" title="binder">out</span></a> <a id="b2a5947a3a31fe3bdad6c97e7e71689d" class="idref" href="#b2a5947a3a31fe3bdad6c97e7e71689d"><span class="id" title="binder">Φ</span></a> <a id="e:291" class="idref" href="#e:291"><span class="id" title="binder">e</span></a> <a id="e':292" class="idref" href="#e':292"><span class="id" title="binder">e'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">(</span></a><a id="e'':293" class="idref" href="#e'':293"><span class="id" title="binder">e''</span></a>:=<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e':292"><span class="id" title="variable">e'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">),</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:291"><span class="id" title="variable">e</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e'':293"><span class="id" title="variable">e''</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#d323803bb95bf23730e708be573af49a"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e':292"><span class="id" title="variable">e'</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:289"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:288"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b2a5947a3a31fe3bdad6c97e7e71689d"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#d323803bb95bf23730e708be573af49a"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:291"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:289"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:288"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b2a5947a3a31fe3bdad6c97e7e71689d"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">intros</span> -&gt;. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_expr_eval" <span class="id" title="var">tactic3</span>(<span class="id" title="var">t</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">notypeclasses</span> <span class="id" title="tactic">refine</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_expr_eval"><span class="id" title="lemma">tac_wbwp_expr_eval</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">e</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="var">t</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">x</span>; <span class="id" title="var">notypeclasses</span> <span class="id" title="tactic">refine</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>|]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_expr_eval: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_expr_simpl</span> := <span class="id" title="var">wbwp_expr_eval</span> <span class="id" title="tactic">simpl</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_pure" class="idref" href="#tac_wbwp_pure"><span class="id" title="lemma">tac_wbwp_pure</span></a> `{<a id="wbheapGS0:295" class="idref" href="#wbheapGS0:295"><span class="id" title="binder">!</span></a><a id="wbheapGS0:295" class="idref" href="#wbheapGS0:295"><span class="id" title="binder">wbheapGS</span></a> <a id="d2959ac75b6e0d36cc79e21b63eb81d5" class="idref" href="#d2959ac75b6e0d36cc79e21b63eb81d5"><span class="id" title="binder"><span id="wbheapGS0:295" class="id">Σ</span></span></a>} <a id="311a7f05fd8040233a3d2906560cbed9" class="idref" href="#311a7f05fd8040233a3d2906560cbed9"><span class="id" title="binder">Δ</span></a> <a id="30809b3226fb5d10ff67dddd9bf8ea41" class="idref" href="#30809b3226fb5d10ff67dddd9bf8ea41"><span class="id" title="binder">Δ'</span></a> <a id="E:298" class="idref" href="#E:298"><span class="id" title="binder">E</span></a> <a id="out:299" class="idref" href="#out:299"><span class="id" title="binder">out</span></a> <a id="K:300" class="idref" href="#K:300"><span class="id" title="binder">K</span></a> <a id="e1:301" class="idref" href="#e1:301"><span class="id" title="binder">e1</span></a> <a id="e2:302" class="idref" href="#e2:302"><span class="id" title="binder">e2</span></a> <a id="4e9b3a3f53fd670ed9240e1da15f9e8f" class="idref" href="#4e9b3a3f53fd670ed9240e1da15f9e8f"><span class="id" title="binder">φ</span></a> <a id="n:304" class="idref" href="#n:304"><span class="id" title="binder">n</span></a> <a id="34263f1707e34ce8ead7050b58c8045b" class="idref" href="#34263f1707e34ce8ead7050b58c8045b"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">PureExec</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#4e9b3a3f53fd670ed9240e1da15f9e8f"><span class="id" title="variable">φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#n:304"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:301"><span class="id" title="variable">e1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:302"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#4e9b3a3f53fd670ed9240e1da15f9e8f"><span class="id" title="variable">φ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#n:304"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#311a7f05fd8040233a3d2906560cbed9"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#30809b3226fb5d10ff67dddd9bf8ea41"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#30809b3226fb5d10ff67dddd9bf8ea41"><span class="id" title="variable">Δ'</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:300"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:302"><span class="id" title="variable">e2</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:299"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:298"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#34263f1707e34ce8ead7050b58c8045b"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#311a7f05fd8040233a3d2906560cbed9"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:300"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:301"><span class="id" title="variable">e1</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:299"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:298"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#34263f1707e34ce8ead7050b58c8045b"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">HΔ'</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> /=.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;want&nbsp;<span class="inlinecode"><span class="id" title="var">pure_exec_fill</span></span>&nbsp;to&nbsp;be&nbsp;available&nbsp;to&nbsp;TC&nbsp;search&nbsp;locally.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<span class="id" title="lemma">pure_exec_fill</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">HΔ'</span> -<a class="idref" href="WBLogic.program_logic.lifting.html#wbwp_pure_step_later"><span class="id" title="lemma">lifting.wbwp_pure_step_later</span></a> //.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hwp !&gt; _" =&gt; //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_pure_credit" class="idref" href="#tac_wbwp_pure_credit"><span class="id" title="lemma">tac_wbwp_pure_credit</span></a> `{<a id="wbheapGS0:307" class="idref" href="#wbheapGS0:307"><span class="id" title="binder">!</span></a><a id="wbheapGS0:307" class="idref" href="#wbheapGS0:307"><span class="id" title="binder">wbheapGS</span></a> <a id="38ec0d810825fad5197eff2fcbab7290" class="idref" href="#38ec0d810825fad5197eff2fcbab7290"><span class="id" title="binder"><span id="wbheapGS0:307" class="id">Σ</span></span></a>} <a id="2911eeee6a2aa35a739156763185a676" class="idref" href="#2911eeee6a2aa35a739156763185a676"><span class="id" title="binder">Δ</span></a> <a id="2155023b89a51f575c6b1edad5a676f3" class="idref" href="#2155023b89a51f575c6b1edad5a676f3"><span class="id" title="binder">Δ'</span></a> <a id="E:310" class="idref" href="#E:310"><span class="id" title="binder">E</span></a> <a id="out:311" class="idref" href="#out:311"><span class="id" title="binder">out</span></a> <a id="j:312" class="idref" href="#j:312"><span class="id" title="binder">j</span></a> <a id="K:313" class="idref" href="#K:313"><span class="id" title="binder">K</span></a> <a id="e1:314" class="idref" href="#e1:314"><span class="id" title="binder">e1</span></a> <a id="e2:315" class="idref" href="#e2:315"><span class="id" title="binder">e2</span></a> <a id="39a888d9d43c9fd48f2915bd5b613d1e" class="idref" href="#39a888d9d43c9fd48f2915bd5b613d1e"><span class="id" title="binder">ϕ</span></a> <a id="43f9080346b385967775397f41625e60" class="idref" href="#43f9080346b385967775397f41625e60"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">PureExec</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#39a888d9d43c9fd48f2915bd5b613d1e"><span class="id" title="variable">ϕ</span></a> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:314"><span class="id" title="variable">e1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:315"><span class="id" title="variable">e2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#39a888d9d43c9fd48f2915bd5b613d1e"><span class="id" title="variable">ϕ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2911eeee6a2aa35a739156763185a676"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2155023b89a51f575c6b1edad5a676f3"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_app</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#j:312"><span class="id" title="variable">j</span></a> (<span class="id" title="notation">£</span> 1)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2155023b89a51f575c6b1edad5a676f3"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:313"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e2:315"><span class="id" title="variable">e2</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:311"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:310"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#43f9080346b385967775397f41625e60"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2911eeee6a2aa35a739156763185a676"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:313"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e1:314"><span class="id" title="variable">e1</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:311"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:310"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#43f9080346b385967775397f41625e60"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">HΔ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<span class="id" title="lemma">pure_exec_fill</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.lifting.html#wbwp_pure_step_later"><span class="id" title="lemma">lifting.wbwp_pure_step_later</span></a>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> /=. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_app</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_app_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_r</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">wand_elim_l</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_value_nofupd" class="idref" href="#tac_wbwp_value_nofupd"><span class="id" title="lemma">tac_wbwp_value_nofupd</span></a> `{<a id="wbheapGS0:319" class="idref" href="#wbheapGS0:319"><span class="id" title="binder">!</span></a><a id="wbheapGS0:319" class="idref" href="#wbheapGS0:319"><span class="id" title="binder">wbheapGS</span></a> <a id="dcf172020ed7587215e246e9a220e523" class="idref" href="#dcf172020ed7587215e246e9a220e523"><span class="id" title="binder"><span id="wbheapGS0:319" class="id">Σ</span></span></a>} <a id="fca0508c7bc0f9173388e8c786ae1d74" class="idref" href="#fca0508c7bc0f9173388e8c786ae1d74"><span class="id" title="binder">Δ</span></a> <a id="E:321" class="idref" href="#E:321"><span class="id" title="binder">E</span></a> <a id="out:322" class="idref" href="#out:322"><span class="id" title="binder">out</span></a> <a id="c75621eb863d3ee1dbb76dcda1d6ad4a" class="idref" href="#c75621eb863d3ee1dbb76dcda1d6ad4a"><span class="id" title="binder">Φ</span></a> <a id="v:324" class="idref" href="#v:324"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fca0508c7bc0f9173388e8c786ae1d74"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c75621eb863d3ee1dbb76dcda1d6ad4a"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:324"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fca0508c7bc0f9173388e8c786ae1d74"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:324"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:322"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:321"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c75621eb863d3ee1dbb76dcda1d6ad4a"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_value"><span class="id" title="lemma">wbwp_value</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_value" class="idref" href="#tac_wbwp_value"><span class="id" title="lemma">tac_wbwp_value</span></a> `{<a id="wbheapGS0:326" class="idref" href="#wbheapGS0:326"><span class="id" title="binder">!</span></a><a id="wbheapGS0:326" class="idref" href="#wbheapGS0:326"><span class="id" title="binder">wbheapGS</span></a> <a id="254f4fe056e9633ec7276ff785e9e7df" class="idref" href="#254f4fe056e9633ec7276ff785e9e7df"><span class="id" title="binder"><span id="wbheapGS0:326" class="id">Σ</span></span></a>} <a id="bff840ba6c5580a88126ca611ab18d3d" class="idref" href="#bff840ba6c5580a88126ca611ab18d3d"><span class="id" title="binder">Δ</span></a> <a id="E:328" class="idref" href="#E:328"><span class="id" title="binder">E</span></a> <a id="out:329" class="idref" href="#out:329"><span class="id" title="binder">out</span></a> (<a id="3450d8ce1b01000ee9564681170c56cb" class="idref" href="#3450d8ce1b01000ee9564681170c56cb"><span class="id" title="binder">Φ</span></a> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iPropI</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#254f4fe056e9633ec7276ff785e9e7df"><span class="id" title="variable">Σ</span></a>) <a id="v:331" class="idref" href="#v:331"><span class="id" title="binder">v</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#bff840ba6c5580a88126ca611ab18d3d"><span class="id" title="variable">Δ</span></a> (<span class="id" title="notation">|={</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:328"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=&gt;</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#3450d8ce1b01000ee9564681170c56cb"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:331"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#bff840ba6c5580a88126ca611ab18d3d"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:331"><span class="id" title="variable">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">)</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:329"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:328"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#3450d8ce1b01000ee9564681170c56cb"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_value_fupd"><span class="id" title="lemma">wbwp_value_fupd</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Simplify the goal if it is <span class="inlinecode"><span class="id" title="var">WP</span></span> of a value.
  If the postcondition already allows a fupd, do not add a second one.
  But otherwise, *do* add a fupd. This ensures that all the lemmas applied
  here are bidirectional, so we never will make a goal unprovable. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_value_head</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">fupd</span> ?<span class="id" title="var">E</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_value_nofupd"><span class="id" title="lemma">tac_wp_value_nofupd</span></a><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">wp</span> <span class="id" title="var">_</span> ?<span class="id" title="var">E</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_value_nofupd"><span class="id" title="lemma">tac_wbwp_value_nofupd</span></a><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_value"><span class="id" title="lemma">tac_wp_value</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_finish</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_expr_simpl</span>;      <span class="comment">(*&nbsp;simplify&nbsp;occurences&nbsp;of&nbsp;subst/fill&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">wbwp_value_head</span>;  <span class="comment">(*&nbsp;in&nbsp;case&nbsp;we&nbsp;have&nbsp;reached&nbsp;a&nbsp;value,&nbsp;get&nbsp;rid&nbsp;of&nbsp;the&nbsp;WP&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">pm_prettify</span>. <span class="comment">(*&nbsp;prettify&nbsp;▷s&nbsp;caused&nbsp;by&nbsp;<span class="inlinecode"><span class="id" title="var">MaybeIntoLaterNEnvs</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;λs&nbsp;caused&nbsp;by&nbsp;wp_value&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
The argument <span class="inlinecode"><span class="id" title="var">efoc</span></span> can be used to specify the construct that should be
reduced. For example, you can write <span class="inlinecode"><span class="id" title="var">wp_pure</span></span> <span class="inlinecode">(<span class="id" title="var">EIf</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span>)</span>, which will search
for an <span class="inlinecode"><span class="id" title="var">EIf</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> in the expression, and reduce it.

<div class="paragraph"> </div>

The use of <span class="inlinecode"><span class="id" title="var">open_constr</span></span> in this tactic is essential. It will convert all holes
(i.e. <span class="inlinecode"><span class="id" title="var">_</span></span>s) into evars, that later get unified when an occurences is found
(see <span class="inlinecode"><span class="id" title="var">unify</span></span> <span class="inlinecode"><span class="id" title="var">e'</span></span> <span class="inlinecode"><span class="id" title="var">efoc</span></span> in the code below). 
</div>
<div class="code">
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pure" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">e</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_pure"><span class="id" title="lemma">tac_wbwp_pure</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;PureExec&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span>    <span class="comment">(*&nbsp;The&nbsp;pure&nbsp;condition&nbsp;for&nbsp;PureExec&nbsp;--<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handles&nbsp;trivial&nbsp;goals,&nbsp;including&nbsp;<span class="inlinecode"><span class="id" title="var">vals_compare_safe</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;IntoLaters&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wbwp_finish</span>                      <span class="comment">(*&nbsp;new&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" title="tactic">fail</span> "wbwp_pure: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> "or" <span class="id" title="var">efoc</span> "is not a redex"<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_pure: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pure" :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pure</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pure" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) "credit:" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Htmp</span> := <span class="id" title="var">iFresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">finish</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pm_reduce</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">iDestructHyp</span> <span class="id" title="var">Htmp</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H</span> || <span class="id" title="tactic">fail</span> 2 "wbwp_pure:" <span class="id" title="var">H</span> "is not fresh");<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">e</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_pure_credit"><span class="id" title="lemma">tac_wbwp_pure_credit</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Htmp</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;PureExec&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span>    <span class="comment">(*&nbsp;The&nbsp;pure&nbsp;condition&nbsp;for&nbsp;PureExec&nbsp;--<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handles&nbsp;trivial&nbsp;goals,&nbsp;including&nbsp;<span class="inlinecode"><span class="id" title="var">vals_compare_safe</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">tc_solve</span>                       <span class="comment">(*&nbsp;IntoLaters&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">finish</span> ()                      <span class="comment">(*&nbsp;new&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" title="tactic">fail</span> "wbwp_pure: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> "or" <span class="id" title="var">efoc</span> "is not a redex"<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_pure: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pure" "credit:" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pure</span> <span class="id" title="var">_</span> <span class="id" title="var">credit</span>: <span class="id" title="var">H</span>.<br/>

<br/>
<span class="comment">(*&nbsp;TODO:&nbsp;do&nbsp;this&nbsp;in&nbsp;one&nbsp;go,&nbsp;without&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_pures</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="comment">(*&nbsp;The&nbsp;`;<span class="inlinecode"></span>`&nbsp;makes&nbsp;sure&nbsp;that&nbsp;no&nbsp;side-condition&nbsp;magically&nbsp;spawns.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">progress</span> <span class="id" title="tactic">repeat</span> (<span class="id" title="var">wbwp_pure</span> <span class="id" title="var">_</span>; [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">wbwp_finish</span> <span class="comment">(*&nbsp;In&nbsp;case&nbsp;wp_pure&nbsp;never&nbsp;ran,&nbsp;make&nbsp;sure&nbsp;we&nbsp;do&nbsp;the&nbsp;usual&nbsp;cleanup.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
Unlike <span class="inlinecode"><span class="id" title="var">wp_pures</span></span>, the tactics <span class="inlinecode"><span class="id" title="var">wp_rec</span></span> and <span class="inlinecode"><span class="id" title="var">wp_lam</span></span> should also reduce
lambdas/recs that are hidden behind a definition, i.e. they should use
<span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.class_instances.html#AsRecV_recv"><span class="id" title="definition">AsRecV_recv</span></a></span> as a proper instance instead of a <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Extern</span></span>.

<div class="paragraph"> </div>

We achieve this by putting <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.class_instances.html#AsRecV_recv"><span class="id" title="definition">AsRecV_recv</span></a></span> in the current environment so that it
can be used as an instance by the typeclass resolution system. We then perform
the reduction, and finally we clear this new hypothesis. 
</div>
<div class="code">
<span class="id" title="keyword">Tactic Notation</span> "wbwp_rec" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span> := <span class="id" title="definition">AsRecV_recv</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.App"><span class="id" title="constructor">App</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_if" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.If"><span class="id" title="constructor">If</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_if_true" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.If"><span class="id" title="constructor">If</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_if_false" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.If"><span class="id" title="constructor">If</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_unop" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.UnOp"><span class="id" title="constructor">UnOp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_binop" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.BinOp"><span class="id" title="constructor">BinOp</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_op" := <span class="id" title="var">wbwp_unop</span> || <span class="id" title="var">wbwp_binop</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_lam" := <span class="id" title="var">wbwp_rec</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_let" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Rec"><span class="id" title="constructor">Rec</span></a> <span class="id" title="constructor">BAnon</span> (<span class="id" title="constructor">BNamed</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>); <span class="id" title="var">wbwp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_seq" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Rec"><span class="id" title="constructor">Rec</span></a> <span class="id" title="constructor">BAnon</span> <span class="id" title="constructor">BAnon</span> <span class="id" title="var">_</span>); <span class="id" title="var">wbwp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_proj" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Fst"><span class="id" title="constructor">Fst</span></a> <span class="id" title="var">_</span>) || <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Snd"><span class="id" title="constructor">Snd</span></a> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_case" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Case"><span class="id" title="constructor">Case</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_match" := <span class="id" title="var">wbwp_case</span>; <span class="id" title="var">wp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Rec"><span class="id" title="constructor">Rec</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="var">wbwp_lam</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_inj" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.InjL"><span class="id" title="constructor">InjL</span></a> <span class="id" title="var">_</span>) || <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.InjR"><span class="id" title="constructor">InjR</span></a> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_pair" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Pair"><span class="id" title="constructor">Pair</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_closure" := <span class="id" title="var">wbwp_pure</span> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Rec"><span class="id" title="constructor">Rec</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_bind" class="idref" href="#tac_wbwp_bind"><span class="id" title="lemma">tac_wbwp_bind</span></a> `{<a id="wbheapGS0:333" class="idref" href="#wbheapGS0:333"><span class="id" title="binder">!</span></a><a id="wbheapGS0:333" class="idref" href="#wbheapGS0:333"><span class="id" title="binder">wbheapGS</span></a> <a id="aaa9debfb5f0dbd1f80cc56913be71c1" class="idref" href="#aaa9debfb5f0dbd1f80cc56913be71c1"><span class="id" title="binder"><span id="wbheapGS0:333" class="id">Σ</span></span></a>} <a id="K:334" class="idref" href="#K:334"><span class="id" title="binder">K</span></a> <a id="1b3660cdd7734e3d37b94c3f43f99ba6" class="idref" href="#1b3660cdd7734e3d37b94c3f43f99ba6"><span class="id" title="binder">Δ</span></a> <a id="E:336" class="idref" href="#E:336"><span class="id" title="binder">E</span></a> <a id="out:337" class="idref" href="#out:337"><span class="id" title="binder">out</span></a> <a id="5566edd9e09061f7b3e3b8310e9cced5" class="idref" href="#5566edd9e09061f7b3e3b8310e9cced5"><span class="id" title="binder">Φ</span></a> <a id="e:339" class="idref" href="#e:339"><span class="id" title="binder">e</span></a> <a id="f:340" class="idref" href="#f:340"><span class="id" title="binder">f</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f:340"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <a id="e:341" class="idref" href="#e:341"><span class="id" title="binder">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:334"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:341"><span class="id" title="variable">e</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="comment">(*&nbsp;as&nbsp;an&nbsp;eta&nbsp;expanded&nbsp;hypothesis&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;`simpl`&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1b3660cdd7734e3d37b94c3f43f99ba6"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:339"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:337"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:336"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">{{</span></a> <a id="v:342" class="idref" href="#v:342"><span class="id" title="binder">v</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#f:340"><span class="id" title="variable">f</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:342"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:337"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:336"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5566edd9e09061f7b3e3b8310e9cced5"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#0e94461d641dcf3403e79b3abed679d5"><span class="id" title="notation">}}</span></a>)%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1b3660cdd7734e3d37b94c3f43f99ba6"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:334"><span class="id" title="variable">K</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e:339"><span class="id" title="variable">e</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:337"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:336"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5566edd9e09061f7b3e3b8310e9cced5"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; -&gt; -&gt;. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span>: <a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_bind_core</span> <span class="id" title="var">K</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="tactic">eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">K</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_bind"><span class="id" title="lemma">tac_wbwp_bind</span></a> <span class="id" title="var">K</span>); [<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>|<span class="id" title="var">reduction.pm_prettify</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_bind" <span class="id" title="var">open_constr</span>(<span class="id" title="var">efoc</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">iStartProof</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> [ <span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">unify</span> <span class="id" title="var">e'</span> <span class="id" title="var">efoc</span>; <span class="id" title="var">wbwp_bind_core</span> <span class="id" title="var">K</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">fail</span> 1 "wp_bind: cannot find" <span class="id" title="var">efoc</span> "in" <span class="id" title="var">e</span> ]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wp_bind: not a 'wp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Heap tactics 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a id="heap" class="idref" href="#heap"><span class="id" title="section">heap</span></a>.<br/>
<span class="id" title="keyword">Context</span> `{<a id="wbheapGS0:344" class="idref" href="#wbheapGS0:344"><span class="id" title="binder">!</span></a><a id="wbheapGS0:344" class="idref" href="#wbheapGS0:344"><span class="id" title="binder">wbheapGS</span></a> <a id="9fc8caaf18e0ccd741d3dd01a221533b" class="idref" href="#9fc8caaf18e0ccd741d3dd01a221533b"><span class="id" title="binder"><span id="wbheapGS0:344" class="id">Σ</span></span></a>}.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Φ</span> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">Δ</span> : <span class="id" title="record">envs</span> (<span class="id" title="definition">uPredI</span> (<span class="id" title="definition">iResUR</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c075f1221d2d857b95ac7ce005336844"><span class="id" title="variable">Σ</span></a>)).<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">v</span> : <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a>.<br/>
<span class="id" title="keyword">Implicit</span> <span class="id" title="keyword">Types</span> <span class="id" title="var">z</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_alloc" class="idref" href="#tac_wbwp_alloc"><span class="id" title="lemma">tac_wbwp_alloc</span></a> <a id="5f9aa26af2a66ac23cb8540333a86114" class="idref" href="#5f9aa26af2a66ac23cb8540333a86114"><span class="id" title="binder">Δ</span></a> <a id="fa85dda0bc28302b027fe1702f074bc8" class="idref" href="#fa85dda0bc28302b027fe1702f074bc8"><span class="id" title="binder">Δ'</span></a> <a id="E:347" class="idref" href="#E:347"><span class="id" title="binder">E</span></a> <a id="out:348" class="idref" href="#out:348"><span class="id" title="binder">out</span></a> <a id="j:349" class="idref" href="#j:349"><span class="id" title="binder">j</span></a> <a id="K:350" class="idref" href="#K:350"><span class="id" title="binder">K</span></a> <a id="v:351" class="idref" href="#v:351"><span class="id" title="binder">v</span></a> <a id="326757cdd92fb0bb2ad66c321e3a14f7" class="idref" href="#326757cdd92fb0bb2ad66c321e3a14f7"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5f9aa26af2a66ac23cb8540333a86114"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fa85dda0bc28302b027fe1702f074bc8"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <a id="l:353" class="idref" href="#l:353"><span class="id" title="binder">l</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_app</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#j:349"><span class="id" title="variable">j</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:353"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:351"><span class="id" title="variable">v</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fa85dda0bc28302b027fe1702f074bc8"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:350"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:353"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:348"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:347"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#326757cdd92fb0bb2ad66c321e3a14f7"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#5f9aa26af2a66ac23cb8540333a86114"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:350"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.notation.html#Alloc"><span class="id" title="abbreviation">Alloc</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:351"><span class="id" title="variable">v</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:348"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:347"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#326757cdd92fb0bb2ad66c321e3a14f7"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ? <span class="id" title="var">HΔ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_alloc"><span class="id" title="lemma">wbwp_alloc</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">left_id</span> <span class="id" title="lemma">into_laterN_env_sound</span>; <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">forall_intro</span>=&gt; <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">HΔ</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_app</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ'</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">envs_app_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_l</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="lemma">sep_elim_l</span> (<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <span class="id" title="var">v</span>)%<span class="id" title="var">I</span>) <span class="id" title="definition">right_id</span> <span class="id" title="lemma">wand_elim_r</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_free" class="idref" href="#tac_wbwp_free"><span class="id" title="lemma">tac_wbwp_free</span></a> <a id="0f27c89c367cf36720e8950a61454430" class="idref" href="#0f27c89c367cf36720e8950a61454430"><span class="id" title="binder">Δ</span></a> <a id="fc4788006572125d974eccfc11deea39" class="idref" href="#fc4788006572125d974eccfc11deea39"><span class="id" title="binder">Δ'</span></a> <a id="E:356" class="idref" href="#E:356"><span class="id" title="binder">E</span></a> <a id="out:357" class="idref" href="#out:357"><span class="id" title="binder">out</span></a> <a id="i:358" class="idref" href="#i:358"><span class="id" title="binder">i</span></a> <a id="K:359" class="idref" href="#K:359"><span class="id" title="binder">K</span></a> <a id="l:360" class="idref" href="#l:360"><span class="id" title="binder">l</span></a> <a id="v:361" class="idref" href="#v:361"><span class="id" title="binder">v</span></a> <a id="2a7bde374800d2f448a6846ccd8e86c4" class="idref" href="#2a7bde374800d2f448a6846ccd8e86c4"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#0f27c89c367cf36720e8950a61454430"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fc4788006572125d974eccfc11deea39"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:358"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fc4788006572125d974eccfc11deea39"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:360"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:361"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><span class="id" title="keyword">let</span> <a id="0ecef6f228e714834e53e6fe895c6667" class="idref" href="#0ecef6f228e714834e53e6fe895c6667"><span class="id" title="binder">Δ''</span></a> := <span class="id" title="definition">envs_delete</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:358"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fc4788006572125d974eccfc11deea39"><span class="id" title="variable">Δ'</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#0ecef6f228e714834e53e6fe895c6667"><span class="id" title="variable">Δ''</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:359"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:357"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:356"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2a7bde374800d2f448a6846ccd8e86c4"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#0f27c89c367cf36720e8950a61454430"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:359"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Free"><span class="id" title="constructor">Free</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:360"><span class="id" title="variable">l</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:357"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:356"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2a7bde374800d2f448a6846ccd8e86c4"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ? <span class="id" title="var">Hlk</span> <span class="id" title="var">Hfin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_free"><span class="id" title="lemma">wbwp_free</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="var">Hfin</span> <span class="id" title="lemma">wand_elim_r</span> (<span class="id" title="lemma">envs_lookup_sound'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hlk</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_intro_r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span> //.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_load" class="idref" href="#tac_wbwp_load"><span class="id" title="lemma">tac_wbwp_load</span></a> <a id="4f67fab079e5c768af55e63ddbbd8485" class="idref" href="#4f67fab079e5c768af55e63ddbbd8485"><span class="id" title="binder">Δ</span></a> <a id="69df8029ffd0ac22db11c45f0bfe36cf" class="idref" href="#69df8029ffd0ac22db11c45f0bfe36cf"><span class="id" title="binder">Δ'</span></a> <a id="E:366" class="idref" href="#E:366"><span class="id" title="binder">E</span></a> <a id="out:367" class="idref" href="#out:367"><span class="id" title="binder">out</span></a> <a id="i:368" class="idref" href="#i:368"><span class="id" title="binder">i</span></a> <a id="K:369" class="idref" href="#K:369"><span class="id" title="binder">K</span></a> <a id="b:370" class="idref" href="#b:370"><span class="id" title="binder">b</span></a> <a id="l:371" class="idref" href="#l:371"><span class="id" title="binder">l</span></a> <a id="q:372" class="idref" href="#q:372"><span class="id" title="binder">q</span></a> <a id="v:373" class="idref" href="#v:373"><span class="id" title="binder">v</span></a> <a id="b1fc276b0e4365076b9df5421a1422b2" class="idref" href="#b1fc276b0e4365076b9df5421a1422b2"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#4f67fab079e5c768af55e63ddbbd8485"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#69df8029ffd0ac22db11c45f0bfe36cf"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:368"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#69df8029ffd0ac22db11c45f0bfe36cf"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b:370"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:371"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#q:372"><span class="id" title="variable">q</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:373"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#69df8029ffd0ac22db11c45f0bfe36cf"><span class="id" title="variable">Δ'</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:369"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:373"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:367"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:366"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b1fc276b0e4365076b9df5421a1422b2"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#4f67fab079e5c768af55e63ddbbd8485"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:369"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Load"><span class="id" title="constructor">Load</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:371"><span class="id" title="variable">l</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:367"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:366"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#b1fc276b0e4365076b9df5421a1422b2"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?? <span class="id" title="var">Hi</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_load"><span class="id" title="lemma">wbwp_load</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="var">iIntros</span> "[#$ He]". <span class="id" title="var">iIntros</span> "_". <span class="id" title="var">iApply</span> <span class="id" title="var">Hi</span>. <span class="id" title="var">iApply</span> "He". <span class="id" title="var">iFrame</span> "#".<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_store" class="idref" href="#tac_wbwp_store"><span class="id" title="lemma">tac_wbwp_store</span></a> <a id="99643c007ef4c6f62e37b5bc54ec4b7c" class="idref" href="#99643c007ef4c6f62e37b5bc54ec4b7c"><span class="id" title="binder">Δ</span></a> <a id="059ff95ea3e826975e25b27a15a227b2" class="idref" href="#059ff95ea3e826975e25b27a15a227b2"><span class="id" title="binder">Δ'</span></a> <a id="E:377" class="idref" href="#E:377"><span class="id" title="binder">E</span></a> <a id="out:378" class="idref" href="#out:378"><span class="id" title="binder">out</span></a> <a id="i:379" class="idref" href="#i:379"><span class="id" title="binder">i</span></a> <a id="K:380" class="idref" href="#K:380"><span class="id" title="binder">K</span></a> <a id="l:381" class="idref" href="#l:381"><span class="id" title="binder">l</span></a> <a id="v:382" class="idref" href="#v:382"><span class="id" title="binder">v</span></a> <a id="v':383" class="idref" href="#v':383"><span class="id" title="binder">v'</span></a> <a id="0d723d146891636006bc936faa4c90d7" class="idref" href="#0d723d146891636006bc936faa4c90d7"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#99643c007ef4c6f62e37b5bc54ec4b7c"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#059ff95ea3e826975e25b27a15a227b2"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:379"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#059ff95ea3e826975e25b27a15a227b2"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:381"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:382"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:379"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:379"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:381"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':383"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#059ff95ea3e826975e25b27a15a227b2"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:380"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitUnit"><span class="id" title="constructor">LitUnit</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:378"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:377"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#0d723d146891636006bc936faa4c90d7"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#99643c007ef4c6f62e37b5bc54ec4b7c"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:380"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Store"><span class="id" title="constructor">Store</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:381"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':383"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:378"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:377"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#0d723d146891636006bc936faa4c90d7"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_store"><span class="id" title="lemma">wbwp_store</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_xchg" class="idref" href="#tac_wbwp_xchg"><span class="id" title="lemma">tac_wbwp_xchg</span></a> <a id="94545790d6ee6361ad4c45c07603e8f0" class="idref" href="#94545790d6ee6361ad4c45c07603e8f0"><span class="id" title="binder">Δ</span></a> <a id="fcf08d19f67fb9d62c344fd413551e32" class="idref" href="#fcf08d19f67fb9d62c344fd413551e32"><span class="id" title="binder">Δ'</span></a> <a id="E:387" class="idref" href="#E:387"><span class="id" title="binder">E</span></a> <a id="out:388" class="idref" href="#out:388"><span class="id" title="binder">out</span></a> <a id="i:389" class="idref" href="#i:389"><span class="id" title="binder">i</span></a> <a id="K:390" class="idref" href="#K:390"><span class="id" title="binder">K</span></a> <a id="l:391" class="idref" href="#l:391"><span class="id" title="binder">l</span></a> <a id="v:392" class="idref" href="#v:392"><span class="id" title="binder">v</span></a> <a id="v':393" class="idref" href="#v':393"><span class="id" title="binder">v'</span></a> <a id="1ec5268b3e17be026489a53ad4e99f96" class="idref" href="#1ec5268b3e17be026489a53ad4e99f96"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#94545790d6ee6361ad4c45c07603e8f0"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fcf08d19f67fb9d62c344fd413551e32"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:389"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fcf08d19f67fb9d62c344fd413551e32"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:391"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:392"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:389"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:389"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:391"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':393"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#fcf08d19f67fb9d62c344fd413551e32"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:390"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:392"><span class="id" title="variable">v</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:388"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:387"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1ec5268b3e17be026489a53ad4e99f96"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#94545790d6ee6361ad4c45c07603e8f0"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:390"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Xchg"><span class="id" title="constructor">Xchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:391"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v':393"><span class="id" title="variable">v'</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:388"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:387"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1ec5268b3e17be026489a53ad4e99f96"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_xchg"><span class="id" title="lemma">wbwp_xchg</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_cmpxchg" class="idref" href="#tac_wbwp_cmpxchg"><span class="id" title="lemma">tac_wbwp_cmpxchg</span></a> <a id="c3eaa325551c97ff0a6d71baa2cdf924" class="idref" href="#c3eaa325551c97ff0a6d71baa2cdf924"><span class="id" title="binder">Δ</span></a> <a id="65bc7ea1a4f025d02fb289b08c0721d2" class="idref" href="#65bc7ea1a4f025d02fb289b08c0721d2"><span class="id" title="binder">Δ'</span></a> <a id="E:397" class="idref" href="#E:397"><span class="id" title="binder">E</span></a> <a id="out:398" class="idref" href="#out:398"><span class="id" title="binder">out</span></a> <a id="i:399" class="idref" href="#i:399"><span class="id" title="binder">i</span></a> <a id="K:400" class="idref" href="#K:400"><span class="id" title="binder">K</span></a> <a id="l:401" class="idref" href="#l:401"><span class="id" title="binder">l</span></a> <a id="v:402" class="idref" href="#v:402"><span class="id" title="binder">v</span></a> <a id="v1:403" class="idref" href="#v1:403"><span class="id" title="binder">v1</span></a> <a id="v2:404" class="idref" href="#v2:404"><span class="id" title="binder">v2</span></a> <a id="898e6cedc2bab2f31a1d24a7e57f9c33" class="idref" href="#898e6cedc2bab2f31a1d24a7e57f9c33"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c3eaa325551c97ff0a6d71baa2cdf924"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#65bc7ea1a4f025d02fb289b08c0721d2"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:399"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#65bc7ea1a4f025d02fb289b08c0721d2"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:401"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:402"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:402"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:403"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:399"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:399"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:401"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:404"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#65bc7ea1a4f025d02fb289b08c0721d2"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:402"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:403"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:400"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:402"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:398"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:397"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#898e6cedc2bab2f31a1d24a7e57f9c33"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">(</span></a><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:402"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:403"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#65bc7ea1a4f025d02fb289b08c0721d2"><span class="id" title="variable">Δ'</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:400"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:402"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:398"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:397"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#898e6cedc2bab2f31a1d24a7e57f9c33"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#c3eaa325551c97ff0a6d71baa2cdf924"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:400"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:401"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:403"><span class="id" title="variable">v1</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:404"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:398"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:397"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#898e6cedc2bab2f31a1d24a7e57f9c33"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ??? <span class="id" title="var">Hsuc</span> <span class="id" title="var">Hfail</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v1</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span>|<span class="id" title="var">Hne</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_cmpxchg_suc"><span class="id" title="lemma">wbwp_cmpxchg_suc</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> /= {1}<span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_cmpxchg_fail"><span class="id" title="lemma">wbwp_cmpxchg_fail</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> /= {1}<span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_cmpxchg_fail" class="idref" href="#tac_wbwp_cmpxchg_fail"><span class="id" title="lemma">tac_wbwp_cmpxchg_fail</span></a> <a id="325f10d78fe7e485549ccdd38befd4f2" class="idref" href="#325f10d78fe7e485549ccdd38befd4f2"><span class="id" title="binder">Δ</span></a> <a id="1cde667332bfa221cdfc470e7a9bbbc0" class="idref" href="#1cde667332bfa221cdfc470e7a9bbbc0"><span class="id" title="binder">Δ'</span></a> <a id="E:408" class="idref" href="#E:408"><span class="id" title="binder">E</span></a> <a id="out:409" class="idref" href="#out:409"><span class="id" title="binder">out</span></a> <a id="i:410" class="idref" href="#i:410"><span class="id" title="binder">i</span></a> <a id="K:411" class="idref" href="#K:411"><span class="id" title="binder">K</span></a> <a id="l:412" class="idref" href="#l:412"><span class="id" title="binder">l</span></a> <a id="q:413" class="idref" href="#q:413"><span class="id" title="binder">q</span></a> <a id="v:414" class="idref" href="#v:414"><span class="id" title="binder">v</span></a> <a id="v1:415" class="idref" href="#v1:415"><span class="id" title="binder">v1</span></a> <a id="v2:416" class="idref" href="#v2:416"><span class="id" title="binder">v2</span></a> <a id="30dcad2be44372980ed322a0c4af6a83" class="idref" href="#30dcad2be44372980ed322a0c4af6a83"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#325f10d78fe7e485549ccdd38befd4f2"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1cde667332bfa221cdfc470e7a9bbbc0"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:410"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1cde667332bfa221cdfc470e7a9bbbc0"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:412"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#q:413"><span class="id" title="variable">q</span></a><span class="id" title="notation">}</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:414"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:414"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:415"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:414"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:415"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#1cde667332bfa221cdfc470e7a9bbbc0"><span class="id" title="variable">Δ'</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:411"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:414"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:409"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:408"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#30dcad2be44372980ed322a0c4af6a83"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#325f10d78fe7e485549ccdd38befd4f2"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:411"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:412"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:415"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:416"><span class="id" title="variable">v2</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:409"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:408"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#30dcad2be44372980ed322a0c4af6a83"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?????.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_cmpxchg_fail"><span class="id" title="lemma">wbwp_cmpxchg_fail</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_lookup_split</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_cmpxchg_suc" class="idref" href="#tac_wbwp_cmpxchg_suc"><span class="id" title="lemma">tac_wbwp_cmpxchg_suc</span></a> <a id="02bf308807dfc4332a48cfaf60a29962" class="idref" href="#02bf308807dfc4332a48cfaf60a29962"><span class="id" title="binder">Δ</span></a> <a id="2d9c34f2727ecd407131c5c4df6a65db" class="idref" href="#2d9c34f2727ecd407131c5c4df6a65db"><span class="id" title="binder">Δ'</span></a> <a id="E:420" class="idref" href="#E:420"><span class="id" title="binder">E</span></a> <a id="out:421" class="idref" href="#out:421"><span class="id" title="binder">out</span></a> <a id="i:422" class="idref" href="#i:422"><span class="id" title="binder">i</span></a> <a id="K:423" class="idref" href="#K:423"><span class="id" title="binder">K</span></a> <a id="l:424" class="idref" href="#l:424"><span class="id" title="binder">l</span></a> <a id="v:425" class="idref" href="#v:425"><span class="id" title="binder">v</span></a> <a id="v1:426" class="idref" href="#v1:426"><span class="id" title="binder">v1</span></a> <a id="v2:427" class="idref" href="#v2:427"><span class="id" title="binder">v2</span></a> <a id="e079e33a1b14a056b36b18e0e1f86482" class="idref" href="#e079e33a1b14a056b36b18e0e1f86482"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#02bf308807dfc4332a48cfaf60a29962"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2d9c34f2727ecd407131c5c4df6a65db"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:422"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2d9c34f2727ecd407131c5c4df6a65db"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:424"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:425"><span class="id" title="variable">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:425"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:426"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.vals_compare_safe"><span class="id" title="definition">vals_compare_safe</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:425"><span class="id" title="variable">v</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:426"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:422"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:422"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:424"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:427"><span class="id" title="variable">v2</span></a>)) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#2d9c34f2727ecd407131c5c4df6a65db"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:423"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.PairV"><span class="id" title="constructor">PairV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v:425"><span class="id" title="variable">v</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitBool"><span class="id" title="constructor">LitBool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:421"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:420"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e079e33a1b14a056b36b18e0e1f86482"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#02bf308807dfc4332a48cfaf60a29962"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:423"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:424"><span class="id" title="variable">l</span></a>) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v1:426"><span class="id" title="variable">v1</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#v2:427"><span class="id" title="variable">v2</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:421"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:420"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#e079e33a1b14a056b36b18e0e1f86482"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ?????; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_cmpxchg_suc"><span class="id" title="lemma">wbwp_cmpxchg_suc</span></a>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="tac_wbwp_faa" class="idref" href="#tac_wbwp_faa"><span class="id" title="lemma">tac_wbwp_faa</span></a> <a id="8391e5df5c1730b45fd430fdbd07e524" class="idref" href="#8391e5df5c1730b45fd430fdbd07e524"><span class="id" title="binder">Δ</span></a> <a id="50b8769012add7735119f1f608e1f0b4" class="idref" href="#50b8769012add7735119f1f608e1f0b4"><span class="id" title="binder">Δ'</span></a> <a id="E:431" class="idref" href="#E:431"><span class="id" title="binder">E</span></a> <a id="out:432" class="idref" href="#out:432"><span class="id" title="binder">out</span></a> <a id="i:433" class="idref" href="#i:433"><span class="id" title="binder">i</span></a> <a id="K:434" class="idref" href="#K:434"><span class="id" title="binder">K</span></a> <a id="l:435" class="idref" href="#l:435"><span class="id" title="binder">l</span></a> <a id="z1:436" class="idref" href="#z1:436"><span class="id" title="binder">z1</span></a> <a id="z2:437" class="idref" href="#z2:437"><span class="id" title="binder">z2</span></a> <a id="8dd519b622979b09bfbb79ce09b0842c" class="idref" href="#8dd519b622979b09bfbb79ce09b0842c"><span class="id" title="binder">Φ</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="class">MaybeIntoLaterNEnvs</span> 1 <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8391e5df5c1730b45fd430fdbd07e524"><span class="id" title="variable">Δ</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#50b8769012add7735119f1f608e1f0b4"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_lookup</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:433"><span class="id" title="variable">i</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#50b8769012add7735119f1f608e1f0b4"><span class="id" title="variable">Δ'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:435"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:436"><span class="id" title="variable">z1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>%<span class="id" title="var">I</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="definition">envs_simple_replace</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:433"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="constructor">Esnoc</span> <span class="id" title="constructor">Enil</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#i:433"><span class="id" title="variable">i</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:435"><span class="id" title="variable">l</span></a> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitInt"><span class="id" title="constructor">LitInt</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:436"><span class="id" title="variable">z1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z2:437"><span class="id" title="variable">z2</span></a>)))) <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#50b8769012add7735119f1f608e1f0b4"><span class="id" title="variable">Δ'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">Δ''</span> =&gt; <span class="id" title="definition">envs_entails</span> <span class="id" title="var">Δ''</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:434"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.Val"><span class="id" title="constructor">Val</span></a> <span class="id" title="notation">$</span> <a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z1:436"><span class="id" title="variable">z1</span></a>) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:432"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:431"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8dd519b622979b09bfbb79ce09b0842c"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">envs_entails</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8391e5df5c1730b45fd430fdbd07e524"><span class="id" title="variable">Δ</span></a> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">WBWP</span></a> <span class="id" title="definition">fill</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#K:434"><span class="id" title="variable">K</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.FAA"><span class="id" title="constructor">FAA</span></a> (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#l:435"><span class="id" title="variable">l</span></a>) (<a class="idref" href="WBLogic.heap_lang_trace.lang.html#heap_lang.LitV"><span class="id" title="constructor">LitV</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#z2:437"><span class="id" title="variable">z2</span></a>)) <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">@</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#out:432"><span class="id" title="variable">out</span></a><a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">;</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#E:431"><span class="id" title="variable">E</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">{{</span></a> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#8dd519b622979b09bfbb79ce09b0842c"><span class="id" title="variable">Φ</span></a> <a class="idref" href="WBLogic.program_logic.weakestpre.html#c4a2c4d7e3cc404db366e8ac4317091d"><span class="id" title="notation">}}</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">envs_entails_unseal</span>=&gt; ???.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">envs_simple_replace</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Δ''</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HΔ''</span>; [ | <span class="id" title="var">contradiction</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp_bind"><span class="id" title="lemma">wbwp_bind</span></a>. <span class="id" title="tactic">eapply</span> <span class="id" title="lemma">wand_apply</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> (<a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#wbwp_faa"><span class="id" title="lemma">wbwp_faa</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">z1</span> <span class="id" title="var">z2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">into_laterN_env_sound</span> -<span class="id" title="lemma">later_sep</span> <span class="id" title="lemma">envs_simple_replace_sound</span> //; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="definition">right_id</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">later_mono</span>, <span class="id" title="lemma">sep_mono_r</span>, <span class="id" title="lemma">wand_mono</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#heap"><span class="id" title="section">heap</span></a>.<br/>

<br/>
</div>

<div class="doc">
The tactic <span class="inlinecode"><span class="id" title="var">wp_apply_core</span></span> <span class="inlinecode"><span class="id" title="var">lem</span></span> <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">tac_fail</span></span> evaluates <span class="inlinecode"><span class="id" title="var">lem</span></span> to a
hypothesis <span class="inlinecode"><span class="id" title="var">H</span></span> that can be applied, and then runs <span class="inlinecode"><span class="id" title="var">wp_bind_core</span></span> <span class="inlinecode"><span class="id" title="var">K</span>;</span> <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span>
for every possible evaluation context <span class="inlinecode"><span class="id" title="var">K</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> The tactic <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> should do <span class="inlinecode"><span class="id" title="var">iApplyHyp</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> to actually apply the hypothesis,
  but can perform other operations in addition (see <span class="inlinecode"><span class="id" title="var">wp_apply</span></span> and <span class="inlinecode"><span class="id" title="var">awp_apply</span></span>
  below).

</li>
<li> The tactic <span class="inlinecode"><span class="id" title="var">tac_fail</span></span> <span class="inlinecode"><span class="id" title="var">cont</span></span> is called when <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> fails for all evaluation
  contexts <span class="inlinecode"><span class="id" title="var">K</span></span>, and can perform further operations before invoking <span class="inlinecode"><span class="id" title="var">cont</span></span> to
  try again.

</li>
</ul>

<div class="paragraph"> </div>

TC resolution of <span class="inlinecode"><span class="id" title="var">lem</span></span> premises happens *after* <span class="inlinecode"><span class="id" title="var">tac_suc</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span> got executed. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wbwp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="var">tac_suc</span> <span class="id" title="var">tac_fail</span> := <span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;[<span class="id" title="var">iPoseProofCore</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">as</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wbwp_bind_core</span> <span class="id" title="var">K</span>; <span class="id" title="var">tac_suc</span> <span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> 1 "wbwp_apply: not a 'wp'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;|<span class="id" title="var">tac_fail</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">wp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="var">tac_suc</span> <span class="id" title="var">tac_fail</span>)<br/>
&nbsp;&nbsp;|<span class="id" title="keyword">let</span> <span class="id" title="var">P</span> := <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">lem</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fail</span> "wbwp_apply: cannot apply" <span class="id" title="var">lem</span> ":" <span class="id" title="var">P</span> ].<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_apply" <span class="id" title="var">open_constr</span>(<span class="id" title="var">lem</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">iApplyHyp</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">iNext</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">wbwp_expr_simpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">cont</span> =&gt; <span class="id" title="tactic">fail</span>).<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_smart_apply" <span class="id" title="var">open_constr</span>(<span class="id" title="var">lem</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_apply_core</span> <span class="id" title="var">lem</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">iApplyHyp</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">iNext</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">wbwp_expr_simpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">cont</span> =&gt; <span class="id" title="var">wbwp_pure</span> <span class="id" title="var">_</span>; []; <span class="id" title="var">cont</span> ()).<br/>

<br/>
<span class="comment">(*&nbsp;<span class="comment">(**&nbsp;Tactic&nbsp;tailored&nbsp;for&nbsp;atomic&nbsp;triples:&nbsp;the&nbsp;first,&nbsp;simple&nbsp;one&nbsp;just&nbsp;runs&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">iAuIntro</span></span>&nbsp;on&nbsp;the&nbsp;goal,&nbsp;as&nbsp;atomic&nbsp;triples&nbsp;always&nbsp;have&nbsp;an&nbsp;atomic&nbsp;update&nbsp;as&nbsp;their&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;premise.&nbsp;The&nbsp;second&nbsp;one&nbsp;additionaly&nbsp;does&nbsp;some&nbsp;framing:&nbsp;it&nbsp;gets&nbsp;rid&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">Hs</span></span>&nbsp;from&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;the&nbsp;context,&nbsp;reducing&nbsp;clutter.&nbsp;You&nbsp;get&nbsp;them&nbsp;all&nbsp;back&nbsp;in&nbsp;the&nbsp;continuation&nbsp;of&nbsp;the&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;atomic&nbsp;operation.&nbsp;*)</span>&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Tactic&nbsp;Notation&nbsp;"awp_apply"&nbsp;open_constr(lem)&nbsp;:=&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;wp_apply_core&nbsp;lem&nbsp;ltac:(fun&nbsp;H&nbsp;=&gt;&nbsp;iApplyHyp&nbsp;H)&nbsp;ltac:(fun&nbsp;cont&nbsp;=&gt;&nbsp;fail);&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;last&nbsp;iAuIntro.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Tactic&nbsp;Notation&nbsp;"awp_apply"&nbsp;open_constr(lem)&nbsp;"without"&nbsp;constr(Hs)&nbsp;:=&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Convert&nbsp;"list&nbsp;of&nbsp;hypothesis"&nbsp;into&nbsp;specialization&nbsp;pattern.&nbsp;*)</span>&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;let&nbsp;Hs&nbsp;:=&nbsp;words&nbsp;Hs&nbsp;in&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;let&nbsp;Hs&nbsp;:=&nbsp;eval&nbsp;vm_compute&nbsp;in&nbsp;(INamed&nbsp;&lt;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;wp_apply_core&nbsp;lem&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltac:(fun&nbsp;H&nbsp;=&gt;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iApply&nbsp;(wp_frame_wand&nbsp;with&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">SGoal</span></span> <span class="inlinecode">$</span> <span class="inlinecode"><span class="id" title="var">SpecGoal</span></span> <span class="inlinecode"><span class="id" title="var">GSpatial</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span> <span class="inlinecode">[]</span> <span class="inlinecode"><span class="id" title="var">Hs</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span>);&nbsp;<span class="inlinecode"><span class="id" title="var">iAccu</span>|<span class="id" title="var">iApplyHyp</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span>)&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltac:(fun&nbsp;cont&nbsp;=&gt;&nbsp;fail);&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;last&nbsp;iAuIntro.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_alloc" <span class="id" title="var">ident</span>(<span class="id" title="var">l</span>) "as" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Htmp</span> := <span class="id" title="var">iFresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">finish</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> [<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> | <span class="id" title="tactic">fail</span> 1 "wbwp_alloc:" <span class="id" title="var">l</span> "not fresh"];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pm_reduce</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="notation">False</span> =&gt; <span class="id" title="tactic">fail</span> 1 "wbwp_alloc:" <span class="id" title="var">H</span> "not fresh"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">iDestructHyp</span> <span class="id" title="var">Htmp</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>; <span class="id" title="var">wbwp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;</div>

<div class="doc">
The code first tries to use allocation lemma for a single reference,
     ie, <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wp_alloc"><span class="id" title="lemma">tac_wp_alloc</span></a></span> (respectively, <span class="inlinecode"><a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_twp_alloc"><span class="id" title="lemma">tac_twp_alloc</span></a></span>).
     If that fails, it tries to use the lemma <span class="inlinecode"><span class="id" title="var">tac_wp_allocN</span></span>
     (respectively, <span class="inlinecode"><span class="id" title="var">tac_twp_allocN</span></span>) for allocating an array.
     Notice that we could have used the array allocation lemma also for single
     references. However, that would produce the resource l ↦∗ <span class="inlinecode"><span class="id" title="var">v</span></span> instead of
     l ↦ v for single references. These are logically equivalent assertions
     but are not equal. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">process_single</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_alloc"><span class="id" title="lemma">tac_wbwp_alloc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Htmp</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_alloc: cannot find 'Alloc' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">finish</span> ()]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span> <span class="id" title="var">process_single</span> ()<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_alloc: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_alloc" <span class="id" title="var">ident</span>(<span class="id" title="var">l</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_alloc</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> "?".<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_free" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_free: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_free"><span class="id" title="lemma">tac_wbwp_free</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_free: cannot find 'Free' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_free: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_load" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_load: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_load"><span class="id" title="lemma">tac_wbwp_load</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_load: cannot find 'Load' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_load: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_store" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_store: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_store"><span class="id" title="lemma">tac_wbwp_store</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_store: cannot find 'Store' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">first</span> [<span class="id" title="var">wbwp_seq</span>|<span class="id" title="var">wbwp_finish</span>]]<br/>
  | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_store: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_xchg" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_xchg: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_xchg"><span class="id" title="lemma">tac_wbwp_xchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_xchg: cannot find 'Xchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">first</span> [<span class="id" title="var">wbwp_seq</span>|<span class="id" title="var">wbwp_finish</span>]]<br/>
  | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_xchg: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_cmpxchg" "as" <span class="id" title="var">simple_intropattern</span>(<span class="id" title="var">H1</span>) "|" <span class="id" title="var">simple_intropattern</span>(<span class="id" title="var">H2</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_cmpxchg: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_cmpxchg"><span class="id" title="lemma">tac_wbwp_cmpxchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_cmpxchg: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H1</span>; <span class="id" title="var">wbwp_finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">intros</span> <span class="id" title="var">H2</span>; <span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_cmpxchg: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_cmpxchg_fail" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_cmpxchg_fail: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_cmpxchg_fail"><span class="id" title="lemma">tac_wbwp_cmpxchg_fail</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_cmpxchg_fail: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>) <span class="comment">(*&nbsp;value&nbsp;inequality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_cmpxchg_fail: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_cmpxchg_suc" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_cmpxchg_suc: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wbwp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_cmpxchg_suc"><span class="id" title="lemma">tac_wbwp_cmpxchg_suc</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_cmpxchg_suc: cannot find 'CmpXchg' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">congruence</span>) <span class="comment">(*&nbsp;value&nbsp;equality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">try</span> <span class="id" title="var">solve_vals_compare_safe</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_cmpxchg_suc: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wbwp_faa" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">solve_mapsto</span> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> (?<span class="id" title="var">l</span> <a class="idref" href="WBLogic.heap_lang_trace.primitive_laws.html#577098eb17c8bdfdf51b301e275a88bb"><span class="id" title="notation">↦</span></a><span class="id" title="notation">{</span><span class="id" title="var">_</span><span class="id" title="notation">}</span> <span class="id" title="var">_</span>)%<span class="id" title="var">I</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <span class="id" title="var">l</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssumptionCore</span> || <span class="id" title="tactic">fail</span> "wbwp_faa: cannot find" <span class="id" title="var">l</span> "↦ ?" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="definition">envs_entails</span> <span class="id" title="var">_</span> (<a class="idref" href="WBLogic.program_logic.weakestpre.html#wbwp"><span class="id" title="definition">wbwp</span></a> ?<span class="id" title="var">E</span> ?<span class="id" title="var">out</span> ?<span class="id" title="var">e</span> ?<span class="id" title="var">Q</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">reshape_expr</span> <span class="id" title="var">e</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">K</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="WBLogic.heap_lang_trace.proofmode.html#tac_wbwp_faa"><span class="id" title="lemma">tac_wbwp_faa</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">K</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="tactic">fail</span> 1 "wbwp_faa: cannot find 'FAA' in" <span class="id" title="var">e</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">tc_solve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">solve_mapsto</span> ()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">pm_reduce</span>; <span class="id" title="var">wbwp_finish</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "wbwp_faa: not a 'wbwp'"<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
