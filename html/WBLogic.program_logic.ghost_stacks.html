<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../index.html">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">WBLogic.program_logic.ghost_stacks</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.algebra</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">auth</span> <span class="id" title="library">gmap</span> <span class="id" title="library">gset</span> <span class="id" title="library">excl</span> <span class="id" title="library">frac</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.base_logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">invariants</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">tactics</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.bi.lib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">fractional</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="ghost_id" class="idref" href="#ghost_id"><span class="id" title="definition">ghost_id</span></a> := <span class="id" title="definition">gname</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="gstack" class="idref" href="#gstack"><span class="id" title="definition">gstack</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="definition">gname</span>.<br/>
<span class="id" title="keyword">Definition</span> <a id="gstackO" class="idref" href="#gstackO"><span class="id" title="definition">gstackO</span></a> := <span class="id" title="definition">listO</span> <span class="id" title="definition">gnameO</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="gsingleton" class="idref" href="#gsingleton"><span class="id" title="definition">gsingleton</span></a> (<a id="44b4639a84cfffd8cd0f3f9a470b2894" class="idref" href="#44b4639a84cfffd8cd0f3f9a470b2894"><span class="id" title="binder">γ</span></a> : <span class="id" title="definition">gname</span>) : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#44b4639a84cfffd8cd0f3f9a470b2894"><span class="id" title="variable">γ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="gpush" class="idref" href="#gpush"><span class="id" title="definition">gpush</span></a> (<a id="3ffb5cd9b36ce8d36d184b60bf4332ea" class="idref" href="#3ffb5cd9b36ce8d36d184b60bf4332ea"><span class="id" title="binder">γ</span></a> : <span class="id" title="definition">gname</span>) (<a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a>) : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a> := <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#3ffb5cd9b36ce8d36d184b60bf4332ea"><span class="id" title="variable">γ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:3"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="gpop" class="idref" href="#gpop"><span class="id" title="definition">gpop</span></a> (<a id="s:4" class="idref" href="#s:4"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a>) : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a> := <span class="id" title="abbreviation">tail</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:4"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="gtop" class="idref" href="#gtop"><span class="id" title="definition">gtop</span></a> (<a id="s:5" class="idref" href="#s:5"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <span class="id" title="definition">gname</span> := <span class="id" title="abbreviation">head</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:5"><span class="id" title="variable">s</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="gtop_gpush" class="idref" href="#gtop_gpush"><span class="id" title="lemma">gtop_gpush</span></a> <a id="6dd44bbb6d127d23cd8a8fba1e8cb9f9" class="idref" href="#6dd44bbb6d127d23cd8a8fba1e8cb9f9"><span class="id" title="binder">γ</span></a> <a id="s:7" class="idref" href="#s:7"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gtop"><span class="id" title="definition">gtop</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gpush"><span class="id" title="definition">gpush</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#6dd44bbb6d127d23cd8a8fba1e8cb9f9"><span class="id" title="variable">γ</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:7"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#6dd44bbb6d127d23cd8a8fba1e8cb9f9"><span class="id" title="variable">γ</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="gtop_gsingleton" class="idref" href="#gtop_gsingleton"><span class="id" title="lemma">gtop_gsingleton</span></a> <a id="8b6cd59ca0e98ee35db3ac5053db09c3" class="idref" href="#8b6cd59ca0e98ee35db3ac5053db09c3"><span class="id" title="binder">γ</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gtop"><span class="id" title="definition">gtop</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gsingleton"><span class="id" title="definition">gsingleton</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#8b6cd59ca0e98ee35db3ac5053db09c3"><span class="id" title="variable">γ</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#8b6cd59ca0e98ee35db3ac5053db09c3"><span class="id" title="variable">γ</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="gpop_gpush" class="idref" href="#gpop_gpush"><span class="id" title="lemma">gpop_gpush</span></a> <a id="5c1067a9563b8bae1f4dc2a409ccba8f" class="idref" href="#5c1067a9563b8bae1f4dc2a409ccba8f"><span class="id" title="binder">γ</span></a> <a id="s:10" class="idref" href="#s:10"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gpop"><span class="id" title="definition">gpop</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gpush"><span class="id" title="definition">gpush</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#5c1067a9563b8bae1f4dc2a409ccba8f"><span class="id" title="variable">γ</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:10"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:10"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="gtop_inv" class="idref" href="#gtop_inv"><span class="id" title="lemma">gtop_inv</span></a> <a id="ffabb5326d6c3c3378c3a8b7fee7ec6d" class="idref" href="#ffabb5326d6c3c3378c3a8b7fee7ec6d"><span class="id" title="binder">γ</span></a> <a id="s:12" class="idref" href="#s:12"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gtop"><span class="id" title="definition">gtop</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:12"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ffabb5326d6c3c3378c3a8b7fee7ec6d"><span class="id" title="variable">γ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#94e052c6337a815c52cda44eea9df276"><span class="id" title="notation">∃</span></a> <a id="s':13" class="idref" href="#s':13"><span class="id" title="binder">s'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#94e052c6337a815c52cda44eea9df276"><span class="id" title="notation">,</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:12"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gpush"><span class="id" title="definition">gpush</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ffabb5326d6c3c3378c3a8b7fee7ec6d"><span class="id" title="variable">γ</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':13"><span class="id" title="variable">s'</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="var">simplify_eq</span>/=; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="gstackUR" class="idref" href="#gstackUR"><span class="id" title="definition">gstackUR</span></a> := <span class="id" title="definition">optionUR</span> (<span class="id" title="definition">exclR</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstackO"><span class="id" title="definition">gstackO</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="gstacks" class="idref" href="#gstacks"><span class="id" title="definition">gstacks</span></a> := <span class="id" title="record">gmap</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_id"><span class="id" title="definition">ghost_id</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="be256e1c85a7f6d1fc4ae0252d1bc9b5" class="idref" href="#be256e1c85a7f6d1fc4ae0252d1bc9b5"><span class="id" title="definition">gstacksΣ</span></a> := <span class="id" title="notation">#[</span><span class="id" title="constructor">GFunctor</span> (<span class="id" title="definition">authUR</span> (<span class="id" title="definition">gsetUR</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_id"><span class="id" title="definition">ghost_id</span></a>))<span class="id" title="notation">;</span> <span class="id" title="constructor">GFunctor</span> (<span class="id" title="definition">authUR</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstackUR"><span class="id" title="definition">gstackUR</span></a>)<span class="id" title="notation">]</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="gstacksGpre" class="idref" href="#gstacksGpre"><span class="id" title="record">gstacksGpre</span></a> <a id="08441172cd4c14450ee9e66c55932a87" class="idref" href="#08441172cd4c14450ee9e66c55932a87"><span class="id" title="binder">Σ</span></a> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gstacksGpre_dom_ing" class="idref" href="#gstacksGpre_dom_ing"><span class="id" title="projection">gstacksGpre_dom_ing</span></a> :: <span class="id" title="class">inG</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#08441172cd4c14450ee9e66c55932a87"><span class="id" title="variable">Σ</span></a> (<span class="id" title="definition">authUR</span> (<span class="id" title="definition">gsetUR</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_id"><span class="id" title="definition">ghost_id</span></a>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gstacksGpre_ing" class="idref" href="#gstacksGpre_ing"><span class="id" title="projection">gstacksGpre_ing</span></a> :: <span class="id" title="class">inG</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#08441172cd4c14450ee9e66c55932a87"><span class="id" title="variable">Σ</span></a> (<span class="id" title="definition">authUR</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstackUR"><span class="id" title="definition">gstackUR</span></a>);<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a id="gstacksIG" class="idref" href="#gstacksIG"><span class="id" title="record">gstacksIG</span></a> <a id="8b13b958e79b112c1b4fdea541acbd8a" class="idref" href="#8b13b958e79b112c1b4fdea541acbd8a"><span class="id" title="binder">Σ</span></a> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gstacks_dom_ing" class="idref" href="#gstacks_dom_ing"><span class="id" title="projection">gstacks_dom_ing</span></a> :: <span class="id" title="class">inG</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#8b13b958e79b112c1b4fdea541acbd8a"><span class="id" title="variable">Σ</span></a> (<span class="id" title="definition">authUR</span> (<span class="id" title="definition">gsetUR</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_id"><span class="id" title="definition">ghost_id</span></a>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gstacks_ing" class="idref" href="#gstacks_ing"><span class="id" title="projection">gstacks_ing</span></a> :: <span class="id" title="class">inG</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#8b13b958e79b112c1b4fdea541acbd8a"><span class="id" title="variable">Σ</span></a> (<span class="id" title="definition">authUR</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstackUR"><span class="id" title="definition">gstackUR</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a id="gstacks_name" class="idref" href="#gstacks_name"><span class="id" title="projection">gstacks_name</span></a> : <span class="id" title="definition">gname</span>;<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a id="8718418743fb30e6e9917cb3cf01e467" class="idref" href="#8718418743fb30e6e9917cb3cf01e467"><span class="id" title="instance">gstacks_subΣ_inG</span></a> <a id="3eadb2a0aeaeef49bd6cd27b7316c266" class="idref" href="#3eadb2a0aeaeef49bd6cd27b7316c266"><span class="id" title="binder">Σ</span></a> : <span class="id" title="class">subG</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#be256e1c85a7f6d1fc4ae0252d1bc9b5"><span class="id" title="definition">gstacksΣ</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#3eadb2a0aeaeef49bd6cd27b7316c266"><span class="id" title="variable">Σ</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacksGpre"><span class="id" title="class">gstacksGpre</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#3eadb2a0aeaeef49bd6cd27b7316c266"><span class="id" title="variable">Σ</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">solve_inG</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="ghost_stacks" class="idref" href="#ghost_stacks"><span class="id" title="section">ghost_stacks</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="gstacksIG0:25" class="idref" href="#gstacksIG0:25"><span class="id" title="binder">!</span></a><a id="gstacksIG0:25" class="idref" href="#gstacksIG0:25"><span class="id" title="binder">gstacksIG</span></a> <a id="0ff5eed445d72e1c5ccedcdae1755936" class="idref" href="#0ff5eed445d72e1c5ccedcdae1755936"><span class="id" title="binder"><span id="gstacksIG0:25" class="id">Σ</span></span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="gstack_frag" class="idref" href="#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> (<a id="n:26" class="idref" href="#n:26"><span class="id" title="binder">n</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_id"><span class="id" title="definition">ghost_id</span></a>) (<a id="s:27" class="idref" href="#s:27"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a>) : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#b05fa90a8b36503bccc8e29ec2501026"><span class="id" title="variable">Σ</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">own</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_name"><span class="id" title="method">gstacks_name</span></a> (<span class="id" title="notation">◯</span> <span class="id" title="notation">{[</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:26"><span class="id" title="variable">n</span></a><span class="id" title="notation">]}</span>) <span class="id" title="notation">∗</span> <span class="id" title="definition">own</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:26"><span class="id" title="variable">n</span></a> (<span class="id" title="notation">◯</span> <span class="id" title="abbreviation">Excl'</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:27"><span class="id" title="variable">s</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="gstack_full" class="idref" href="#gstack_full"><span class="id" title="definition">gstack_full</span></a> (<a id="n:28" class="idref" href="#n:28"><span class="id" title="binder">n</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_id"><span class="id" title="definition">ghost_id</span></a>) (<a id="s:29" class="idref" href="#s:29"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack"><span class="id" title="definition">gstack</span></a>) : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#b05fa90a8b36503bccc8e29ec2501026"><span class="id" title="variable">Σ</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">own</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_name"><span class="id" title="method">gstacks_name</span></a> (<span class="id" title="notation">◯</span> <span class="id" title="notation">{[</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:28"><span class="id" title="variable">n</span></a><span class="id" title="notation">]}</span>) <span class="id" title="notation">∗</span> <span class="id" title="definition">own</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:28"><span class="id" title="variable">n</span></a> (<span class="id" title="notation">●</span> <span class="id" title="abbreviation">Excl'</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:29"><span class="id" title="variable">s</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="gstack_exists" class="idref" href="#gstack_exists"><span class="id" title="definition">gstack_exists</span></a> (<a id="n:30" class="idref" href="#n:30"><span class="id" title="binder">n</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_id"><span class="id" title="definition">ghost_id</span></a>) : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#b05fa90a8b36503bccc8e29ec2501026"><span class="id" title="variable">Σ</span></a> := <span class="id" title="definition">own</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_name"><span class="id" title="method">gstacks_name</span></a> (<span class="id" title="notation">◯</span> <span class="id" title="notation">{[</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:30"><span class="id" title="variable">n</span></a><span class="id" title="notation">]}</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="gstacks_except" class="idref" href="#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> (<a id="M:31" class="idref" href="#M:31"><span class="id" title="binder">M</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks"><span class="id" title="definition">gstacks</span></a>) (<a id="N:32" class="idref" href="#N:32"><span class="id" title="binder">N</span></a> : <span class="id" title="definition">gset</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_id"><span class="id" title="definition">ghost_id</span></a>) : <span class="id" title="abbreviation">iProp</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#b05fa90a8b36503bccc8e29ec2501026"><span class="id" title="variable">Σ</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:32"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <span class="id" title="definition">dom</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:31"><span class="id" title="variable">M</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">∗</span> <span class="id" title="definition">own</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_name"><span class="id" title="method">gstacks_name</span></a> (<span class="id" title="notation">●</span> <span class="id" title="definition">dom</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:31"><span class="id" title="variable">M</span></a>) <span class="id" title="notation">∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">[∗</span> <span class="id" title="notation">map</span><span class="id" title="notation">]</span> <a id="n:33" class="idref" href="#n:33"><span class="id" title="binder"><span id="n:34" class="id">n</span></span></a> <span class="id" title="notation">↦</span> <a id="s:35" class="idref" href="#s:35"><span class="id" title="binder"><span id="s:36" class="id">s</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:31"><span class="id" title="variable">M</span></a><span class="id" title="notation">,</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="definition">bool_decide</span> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:33"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∈</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:32"><span class="id" title="variable">N</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a> <span class="id" title="notation">True</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:33"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:35"><span class="id" title="variable">s</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Typeclasses Opaque</span> <span class="id" title="var">gstack_frag</span> <span class="id" title="var">gstack_full</span> <span class="id" title="var">gstacks_except</span> <span class="id" title="var">gstack_exists</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="gstack_frag_Timeless" class="idref" href="#gstack_frag_Timeless"><span class="id" title="instance">gstack_frag_Timeless</span></a> <a id="n:37" class="idref" href="#n:37"><span class="id" title="binder">n</span></a> <a id="s:38" class="idref" href="#s:38"><span class="id" title="binder">s</span></a> : <span class="id" title="class">Timeless</span> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:37"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:38"><span class="id" title="variable">s</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a>; <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="gstack_full_Timeless" class="idref" href="#gstack_full_Timeless"><span class="id" title="instance">gstack_full_Timeless</span></a> <a id="n:39" class="idref" href="#n:39"><span class="id" title="binder">n</span></a> <a id="s:40" class="idref" href="#s:40"><span class="id" title="binder">s</span></a> : <span class="id" title="class">Timeless</span> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:39"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:40"><span class="id" title="variable">s</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a>; <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="gstack_exists_Timeless" class="idref" href="#gstack_exists_Timeless"><span class="id" title="instance">gstack_exists_Timeless</span></a> <a id="n:41" class="idref" href="#n:41"><span class="id" title="binder">n</span></a> : <span class="id" title="class">Timeless</span> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:41"><span class="id" title="variable">n</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a>; <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="gstack_exists_Persistent" class="idref" href="#gstack_exists_Persistent"><span class="id" title="instance">gstack_exists_Persistent</span></a> <a id="n:42" class="idref" href="#n:42"><span class="id" title="binder">n</span></a> : <span class="id" title="class">Persistent</span> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:42"><span class="id" title="variable">n</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a>; <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="gstacks_except_Timeless" class="idref" href="#gstacks_except_Timeless"><span class="id" title="instance">gstacks_except_Timeless</span></a> <a id="M:43" class="idref" href="#M:43"><span class="id" title="binder">M</span></a> <a id="N:44" class="idref" href="#N:44"><span class="id" title="binder">N</span></a> : <span class="id" title="class">Timeless</span> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:43"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:44"><span class="id" title="variable">N</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="instance">bi.sep_timeless</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="instance">bi.sep_timeless</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">big_sepM_timeless</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="definition">bool_decide</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstacks_agree" class="idref" href="#gstacks_agree"><span class="id" title="lemma">gstacks_agree</span></a> <a id="n:45" class="idref" href="#n:45"><span class="id" title="binder">n</span></a> <a id="s:46" class="idref" href="#s:46"><span class="id" title="binder">s</span></a> <a id="s':47" class="idref" href="#s':47"><span class="id" title="binder">s'</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:45"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:46"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:45"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':47"><span class="id" title="variable">s'</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:46"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':47"><span class="id" title="variable">s'</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "[_ H1] [_ H2]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">own_valid_2</span> <span class="id" title="notation">with</span> "H1 H2"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %[<span class="id" title="var">Hvl</span> <span class="id" title="var">_</span>]%<span class="id" title="lemma">auth_both_valid_discrete</span>; <span class="id" title="var">iPureIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">Excl_included</span>, <span class="id" title="definition">leibniz_equiv</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hvl</span>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_frag_unique" class="idref" href="#gstack_frag_unique"><span class="id" title="lemma">gstack_frag_unique</span></a> <a id="n:48" class="idref" href="#n:48"><span class="id" title="binder">n</span></a> <a id="s:49" class="idref" href="#s:49"><span class="id" title="binder">s</span></a> <a id="s':50" class="idref" href="#s':50"><span class="id" title="binder">s'</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:48"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:49"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:48"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':50"><span class="id" title="variable">s'</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">False</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "[_ H1] [_ H2]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">own_valid_2</span> <span class="id" title="notation">with</span> "H1 H2"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %<span class="id" title="var">Hvl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">auth_frag_op</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hvl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">auth_frag_valid_1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hvl</span>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_full_unique" class="idref" href="#gstack_full_unique"><span class="id" title="lemma">gstack_full_unique</span></a> <a id="n:51" class="idref" href="#n:51"><span class="id" title="binder">n</span></a> <a id="s:52" class="idref" href="#s:52"><span class="id" title="binder">s</span></a> <a id="s':53" class="idref" href="#s':53"><span class="id" title="binder">s'</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:51"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:52"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:51"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':53"><span class="id" title="variable">s'</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">False</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "[_ H1] [_ H2]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">own_valid_2</span> <span class="id" title="notation">with</span> "H1 H2"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %<span class="id" title="var">Hvl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">auth_auth_op_valid</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hvl</span>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_push" class="idref" href="#gstack_push"><span class="id" title="lemma">gstack_push</span></a> <a id="n:54" class="idref" href="#n:54"><span class="id" title="binder">n</span></a> <a id="s:55" class="idref" href="#s:55"><span class="id" title="binder">s</span></a> <a id="s':56" class="idref" href="#s':56"><span class="id" title="binder">s'</span></a> <a id="63887b266b8cca5829aa6f80b14dab65" class="idref" href="#63887b266b8cca5829aa6f80b14dab65"><span class="id" title="binder">γ</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:54"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:55"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:54"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':56"><span class="id" title="variable">s'</span></a> <span class="id" title="notation">==∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:54"><span class="id" title="variable">n</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gpush"><span class="id" title="definition">gpush</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#63887b266b8cca5829aa6f80b14dab65"><span class="id" title="variable">γ</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:55"><span class="id" title="variable">s</span></a>) <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:54"><span class="id" title="variable">n</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gpush"><span class="id" title="definition">gpush</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#63887b266b8cca5829aa6f80b14dab65"><span class="id" title="variable">γ</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':56"><span class="id" title="variable">s'</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hfl Hfr".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_agree"><span class="id" title="lemma">gstacks_agree</span></a> <span class="id" title="notation">with</span> "Hfl Hfr"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %&lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hfl" <span class="id" title="keyword">as</span> "[$ Hfl]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hfr" <span class="id" title="keyword">as</span> "[$ Hfr]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">own_update_2</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="notation">●</span> <span class="id" title="var">_</span> <span class="id" title="notation">⋅</span> <span class="id" title="notation">◯</span> <span class="id" title="var">_</span>) <span class="id" title="notation">with</span> "Hfl Hfr"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ $]"; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">auth_update</span>, <span class="id" title="lemma">option_local_update</span>, <span class="id" title="lemma">exclusive_local_update</span>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_pop" class="idref" href="#gstack_pop"><span class="id" title="lemma">gstack_pop</span></a> <a id="n:58" class="idref" href="#n:58"><span class="id" title="binder">n</span></a> <a id="s:59" class="idref" href="#s:59"><span class="id" title="binder">s</span></a> <a id="s':60" class="idref" href="#s':60"><span class="id" title="binder">s'</span></a> <a id="7274d1d27e32c79b14d6ff0a86a9916b" class="idref" href="#7274d1d27e32c79b14d6ff0a86a9916b"><span class="id" title="binder">γ</span></a> <a id="e924f1e27bcd677cca04c8adfa52dc51" class="idref" href="#e924f1e27bcd677cca04c8adfa52dc51"><span class="id" title="binder">γ'</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:58"><span class="id" title="variable">n</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gpush"><span class="id" title="definition">gpush</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#7274d1d27e32c79b14d6ff0a86a9916b"><span class="id" title="variable">γ</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:59"><span class="id" title="variable">s</span></a>) <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:58"><span class="id" title="variable">n</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gpush"><span class="id" title="definition">gpush</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#e924f1e27bcd677cca04c8adfa52dc51"><span class="id" title="variable">γ'</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':60"><span class="id" title="variable">s'</span></a>) <span class="id" title="notation">==∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:58"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:59"><span class="id" title="variable">s</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:58"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s':60"><span class="id" title="variable">s'</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hfl Hfr".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_agree"><span class="id" title="lemma">gstacks_agree</span></a> <span class="id" title="notation">with</span> "Hfl Hfr"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?; <span class="id" title="var">simplify_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hfl" <span class="id" title="keyword">as</span> "[$ Hfl]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hfr" <span class="id" title="keyword">as</span> "[$ Hfr]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">own_update_2</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="notation">●</span> <span class="id" title="var">_</span> <span class="id" title="notation">⋅</span> <span class="id" title="notation">◯</span> <span class="id" title="var">_</span>) <span class="id" title="notation">with</span> "Hfl Hfr"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[$ $]"; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">auth_update</span>, <span class="id" title="lemma">option_local_update</span>, <span class="id" title="lemma">exclusive_local_update</span>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_frag_exists" class="idref" href="#gstack_frag_exists"><span class="id" title="lemma">gstack_frag_exists</span></a> <a id="n:63" class="idref" href="#n:63"><span class="id" title="binder">n</span></a> <a id="s:64" class="idref" href="#s:64"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:63"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:64"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:63"><span class="id" title="variable">n</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a>; <span class="id" title="var">iIntros</span> "[$ ?]". <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_full_exists" class="idref" href="#gstack_full_exists"><span class="id" title="lemma">gstack_full_exists</span></a> <a id="n:65" class="idref" href="#n:65"><span class="id" title="binder">n</span></a> <a id="s:66" class="idref" href="#s:66"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:65"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:66"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:65"><span class="id" title="variable">n</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a>; <span class="id" title="var">iIntros</span> "[$ ?]". <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_exists_in" class="idref" href="#gstack_exists_in"><span class="id" title="lemma">gstack_exists_in</span></a> <a id="M:67" class="idref" href="#M:67"><span class="id" title="binder">M</span></a> <a id="N:68" class="idref" href="#N:68"><span class="id" title="binder">N</span></a> <a id="n:69" class="idref" href="#n:69"><span class="id" title="binder">n</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:69"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:67"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:68"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:69"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∈</span> <span class="id" title="definition">dom</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:67"><span class="id" title="variable">M</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "H1 (_&amp;H2&amp;_)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">own_valid_2</span> <span class="id" title="notation">with</span> "H2 H1"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %[?%<span class="id" title="lemma">gset_included</span> ?]%<span class="id" title="lemma">auth_both_valid_discrete</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iPureIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_frag_in" class="idref" href="#gstack_frag_in"><span class="id" title="lemma">gstack_frag_in</span></a> <a id="M:70" class="idref" href="#M:70"><span class="id" title="binder">M</span></a> <a id="N:71" class="idref" href="#N:71"><span class="id" title="binder">N</span></a> <a id="n:72" class="idref" href="#n:72"><span class="id" title="binder">n</span></a> <a id="s:73" class="idref" href="#s:73"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:72"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:73"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:70"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:71"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:72"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∈</span> <span class="id" title="definition">dom</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:70"><span class="id" title="variable">M</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hfr Hgs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag_exists"><span class="id" title="lemma">gstack_frag_exists</span></a> <span class="id" title="notation">with</span> "Hfr"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "#?".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists_in"><span class="id" title="lemma">gstack_exists_in</span></a>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_frag_not_out_agree" class="idref" href="#gstack_frag_not_out_agree"><span class="id" title="lemma">gstack_frag_not_out_agree</span></a> <a id="M:74" class="idref" href="#M:74"><span class="id" title="binder">M</span></a> <a id="N:75" class="idref" href="#N:75"><span class="id" title="binder">N</span></a> <a id="n:76" class="idref" href="#n:76"><span class="id" title="binder">n</span></a> <a id="s:77" class="idref" href="#s:77"><span class="id" title="binder">s</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:76"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∉</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:75"><span class="id" title="variable">N</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:76"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:77"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:74"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:75"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:74"><span class="id" title="variable">M</span></a> <span class="id" title="notation">!!</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:76"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:77"><span class="id" title="variable">s</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?) "Hfr Hgs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag_in"><span class="id" title="lemma">gstack_frag_in</span></a> <span class="id" title="notation">with</span> "Hfr Hgs"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %[<span class="id" title="var">s'</span> <span class="id" title="var">Hs'</span>]%<span class="id" title="method">elem_of_dom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hgs" <span class="id" title="keyword">as</span> "[% [? Hfls]]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">big_sepM_lookup</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">n</span> <span class="id" title="notation">with</span> "Hfls"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hfl"; <span class="id" title="tactic">first</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_false_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_agree"><span class="id" title="lemma">gstacks_agree</span></a> <span class="id" title="notation">with</span> "Hfl Hfr"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %-&gt;; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_full_in" class="idref" href="#gstack_full_in"><span class="id" title="lemma">gstack_full_in</span></a> <a id="M:78" class="idref" href="#M:78"><span class="id" title="binder">M</span></a> <a id="N:79" class="idref" href="#N:79"><span class="id" title="binder">N</span></a> <a id="n:80" class="idref" href="#n:80"><span class="id" title="binder">n</span></a> <a id="s:81" class="idref" href="#s:81"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:80"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:81"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:78"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:79"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:80"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∈</span> <span class="id" title="definition">dom</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:78"><span class="id" title="variable">M</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hfr Hgs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full_exists"><span class="id" title="lemma">gstack_full_exists</span></a> <span class="id" title="notation">with</span> "Hfr"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "#?".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists_in"><span class="id" title="lemma">gstack_exists_in</span></a>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_full_is_out" class="idref" href="#gstack_full_is_out"><span class="id" title="lemma">gstack_full_is_out</span></a> <a id="M:82" class="idref" href="#M:82"><span class="id" title="binder">M</span></a> <a id="N:83" class="idref" href="#N:83"><span class="id" title="binder">N</span></a> <a id="n:84" class="idref" href="#n:84"><span class="id" title="binder">n</span></a> <a id="s:85" class="idref" href="#s:85"><span class="id" title="binder">s</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:84"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:85"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:82"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:83"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:84"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∈</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:83"><span class="id" title="variable">N</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">n</span> <span class="id" title="notation">∈</span> <span class="id" title="var">N</span>)); <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hfl Hgs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full_in"><span class="id" title="lemma">gstack_full_in</span></a> <span class="id" title="notation">with</span> "Hfl Hgs"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %[<span class="id" title="var">s'</span> <span class="id" title="var">Hs'</span>]%<span class="id" title="method">elem_of_dom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hgs" <span class="id" title="keyword">as</span> "[% [? Hfls]]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><span class="id" title="lemma">big_sepM_lookup</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">n</span> <span class="id" title="notation">with</span> "Hfls"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Hfl'"; <span class="id" title="tactic">first</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_false_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full_unique"><span class="id" title="lemma">gstack_full_unique</span></a> <span class="id" title="notation">with</span> "Hfl Hfl'"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "?"; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstacks_take_out" class="idref" href="#gstacks_take_out"><span class="id" title="lemma">gstacks_take_out</span></a> <a id="M:86" class="idref" href="#M:86"><span class="id" title="binder">M</span></a> <a id="N:87" class="idref" href="#N:87"><span class="id" title="binder">N</span></a> <a id="n:88" class="idref" href="#n:88"><span class="id" title="binder">n</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:88"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∉</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:87"><span class="id" title="variable">N</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists"><span class="id" title="definition">gstack_exists</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:88"><span class="id" title="variable">n</span></a> <span class="id" title="notation">-∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:86"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:87"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">∃</span> <a id="s:89" class="idref" href="#s:89"><span class="id" title="binder">s</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:86"><span class="id" title="variable">M</span></a> <span class="id" title="notation">!!</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:88"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:89"><span class="id" title="variable">s</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:86"><span class="id" title="variable">M</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:87"><span class="id" title="variable">N</span></a> <span class="id" title="notation">∪</span> <span class="id" title="notation">{[</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:88"><span class="id" title="variable">n</span></a><span class="id" title="notation">]}</span>) <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:88"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:89"><span class="id" title="variable">s</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Hn</span>) "#Hex Hgs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_exists_in"><span class="id" title="lemma">gstack_exists_in</span></a> <span class="id" title="notation">with</span> "Hex Hgs"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">M</span> <span class="id" title="notation">!!</span> <span class="id" title="var">n</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">HMn</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">not_elem_of_dom</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HMn</span>; <span class="id" title="var">set_solver</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">s</span>; <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hgs" <span class="id" title="keyword">as</span> "(%&amp;$&amp;Hgs)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">M</span> <span class="id" title="keyword">with</span> (<span class="id" title="definition">delete</span> <span class="id" title="var">n</span> <span class="id" title="var">M</span> <span class="id" title="notation">∪</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s</span><span class="id" title="notation">]}</span>); <span class="id" title="var">last</span> <span class="id" title="tactic">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="method">map_eq</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>)) <span class="id" title="keyword">as</span> [-&gt;|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_union</span> <span class="id" title="lemma">lookup_singleton</span> <span class="id" title="lemma">lookup_delete</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_union</span> <span class="id" title="lemma">lookup_singleton_ne</span> // <span class="id" title="lemma">lookup_delete_ne</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span>: (<span class="id" title="var">M</span> <span class="id" title="notation">!!</span> <span class="id" title="var">i</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="definition">delete</span> <span class="id" title="var">n</span> <span class="id" title="var">M</span> <span class="id" title="notation">##ₘ</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s</span><span class="id" title="notation">]}</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">map_disjoint_spec</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> ? ? <span class="id" title="var">Hdl</span> [-&gt; -&gt;]%<span class="id" title="lemma">lookup_singleton_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_delete</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hdl</span>; <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">big_sepM_union</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">big_sepM_singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_false_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_true_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hgs" <span class="id" title="keyword">as</span> "[Hgs $]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iPureIntro</span>; <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">big_sepM_mono</span>; <span class="id" title="var">last</span> <span class="id" title="var">iAssumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> ? ?; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>)) <span class="id" title="keyword">as</span> [-&gt;|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> [<span class="id" title="definition">bool_decide</span> (<span class="id" title="var">n</span> <span class="id" title="notation">∈</span> <span class="id" title="var">N</span> <span class="id" title="notation">∪</span> <span class="id" title="var">_</span>)]<span class="id" title="lemma">bool_decide_eq_true_2</span>; [<span class="id" title="tactic">auto</span>|<span class="id" title="var">set_solver</span>]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">i</span> <span class="id" title="notation">∈</span> <span class="id" title="var">N</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_true_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_false_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstacks_put_back" class="idref" href="#gstacks_put_back"><span class="id" title="lemma">gstacks_put_back</span></a> <a id="M:90" class="idref" href="#M:90"><span class="id" title="binder">M</span></a> <a id="N:91" class="idref" href="#N:91"><span class="id" title="binder">N</span></a> <a id="n:92" class="idref" href="#n:92"><span class="id" title="binder">n</span></a> <a id="s:93" class="idref" href="#s:93"><span class="id" title="binder">s</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:90"><span class="id" title="variable">M</span></a> <span class="id" title="notation">!!</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:92"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:93"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:92"><span class="id" title="variable">n</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:93"><span class="id" title="variable">s</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:90"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:91"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:90"><span class="id" title="variable">M</span></a> (<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:91"><span class="id" title="variable">N</span></a> <span class="id" title="notation">∖</span> <span class="id" title="notation">{[</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:92"><span class="id" title="variable">n</span></a><span class="id" title="notation">]}</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">HMns</span>) "Hfl Hgs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full_is_out"><span class="id" title="lemma">gstack_full_is_out</span></a> <span class="id" title="notation">with</span> "Hfl Hgs"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hgs" <span class="id" title="keyword">as</span> "[% [$ Hgs]]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iPureIntro</span>; <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">M</span> <span class="id" title="keyword">with</span> (<span class="id" title="definition">delete</span> <span class="id" title="var">n</span> <span class="id" title="var">M</span> <span class="id" title="notation">∪</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s</span><span class="id" title="notation">]}</span>); <span class="id" title="var">last</span> <span class="id" title="tactic">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="method">map_eq</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>)) <span class="id" title="keyword">as</span> [-&gt;|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_union</span> <span class="id" title="lemma">lookup_singleton</span> <span class="id" title="lemma">lookup_delete</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_union</span> <span class="id" title="lemma">lookup_singleton_ne</span> // <span class="id" title="lemma">lookup_delete_ne</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span>: (<span class="id" title="var">M</span> <span class="id" title="notation">!!</span> <span class="id" title="var">i</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="definition">delete</span> <span class="id" title="var">n</span> <span class="id" title="var">M</span> <span class="id" title="notation">##ₘ</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s</span><span class="id" title="notation">]}</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">map_disjoint_spec</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> ? ? <span class="id" title="var">Hdl</span> [-&gt; -&gt;]%<span class="id" title="lemma">lookup_singleton_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_delete</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hdl</span>; <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">big_sepM_union</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hgs" <span class="id" title="keyword">as</span> "[Hgs _]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">big_sepM_singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_false_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "Hfl".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">big_sepM_mono</span>; <span class="id" title="var">last</span> <span class="id" title="var">iAssumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> ? <span class="id" title="var">Hnmi</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> -&gt;; <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_delete</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hnmi</span>; <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">i</span> <span class="id" title="notation">∈</span> <span class="id" title="var">N</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_true_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_false_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstacks_out_swap" class="idref" href="#gstacks_out_swap"><span class="id" title="lemma">gstacks_out_swap</span></a> <a id="M:94" class="idref" href="#M:94"><span class="id" title="binder">M</span></a> <a id="N:95" class="idref" href="#N:95"><span class="id" title="binder">N</span></a> <a id="n:96" class="idref" href="#n:96"><span class="id" title="binder">n</span></a> <a id="s:97" class="idref" href="#s:97"><span class="id" title="binder">s</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:96"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∈</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:95"><span class="id" title="variable">N</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:94"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:95"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> (<span class="id" title="notation">&lt;[</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:96"><span class="id" title="variable">n</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#s:97"><span class="id" title="variable">s</span></a><span class="id" title="notation">]&gt;</span><span class="id" title="notation">M</span>) <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:95"><span class="id" title="variable">N</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">HnN</span>) "HM".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "HM" <span class="id" title="keyword">as</span> "[% HM]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="definition">dom</span> (<span class="id" title="notation">&lt;[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s</span><span class="id" title="notation">]&gt;</span> <span class="id" title="notation">M</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">dom</span> <span class="id" title="var">M</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hdomeq</span> <span class="id" title="tactic">by</span> <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hdomeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "HM" <span class="id" title="keyword">as</span> "[$ HM]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">M</span> <span class="id" title="notation">!!</span> <span class="id" title="var">n</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s'</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">not_elem_of_dom</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="var">set_solver</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">M</span> <span class="id" title="keyword">with</span> (<span class="id" title="definition">delete</span> <span class="id" title="var">n</span> <span class="id" title="var">M</span> <span class="id" title="notation">∪</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s'</span><span class="id" title="notation">]}</span>); <span class="id" title="var">last</span> <span class="id" title="tactic">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="method">map_eq</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>)) <span class="id" title="keyword">as</span> [-&gt;|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_union</span> <span class="id" title="lemma">lookup_singleton</span> <span class="id" title="lemma">lookup_delete</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_union</span> <span class="id" title="lemma">lookup_singleton_ne</span> // <span class="id" title="lemma">lookup_delete_ne</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span>: (<span class="id" title="var">M</span> <span class="id" title="notation">!!</span> <span class="id" title="var">i</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="definition">delete</span> <span class="id" title="var">n</span> <span class="id" title="var">M</span> <span class="id" title="notation">##ₘ</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s'</span><span class="id" title="notation">]}</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">map_disjoint_spec</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> ? ? <span class="id" title="var">Hdl</span> [-&gt; -&gt;]%<span class="id" title="lemma">lookup_singleton_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_delete</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hdl</span>; <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="notation">&lt;[</span><span class="id" title="var">n</span><span class="id" title="notation">:=</span><span class="id" title="var">s</span><span class="id" title="notation">]&gt;</span> <span class="id" title="notation">(</span><span class="id" title="notation">delete</span> <span class="id" title="notation">n</span> <span class="id" title="notation">M</span> <span class="id" title="notation">∪</span> <span class="id" title="notation">{[</span><span class="id" title="notation">n</span> <span class="id" title="notation">:=</span> <span class="id" title="notation">s'</span><span class="id" title="notation">]})</span>) <span class="id" title="keyword">with</span> (<span class="id" title="definition">delete</span> <span class="id" title="var">n</span> <span class="id" title="var">M</span> <span class="id" title="notation">∪</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s</span><span class="id" title="notation">]}</span>); <span class="id" title="var">last</span> <span class="id" title="tactic">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="method">map_eq</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>)) <span class="id" title="keyword">as</span> [-&gt;|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_insert</span> <span class="id" title="lemma">lookup_union</span> <span class="id" title="lemma">lookup_delete</span> <span class="id" title="lemma">lookup_singleton</span> //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_insert_ne</span> // !<span class="id" title="lemma">lookup_union</span> !<span class="id" title="lemma">lookup_singleton_ne</span> //. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="definition">delete</span> <span class="id" title="var">n</span> <span class="id" title="var">M</span> <span class="id" title="notation">##ₘ</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span> <span class="id" title="notation">:=</span> <span class="id" title="var">s</span><span class="id" title="notation">]}</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">map_disjoint_spec</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> ? ? <span class="id" title="var">Hdl</span> [-&gt; -&gt;]%<span class="id" title="lemma">lookup_singleton_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_delete</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hdl</span>; <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">big_sepM_union</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "HM" <span class="id" title="keyword">as</span> "[HM _]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">big_sepM_singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_true_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="var">last</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="lemma">big_sepM_mono</span>; <span class="id" title="var">last</span> <span class="id" title="var">iAssumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> ? <span class="id" title="var">Hnmi</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">i</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> -&gt;; <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">lookup_delete</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hnmi</span>; <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">decide</span> (<span class="id" title="var">i</span> <span class="id" title="notation">∈</span> <span class="id" title="var">N</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_true_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_false_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>); <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstacks_except_included" class="idref" href="#gstacks_except_included"><span class="id" title="lemma">gstacks_except_included</span></a> <a id="M:98" class="idref" href="#M:98"><span class="id" title="binder">M</span></a> <a id="N:99" class="idref" href="#N:99"><span class="id" title="binder">N</span></a> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:98"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:99"><span class="id" title="variable">N</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:99"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <span class="id" title="definition">dom</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:98"><span class="id" title="variable">M</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a>; <span class="id" title="var">iIntros</span> "[% ?]"; <span class="id" title="var">done</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="gstack_alloc" class="idref" href="#gstack_alloc"><span class="id" title="lemma">gstack_alloc</span></a> <a id="M:100" class="idref" href="#M:100"><span class="id" title="binder">M</span></a> <a id="N:101" class="idref" href="#N:101"><span class="id" title="binder">N</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:100"><span class="id" title="variable">M</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:101"><span class="id" title="variable">N</span></a> <span class="id" title="notation">==∗</span> <span class="id" title="notation">∃</span> <a id="n:102" class="idref" href="#n:102"><span class="id" title="binder">n</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:102"><span class="id" title="variable">n</span></a> <span class="id" title="notation">∉</span> <span class="id" title="definition">dom</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#M:100"><span class="id" title="variable">M</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> (<span class="id" title="notation">&lt;[</span><a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:102"><span class="id" title="variable">n</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><span class="id" title="notation">]&gt;</span><span class="id" title="notation">M</span>) <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#N:101"><span class="id" title="variable">N</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#n:102"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_full"><span class="id" title="definition">gstack_full</span></a> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstack_frag"><span class="id" title="definition">gstack_frag</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(%&amp;Hdm&amp;HM)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> (<span class="id" title="lemma">own_alloc_cofinite</span> (<span class="id" title="notation">●</span> <span class="id" title="abbreviation">Excl'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <span class="id" title="notation">⋅</span> <span class="id" title="notation">◯</span> <span class="id" title="abbreviation">Excl'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>) (<span class="id" title="definition">dom</span> <span class="id" title="var">M</span>)) <span class="id" title="keyword">as</span> (<span class="id" title="var">n</span>) "[%HnM [Hfl Hfr]]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">auth_both_valid_2</span>; <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <span class="id" title="notation">(</span><span class="id" title="lemma">own_update</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="notation">●</span> <span class="id" title="notation">(</span><span class="id" title="notation">{[</span><span class="id" title="var">n</span><span class="id" title="notation">]}</span> <span class="id" title="notation">∪</span> <span class="id" title="definition">dom</span> <span class="id" title="var">M</span><span class="id" title="notation">)</span> <span class="id" title="notation">⋅</span> <span class="id" title="notation">◯</span> <span class="id" title="notation">(</span><span class="id" title="notation">{[</span><span class="id" title="var">n</span><span class="id" title="notation">]}</span> <span class="id" title="notation">∪</span> <span class="id" title="definition">dom</span> <span class="id" title="var">M</span><span class="id" title="notation">)</span>) <span class="id" title="notation">with</span> "Hdm"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[Hdm Hn]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="lemma">auth_update_alloc</span>; <span class="id" title="tactic">apply</span> <span class="id" title="lemma">gset_local_update</span>; <span class="id" title="var">set_solver</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssert</span> (<span class="id" title="definition">own</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_name"><span class="id" title="method">gstacks_name</span></a> (<span class="id" title="notation">◯</span> <span class="id" title="notation">{[</span><span class="id" title="var">n</span><span class="id" title="notation">]}</span>)) <span class="id" title="keyword">as</span> "#?".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> -<span class="id" title="lemma">gset_op</span>; <span class="id" title="var">iDestruct</span> "Hn" <span class="id" title="keyword">as</span> "[$ _]". }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "#".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">dom_insert</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "Hfr Hdm".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iPureIntro</span>; <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">big_sepM_insert</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">not_elem_of_dom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">bool_decide_eq_false_2</span>; <span class="id" title="var">last</span> <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "#"; <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#ghost_stacks"><span class="id" title="section">ghost_stacks</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="gstacks_init" class="idref" href="#gstacks_init"><span class="id" title="lemma">gstacks_init</span></a> `{<a id="gstacksGpre0:104" class="idref" href="#gstacksGpre0:104"><span class="id" title="binder">!</span></a><a id="gstacksGpre0:104" class="idref" href="#gstacksGpre0:104"><span class="id" title="binder">gstacksGpre</span></a> <a id="b0c243fdea575b06d729ab1bfbed1dd2" class="idref" href="#b0c243fdea575b06d729ab1bfbed1dd2"><span class="id" title="binder"><span id="gstacksGpre0:104" class="id">Σ</span></span></a>} : <span class="id" title="notation">⊢</span> <span class="id" title="notation">|==&gt;</span> <span class="id" title="notation">∃</span> <span class="id" title="var">_</span> : <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacksIG"><span class="id" title="class">gstacksIG</span></a> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#b0c243fdea575b06d729ab1bfbed1dd2"><span class="id" title="variable">Σ</span></a><span class="id" title="notation">,</span> <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a> <span class="id" title="notation">∅</span> <span class="id" title="notation">∅</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_except"><span class="id" title="definition">gstacks_except</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "".<br/>
&nbsp;&nbsp;<span class="id" title="var">iMod</span> (<span class="id" title="lemma">own_alloc</span> (<span class="id" title="notation">●</span> <span class="id" title="notation">∅</span>)) <span class="id" title="keyword">as</span> (<span class="id" title="var">γ</span>) "Hdm"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">auth_auth_valid</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">iExists</span> {| <a class="idref" href="WBLogic.program_logic.ghost_stacks.html#gstacks_name"><span class="id" title="method">gstacks_name</span></a> := <span class="id" title="var">γ</span> |}.<br/>
&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">dom_empty</span> <span class="id" title="lemma">big_sepM_empty</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
